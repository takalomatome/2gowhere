<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>2goWhere — Explore South Africa</title>
  <meta name="description" content="2goWhere — Discover and book attractions, hotels, flights and cars across South Africa.">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#1a5490">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <!-- Preconnect to third-party origins for faster loads -->
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://images.unsplash.com" crossorigin>
  <!-- Open Graph (Preview Cards) -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="2goWhere">
  <meta property="og:title" content="2goWhere — Explore South Africa">
  <meta property="og:description" content="Discover and book attractions, hotels, flights and cars across South Africa.">
  <meta property="og:image" content="https://timely-gingersnap-40a8a3.netlify.app/images/capetown_1.jpg">
  <link rel="canonical" href="https://timely-gingersnap-40a8a3.netlify.app/">
  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="2goWhere — Explore South Africa">
  <meta name="twitter:description" content="Discover and book attractions, hotels, flights and cars across South Africa.">
  <meta name="twitter:image" content="https://timely-gingersnap-40a8a3.netlify.app/images/capetown_1.jpg">
  <link rel="icon" href="images/favicon-32.svg">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="assets/style.min.css">
  
  <!-- Leaflet CSS for real-time mapping -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
  
  <!-- Leaflet JavaScript (deferred for performance) -->
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
  
  <style id="authModalStyles">
    #authModal .form-grid{display:grid;grid-template-columns:1fr;gap:10px}
    #authModal .form-field label{display:block;margin-bottom:4px}
    #authModal .form-actions{display:flex;flex-direction:column;gap:8px;align-items:stretch}
  </style>
</head>
<body>
  <div class="slideshow" id="slideshow">
    <img src="images/capetown_1.jpg" class="slide active" alt="Slide 1" loading="eager" decoding="async">
    <img src="images/safari_1.jpg" class="slide" alt="Slide 2" loading="lazy" decoding="async">
    <img src="images/beach_1.jpg" class="slide" alt="Slide 3" loading="lazy" decoding="async">
    <img src="images/durban_1.jpg" class="slide" alt="Slide 4" loading="lazy" decoding="async">
    <img src="images/safari_2.jpg" class="slide" alt="Slide 5" loading="lazy" decoding="async">
    <img src="images/capetown_2.jpg" class="slide" alt="Slide 6" loading="lazy" decoding="async">
  </div>

  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand" id="brandLogo" role="button" tabindex="0" aria-label="Go to Home"><img src="images/2gowhere-logo.svg.png" class="logo-svg" alt="2goWhere"></div>
      <nav class="topnav">
        <div class="nav-item" data-route="home">Home</div>
        <div class="nav-item" data-route="search">Search</div>
      </nav>
      <div class="top-actions">
        <button id="loginBtn" class="btn subtle">Login</button>
        <button id="signupBtn" class="btn primary">Sign in</button>
        <button id="hamburger" class="btn ghost">☰</button>
      </div>
    </div>
  </header>

  <div id="toolbarDropdown" class="toolbar-dropdown" style="display:none"></div>

  <!-- Auth Modal -->
  <div id="authModal" class="toolbar-dropdown" style="display:none; position:fixed; inset:auto 12px 12px auto; right:12px; top:72px; z-index:1001;">
    <div class="dd-header"><span class="dd-title" id="authTitle">Sign in</span><button class="dd-close" aria-label="Close">✕</button></div>
    <div class="dd-body">
      <form id="authForm" class="dd-form">
        <div class="form-grid">
          <div class="form-field"><label for="authTitleSelect">Title</label>
            <select id="authTitleSelect" name="title">
              <option value="">Select</option>
              <option>Mr</option>
              <option>Ms</option>
              <option>Mrs</option>
              <option>Dr</option>
              <option>Prof</option>
              <option>Other</option>
            </select>
          </div>
          <div id="authNameRow" class="form-field"><label for="authName">First name</label><input id="authName" name="name" placeholder="Your first name"></div>
          <div id="authSurnameRow" class="form-field"><label for="authSurname">Surname</label><input id="authSurname" name="surname" placeholder="Your surname"></div>
          <div class="form-field"><label for="authEmail">Email</label><input id="authEmail" name="email" type="email" placeholder="you@example.com" required></div>
          <div class="form-field"><label for="authPhone">Phone</label><input id="authPhone" name="phone" type="tel" placeholder="e.g. +27 71 234 5678"></div>
          <div id="authPassRow" class="form-field"><label for="authPassword">Password</label><input id="authPassword" name="password" type="password" placeholder="••••••••"></div>
          <div id="authPass2Row" class="form-field"><label for="authPassword2">Confirm password</label><input id="authPassword2" name="password2" type="password" placeholder="••••••••"></div>
        </div>
        <label class="toggle" style="margin:4px 0 8px 0; display:flex; gap:8px; align-items:center;">
          <input id="authRemember" type="checkbox"><span>Remember me on this device</span>
        </label>
        <div class="form-actions" style="display:flex; flex-direction:column; gap:8px; align-items:stretch;"><button id="authSendOtp" type="button" class="btn primary">Send OTP</button></div>
        <div id="otpRow" class="form-field" style="display:none; margin-top:8px;"><label for="authOtp">Enter OTP</label><input id="authOtp" name="otp" inputmode="numeric" maxlength="6" placeholder="6-digit code"></div>
        <div class="form-actions" id="otpActions" style="display:none; gap:8px; flex-direction:column; align-items:stretch;">
          <button id="authVerify" type="button" class="btn primary">Verify</button>
          <button id="authResend" type="button" class="btn subtle">Resend</button>
        </div>
        <div class="form-actions" id="passwordActions" style="display:flex; flex-direction:column; gap:8px; align-items:stretch; margin-top:4px;">
          <button id="authLoginAction" type="button" class="btn primary">Log in</button>
        </div>
        <div id="authMsg" style="margin-top:8px; font-size:12px; color:#1a5490;"></div>
      </form>
    </div>
  </div>

  <div id="hamburgerMenu" class="hamburger-menu">
    <div class="hamburger-header">
      <h3>Menu</h3>
      <button id="closeMenu" class="close-btn">✕</button>
    </div>
    <nav class="hamburger-nav">
      <a href="#" class="hamburger-item" data-route="home">🏠 Home</a>
      <a href="#" class="hamburger-item" data-route="explore">🔍 Explore</a>
      <a href="#" class="hamburger-item" data-route="hotels">🏨 Hotels</a>
      <a href="#" class="hamburger-item" data-route="attractions">🎭 Attractions</a>
      <a href="#" class="hamburger-item" data-route="cars">🚗 Rent a Car</a>
      <a href="#" class="hamburger-item" data-route="flights">✈️ Book a Flight</a>
      <a href="#" class="hamburger-item" data-route="ride">🚕 Request a Ride</a>
    </nav>
  </div>

  <main id="main">
    <section id="home" class="page">
      <div class="hero">
        <h1>Explore South Africa</h1>
        <p>Discover curated experiences, hotels, flights and vehicles — all in one place.</p>
        <div class="home-buttons">
          <button class="cta" onclick="openSidePanel('explore')">Explore</button>
          <button class="cta" data-route="hotels">Hotels</button>
          <button class="cta" data-route="attractions" id="attractionsGoldBtn">Attractions</button>
          <button class="cta" data-route="malls">Malls</button>
          <button class="cta" onclick="openSidePanel('cars')">Rent a Car</button>
          <button class="cta" onclick="openSidePanel('flights')">Book a Flight</button>
          <button class="cta" onclick="openSidePanel('ride')">Request a Ride</button>
        </div>
      </div>
      
      <!-- Why 2goWhere Section -->
      <div class="why-2gowhere-container">
        <div class="why-2gowhere-window">
          <h2 class="why-heading">WHY 2GOWHERE.COM</h2>
          <div class="why-content-grid">
            <div class="why-item">
              <h3>🎯 All-in-One Platform</h3>
              <p>From attractions and hotels to flights and car rentals, discover everything South Africa has to offer in one seamless platform. No more juggling multiple websites or apps.</p>
            </div>
            <div class="why-item">
              <h3>🏆 Curated Local Experiences</h3>
              <p>We handpick the best attractions, hidden gems, and authentic experiences across South Africa. Our local expertise ensures you discover the real treasures of the Rainbow Nation.</p>
            </div>
            <div class="why-item">
              <h3>💰 Best Price Guarantee</h3>
              <p>Compare prices across multiple providers and get the best deals on accommodations, activities, and transport. Save money while experiencing more of beautiful South Africa.</p>
            </div>
            <div class="why-item">
              <h3>⚡ Instant Booking</h3>
              <p>Book attractions, hotels, and services instantly with our streamlined booking system. Real-time availability and instant confirmations make planning your South African adventure effortless.</p>
            </div>
            <div class="why-item">
              <h3>🔒 Secure & Trusted</h3>
              <p>Your safety and security are our priority. With encrypted payments, verified providers, and 24/7 support, you can book with complete confidence and peace of mind.</p>
            </div>
            <div class="why-item">
              <h3>📱 Smart Search Technology</h3>
              <p>Our advanced search filters help you find exactly what you're looking for. Search by location, activity type, budget, or preferences to discover your perfect South African experience.</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Interactive South Africa Map Section -->
      <div class="home-map-section">
        <div class="map-section-header">
          <h2 class="map-heading">🗺️ Explore South Africa - Interactive Map</h2>
          <p class="map-description">Discover over 150+ attractions across all 9 provinces with our interactive map</p>
        </div>
        <div class="home-map-container">
          <div id="homeSouthAfricaMap" class="home-south-africa-map">
            <div class="interactive-map">
              <div class="map-header">
                <div class="map-stats">
                  <span class="live-indicator">🔴 LIVE</span>
                  <span class="attraction-count">20+ Attractions</span>
                  <span class="province-count">9 Provinces Mapped</span>
                  <span class="real-time-weather">🌤️ <span id="mapClock"></span></span>
                </div>
              </div>
              <!-- Real-time Interactive Map -->
              <div id="realTimeMap" style="width: 100%; height: 500px; border-radius: 10px; overflow: hidden;"></div>
              
              <!-- Map loading indicator -->
              <div id="mapLoadingIndicator" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #1a5490; font-size: 18px; font-weight: bold;">
                🗺️ Loading Real-Time Map...
              </div>
              
              <div class="map-controls">
                <button class="map-zoom-btn" onclick="zoomMap(1.3)">🔍 Zoom In</button>
                <button class="map-zoom-btn" onclick="zoomMap(0.7)">🔍 Zoom Out</button>
                <button class="map-zoom-btn" onclick="resetMapZoom()">↻ Reset View</button>
                <button class="map-filter-btn" onclick="toggleAttractionFilter()">🎯 Filter</button>
                <button class="map-view-btn" onclick="toggleMapView()">🗺️ Satellite</button>
                <button class="map-info-btn" onclick="showMapInfo()">ℹ️ Info</button>
              </div>
              
              <div class="map-legend">
                <div class="legend-header">Attraction Types</div>
                <div class="legend-grid">
                  <div class="legend-item"><span class="legend-dot natural-wonder"></span> Natural Wonders</div>
                  <div class="legend-item"><span class="legend-dot wildlife"></span> Wildlife & Safari</div>
                  <div class="legend-item"><span class="legend-dot historical"></span> Historical Sites</div>
                  <div class="legend-item"><span class="legend-dot cultural"></span> Cultural</div>
                  <div class="legend-item"><span class="legend-dot adventure"></span> Adventure</div>
                  <div class="legend-item"><span class="legend-dot entertainment"></span> Entertainment</div>
                </div>
              </div>
              
              <div class="attraction-filter-panel" id="attractionFilterPanel" style="display: none;">
                <h4>Filter Attractions</h4>
                <div class="filter-options">
                  <label><input type="checkbox" value="all" checked onchange="filterAttractions()"> Show All</label>
                  <label><input type="checkbox" value="natural-wonder" onchange="filterAttractions()"> Natural Wonders</label>
                  <label><input type="checkbox" value="wildlife" onchange="filterAttractions()"> Wildlife</label>
                  <label><input type="checkbox" value="historical" onchange="filterAttractions()"> Historical</label>
                  <label><input type="checkbox" value="adventure" onchange="filterAttractions()"> Adventure</label>
                  <label><input type="checkbox" value="entertainment" onchange="filterAttractions()"> Entertainment</label>
                </div>
              </div>
            </div>
          </div>
          <div class="home-map-sidebar">
            <h3>🎯 Featured Attractions</h3>
            <div id="homeMapAttractionsList" class="home-map-attractions-list">
              <div class="featured-attraction-card" onclick="showDetailedAttraction('Table Mountain')">
                <div class="attraction-image">
                  <img 
                    data-src="https://images.unsplash.com/photo-1580060839134-75a5edca2e99?w=400&h=300&fit=crop&auto=format&q=75" 
                    data-srcset="https://images.unsplash.com/photo-1580060839134-75a5edca2e99?w=300&h=225&fit=crop&auto=format&q=75 300w,
                                 https://images.unsplash.com/photo-1580060839134-75a5edca2e99?w=400&h=300&fit=crop&auto=format&q=75 400w,
                                 https://images.unsplash.com/photo-1580060839134-75a5edca2e99?w=600&h=450&fit=crop&auto=format&q=80 600w"
                    data-sizes="(max-width: 480px) 300px, (max-width: 768px) 400px, 600px"
                    src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='100%25' height='100%25' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23666' font-size='14'%3ELoading...%3C/text%3E%3C/svg%3E"
                    alt="Table Mountain Cape Town" 
                    class="lazy-image" 
                    onclick="event.stopPropagation(); openLightbox(this, 'Table Mountain National Park', 'Iconic flat-topped mountain offering panoramic views via cable car or hiking trails. UNESCO World Heritage Site.')">
                  <div class="attraction-badge">4.8⭐ (45,231 reviews)</div>
                  <div class="image-overlay">
                    <span class="view-image-btn">🔍 View Image</span>
                  </div>
                  <div class="image-loading-indicator"></div>
                </div>
                <div class="attraction-details">
                  <h4>📍 Table Mountain National Park</h4>
                  <p class="location">Cape Town, Western Cape • 5.2km from city center</p>
                  <p class="description">Iconic flat-topped mountain offering panoramic views via cable car or hiking trails. UNESCO World Heritage Site.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Cable Car: R365</span>
                    <span class="hours">🕐 8:00 AM - 6:00 PM</span>
                    <span class="type">🏔️ Natural Wonder</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Cable Car</span>
                    <span class="feature">Hiking Trails</span>
                    <span class="feature">Restaurant</span>
                    <span class="feature">Gift Shop</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedAttraction('Kruger National Park')">
                <div class="attraction-image">
                  <img 
                    data-src="https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=400&h=300&fit=crop&auto=format&q=75" 
                    data-srcset="https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=300&h=225&fit=crop&auto=format&q=75 300w,
                                 https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=400&h=300&fit=crop&auto=format&q=75 400w,
                                 https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=600&h=450&fit=crop&auto=format&q=80 600w"
                    data-sizes="(max-width: 480px) 300px, (max-width: 768px) 400px, 600px"
                    src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='100%25' height='100%25' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23666' font-size='14'%3ELoading...%3C/text%3E%3C/svg%3E"
                    alt="Kruger National Park Safari" 
                    class="lazy-image" 
                    onclick="event.stopPropagation(); openLightbox(this, 'Kruger National Park', 'Africa\'s premier wildlife destination spanning 20,000km² with Big Five and over 500 bird species.')">
                  <div class="attraction-badge">4.7⭐ (28,542 reviews)</div>
                  <div class="image-overlay">
                    <span class="view-image-btn">🔍 View Image</span>
                  </div>
                  <div class="image-loading-indicator"></div>
                </div>
                <div class="attraction-details">
                  <h4>📍 Kruger National Park</h4>
                  <p class="location">Mpumalanga & Limpopo • 350km from Johannesburg</p>
                  <p class="description">Africa's premier wildlife destination spanning 20,000km². Home to the Big Five and over 500 bird species.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Day Visit: R440</span>
                    <span class="hours">🕐 5:30 AM - 6:30 PM</span>
                    <span class="type">🦁 Safari Park</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Big Five</span>
                    <span class="feature">Game Drives</span>
                    <span class="feature">Rest Camps</span>
                    <span class="feature">Bush Walks</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedAttraction('Robben Island')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=250&fit=crop" alt="Robben Island Museum" loading="lazy">
                  <div class="attraction-badge">4.6⭐ (12,847 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>📍 Robben Island Museum</h4>
                  <p class="location">Western Cape • 7km from Cape Town harbor</p>
                  <p class="description">UNESCO World Heritage Site where Nelson Mandela was imprisoned. Guided tours by former political prisoners.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Ferry + Tour: R550</span>
                    <span class="hours">🕐 9:00 AM - 3:00 PM</span>
                    <span class="type">🏛️ Historical Site</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Ferry Trip</span>
                    <span class="feature">Prison Tour</span>
                    <span class="feature">Museum</span>
                    <span class="feature">Audio Guide</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedAttraction('Drakensberg Mountains')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1598300042247-d088f8ab3a91?w=400&h=250&fit=crop" alt="Drakensberg Mountains" loading="lazy">
                  <div class="attraction-badge">4.9⭐ (8,934 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>📍 uKhahlamba-Drakensberg Park</h4>
                  <p class="location">KwaZulu-Natal • 250km from Durban</p>
                  <p class="description">Spectacular mountain range with ancient San rock art, hiking trails, and pristine wilderness areas.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Park Entry: R50</span>
                    <span class="hours">🕐 6:00 AM - 6:00 PM</span>
                    <span class="type">⛰️ UNESCO Site</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Hiking Trails</span>
                    <span class="feature">Rock Art</span>
                    <span class="feature">Camping</span>
                    <span class="feature">Bird Watching</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedAttraction('V&A Waterfront')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1576485290814-1c72aa4bbb8e?w=400&h=250&fit=crop" alt="V&A Waterfront Cape Town" loading="lazy">
                  <div class="attraction-badge">4.5⭐ (67,423 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>📍 V&A Waterfront</h4>
                  <p class="location">Cape Town, Western Cape • Waterfront district</p>
                  <p class="description">Historic working harbor transformed into premier shopping, dining, and entertainment destination.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Free Entry</span>
                    <span class="hours">🕐 10:00 AM - 10:00 PM</span>
                    <span class="type">🛍️ Shopping & Dining</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Shopping Malls</span>
                    <span class="feature">Restaurants</span>
                    <span class="feature">Aquarium</span>
                    <span class="feature">Entertainment</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedAttraction('Apartheid Museum')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1581833971358-2c8b550f87b3?w=400&h=250&fit=crop" alt="Apartheid Museum Johannesburg" loading="lazy">
                  <div class="attraction-badge">4.7⭐ (15,672 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>📍 Apartheid Museum</h4>
                  <p class="location">Johannesburg, Gauteng • 10km from city center</p>
                  <p class="description">Comprehensive museum documenting South Africa's apartheid era through multimedia exhibits and personal stories.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Adults: R100</span>
                    <span class="hours">🕐 9:00 AM - 5:00 PM</span>
                    <span class="type">🏛️ History Museum</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Multimedia Exhibits</span>
                    <span class="feature">Audio Tours</span>
                    <span class="feature">Film Screenings</span>
                    <span class="feature">Gift Shop</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedAttraction('Cape Point Nature Reserve')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1539650116574-75c0c6d73ab2?w=400&h=250&fit=crop" alt="Cape Point Lighthouse" loading="lazy">
                  <div class="attraction-badge">4.8⭐ (32,154 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>📍 Cape Point Nature Reserve</h4>
                  <p class="location">Cape Peninsula, Western Cape • 60km from Cape Town</p>
                  <p class="description">Dramatic cliffs where Atlantic and Indian Oceans meet. Historic lighthouse and diverse fynbos vegetation.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Adults: R390</span>
                    <span class="hours">🕐 7:00 AM - 5:00 PM</span>
                    <span class="type">🌊 Nature Reserve</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Lighthouse</span>
                    <span class="feature">Funicular</span>
                    <span class="feature">Restaurant</span>
                    <span class="feature">Walking Trails</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedAttraction('Blyde River Canyon')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1597149328080-a3e2c4ba4f0d?w=400&h=250&fit=crop" alt="Blyde River Canyon" loading="lazy">
                  <div class="attraction-badge">4.9⭐ (18,743 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>📍 Blyde River Canyon</h4>
                  <p class="location">Mpumalanga • 350km from Johannesburg</p>
                  <p class="description">Third largest canyon in the world with spectacular viewpoints, waterfalls, and unique rock formations.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Free Entry</span>
                    <span class="hours">🕐 24/7 (Viewpoints)</span>
                    <span class="type">🏔️ Natural Wonder</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Three Rondavels</span>
                    <span class="feature">God's Window</span>
                    <span class="feature">Bourke's Luck</span>
                    <span class="feature">Scenic Drive</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedAttraction('Hermanus Whale Watching')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=250&fit=crop" alt="Whale Watching Hermanus" loading="lazy">
                  <div class="attraction-badge">4.8⭐ (24,891 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>📍 Hermanus Whale Watching</h4>
                  <p class="location">Hermanus, Western Cape • 120km from Cape Town</p>
                  <p class="description">World's best land-based whale watching. Southern Right Whales visit annually June-December.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Free (Land), Boat: R650</span>
                    <span class="hours">🕐 Best: 9:00 AM - 4:00 PM</span>
                    <span class="type">🐋 Wildlife Watching</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Cliff Path</span>
                    <span class="feature">Whale Crier</span>
                    <span class="feature">Boat Tours</span>
                    <span class="feature">Whale Festival</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Featured Shopping Malls Section -->
            <div class="section-header">
              <h3>🛍️ Premier Shopping Destinations</h3>
              <p>Discover South Africa's finest shopping centers with luxury brands, dining, and entertainment</p>
            </div>
            <div id="featuredMallsList" class="home-map-attractions-list">
              <div class="featured-attraction-card" onclick="showDetailedMall('Sandton City')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?w=400&h=250&fit=crop" alt="Sandton City Mall" loading="lazy">
                  <div class="attraction-badge">4.6⭐ (89,234 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>🛍️ Sandton City</h4>
                  <p class="location">Sandton, Johannesburg • Financial District</p>
                  <p class="description">Africa's premier shopping destination with luxury brands, flagship stores, and world-class dining.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Free Entry & Parking</span>
                    <span class="hours">🕐 9:00 AM - 9:00 PM</span>
                    <span class="type">🏬 Premium Mall</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">400+ Stores</span>
                    <span class="feature">Luxury Brands</span>
                    <span class="feature">Food Court</span>
                    <span class="feature">Cinema</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedMall('Canal Walk')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1567226475328-9d6baaf565cf?w=400&h=250&fit=crop" alt="Canal Walk Shopping Centre" loading="lazy">
                  <div class="attraction-badge">4.5⭐ (67,892 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>🛍️ Canal Walk Shopping Centre</h4>
                  <p class="location">Century City, Cape Town • 10km from city center</p>
                  <p class="description">Largest shopping center in Africa with over 400 stores, entertainment, and unique canal-themed architecture.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Free Entry & Parking</span>
                    <span class="hours">🕐 9:00 AM - 9:00 PM</span>
                    <span class="type">🏬 Mega Mall</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">400+ Stores</span>
                    <span class="feature">Ice Rink</span>
                    <span class="feature">Skate Park</span>
                    <span class="feature">Entertainment</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedMall('Gateway Theatre of Shopping')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=250&fit=crop" alt="Gateway Theatre of Shopping" loading="lazy">
                  <div class="attraction-badge">4.4⭐ (45,673 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>🛍️ Gateway Theatre of Shopping</h4>
                  <p class="location">Durban North, KwaZulu-Natal • 15km from Durban</p>
                  <p class="description">Award-winning mall with unique architecture, beach theme, and comprehensive shopping and entertainment.</p>
                  <div class="attraction-info">
                    <span class="price">💰 Free Entry & Parking</span>
                    <span class="hours">🕐 9:00 AM - 9:00 PM</span>
                    <span class="type">🏬 Themed Mall</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">330+ Stores</span>
                    <span class="feature">Wave House</span>
                    <span class="feature">IMAX Cinema</span>
                    <span class="feature">Mini Golf</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Featured Hotels Section -->
            <div class="section-header">
              <h3>🏨 Luxury Accommodations</h3>
              <p>Experience world-class hospitality at South Africa's finest hotels and resorts</p>
            </div>
            <div id="featuredHotelsList" class="home-map-attractions-list">
              <div class="featured-attraction-card" onclick="showDetailedHotel('One&Only Cape Town')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=400&h=250&fit=crop" alt="One&Only Cape Town" loading="lazy">
                  <div class="attraction-badge">4.9⭐ (12,847 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>🏨 One&Only Cape Town</h4>
                  <p class="location">V&A Waterfront, Cape Town • Waterfront location</p>
                  <p class="description">Ultra-luxury resort on private island with Table Mountain views, world-class spa, and award-winning restaurants.</p>
                  <div class="attraction-info">
                    <span class="price">💰 From R15,000/night</span>
                    <span class="hours">🕐 24/7 Service</span>
                    <span class="type">⭐⭐⭐⭐⭐ Luxury Resort</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Spa</span>
                    <span class="feature">Fine Dining</span>
                    <span class="feature">Marina View</span>
                    <span class="feature">Concierge</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedHotel('Saxon Hotel')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=400&h=250&fit=crop" alt="Saxon Hotel Johannesburg" loading="lazy">
                  <div class="attraction-badge">4.8⭐ (8,934 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>🏨 Saxon Hotel, Villas & Spa</h4>
                  <p class="location">Sandhurst, Johannesburg • 15km from OR Tambo</p>
                  <p class="description">Exclusive boutique hotel where Nelson Mandela wrote his autobiography. Ultimate luxury and privacy.</p>
                  <div class="attraction-info">
                    <span class="price">💰 From R12,500/night</span>
                    <span class="hours">🕐 24/7 Service</span>
                    <span class="type">⭐⭐⭐⭐⭐ Boutique Hotel</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Villa Suites</span>
                    <span class="feature">Qunu Spa</span>
                    <span class="feature">Private Pools</span>
                    <span class="feature">Butler Service</span>
                  </div>
                </div>
              </div>
              
              <div class="featured-attraction-card" onclick="showDetailedHotel('Oyster Box Hotel')">
                <div class="attraction-image">
                  <img src="https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?w=400&h=250&fit=crop" alt="Oyster Box Hotel Durban" loading="lazy">
                  <div class="attraction-badge">4.7⭐ (15,632 reviews)</div>
                </div>
                <div class="attraction-details">
                  <h4>🏨 The Oyster Box Hotel</h4>
                  <p class="location">Umhlanga, Durban • Beachfront location</p>
                  <p class="description">Iconic colonial-style hotel on golden beaches. Luxury accommodation with Indian Ocean views and world-class service.</p>
                  <div class="attraction-info">
                    <span class="price">💰 From R8,500/night</span>
                    <span class="hours">🕐 24/7 Service</span>
                    <span class="type">⭐⭐⭐⭐⭐ Beach Resort</span>
                  </div>
                  <div class="attraction-features">
                    <span class="feature">Ocean Views</span>
                    <span class="feature">Lighthouse Bar</span>
                    <span class="feature">Spa Treatments</span>
                    <span class="feature">Beach Access</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div id="homeStack" class="home-stack"></div>
    </section>
    <section id="malls" class="page" style="display:none">
      <div class="page-navigation" style="z-index: 9999 !important; position: fixed; top: 80px; left: 20px;">
        <button class="back-btn" onclick="showPage('home');" style="pointer-events: auto !important;">🏠 Back to Home</button>
      </div>
      <h2>Malls</h2>
      <div class="search-container" style="margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 12px; backdrop-filter: blur(10px);">
        <input type="search" id="mallSearch" class="search-input" placeholder="🔍 Search malls by name, city, or province..." autocomplete="off" style="width: 100%; padding: 12px 20px; font-size: 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
      </div>
      <div id="mallCards" class="cards"></div>
      <div id="mallDetail" class="detail-view" style="display:none;">
        <div id="mallDetailContent"></div>
      </div>
    </section>

    <section id="explore" class="page" style="display:none">
      <div class="page-navigation" style="z-index: 9999 !important;">
        <button class="back-btn" onclick="showPage('home'); setTimeout(() => openSidePanel('explore'), 200);" style="pointer-events: auto !important;">← Back to Explore</button>
        <button class="back-btn" onclick="showPage('home');" style="pointer-events: auto !important;">🏠 Back to Home</button>
      </div>
      <h2>Explore South Africa</h2>
      <div class="explore-grid">
        <button class="explore-btn" data-explore="attractions">Attractions</button>
        <button class="explore-btn" data-explore="hotels">Hotels</button>
        <button class="explore-btn" data-explore="beaches">Beaches</button>
        <button class="explore-btn" data-explore="hiking">Hiking & Adventure</button>
        <button class="explore-btn" data-explore="airports">Airports</button>
        <button class="explore-btn" data-explore="cars">Car Rentals</button>
      </div>
      <div id="explorePanel" class="explore-panel" style="display:none;">
        <div class="search-row">
          <input id="exploreSearch" class="search-input" type="search" placeholder="Search..." autocomplete="off">
          <label class="toggle">
            <input id="exploreLiveToggle" type="checkbox">
            <span>Live results (airports)</span>
          </label>
        </div>
        <div id="exploreMeta" class="explore-meta"></div>
        <div id="exploreResults" class="cards"></div>
      </div>
    </section>

    <section id="attractions" class="page" style="display:none">
      <div class="page-navigation" style="z-index: 9999 !important; position: fixed; top: 80px; left: 20px;">
        <button class="back-btn" onclick="showPage('home');" style="pointer-events: auto !important;">🏠 Back to Home</button>
      </div>
      <h2>Attractions in South Africa</h2>
      <div class="search-container" style="margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 12px; backdrop-filter: blur(10px);">
        <div class="search-row">
          <input type="text" class="search-input" placeholder="Search attractions across South Africa..." id="attractionSearch" style="font-size: 16px; padding: 12px 16px;" onkeypress="if(event.key==='Enter'){searchAttractions();}">
          <button class="btn primary" onclick="searchAttractions()" style="padding: 12px 20px;">Search</button>
        </div>
        <p style="margin: 10px 0 0 0; color: rgba(255,255,255,0.8); font-size: 14px;">🔍 Search by name, location, or activity type</p>
      </div>
      <div id="attractionCards" class="cards">
        <!-- Cards will be populated dynamically by searchAttractions() -->
      </div>
      <div id="attractionDetail" class="detail-view" style="display:none;">
        <button class="back-btn" onclick="closeAttractionDetail()">← Back to Attractions</button>
        <div id="attractionDetailContent"></div>
      </div>
    </section>
    <section id="hotels" class="page" style="display:none">
      <div class="page-navigation" style="z-index: 9999 !important; position: fixed; top: 80px; left: 20px;">
        <button class="back-btn" onclick="showPage('home');" style="pointer-events: auto !important;">🏠 Back to Home</button>
      </div>
      <h2>Hotels</h2>
      <div class="search-container" style="margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 12px; backdrop-filter: blur(10px);">
        <input type="search" id="hotelSearch" class="search-input" placeholder="🔍 Search hotels by name, city, or province..." autocomplete="off" style="width: 100%; padding: 12px 20px; font-size: 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
      </div>
      <div id="hotelCards" class="cards"></div>
      <div id="hotelDetail" class="detail-view" style="display:none;">
        <button class="back-btn" onclick="closeHotelDetail()">← Back to Hotels</button>
        <div id="hotelDetailContent"></div>
      </div>
    </section>
    <section id="place" class="page" style="display:none">
      <div class="page-navigation" style="z-index: 9999 !important;">
        <button class="back-btn" onclick="showPage('home'); setTimeout(() => openSidePanel('explore'), 200);" style="pointer-events: auto !important;">← Back to Explore</button>
        <button class="back-btn" onclick="showPage('home');" style="pointer-events: auto !important;">🏠 Back to Home</button>
      </div>
      <h2 id="placeTitle">Place</h2>
      <div id="placeDetail" class="detail-view" style="display:block;">
        <div id="placeDetailContent"></div>
      </div>
    </section>
        <section id="cars" class="page" style="display:none">
          <div class="page-navigation fixed-navigation" style="z-index: 9999 !important; position: fixed; top: 80px; left: 20px; right: 20px; background: rgba(26, 26, 46, 0.95); backdrop-filter: blur(15px); border-radius: 15px; padding: 15px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);">
            <button class="back-btn" onclick="showPage('home'); setTimeout(() => openSidePanel('cars'), 200);" style="pointer-events: auto !important; margin-right: 10px;">← Back to Rentals</button>
            <button class="back-btn" onclick="showPage('home');" style="pointer-events: auto !important;">🏠 Back to Home</button>
          </div>
          <h2>Rent a Car</h2>
          <div class="cards">
            <div class="form-card">
              <h3>🚗 Find a Rental</h3>
              <form id="carForm">
                <div class="form-grid">
                  <div class="form-field">
                    <label for="carPickup">Pick-up location</label>
                    <input id="carPickup" name="pickup" list="sa-airports" placeholder="City or airport" required>
                  </div>
                  <div class="form-field">
                    <label for="carDropoff">Drop-off location</label>
                    <input id="carDropoff" name="dropoff" list="sa-airports" placeholder="City or airport" required>
                  </div>
                  <div class="form-field">
                    <label for="carFrom">From (date)</label>
                    <input id="carFrom" name="from" type="date" required>
                  </div>
                  <div class="form-field">
                    <label for="carTo">Until (date)</label>
                    <input id="carTo" name="to" type="date" required>
                  </div>
                  <div class="form-field">
                    <label for="carPassengers">Passengers</label>
                    <select id="carPassengers" name="passengers">
                      <option>1</option>
                      <option>2</option>
                      <option>3</option>
                      <option>4</option>
                      <option>5</option>
                      <option>6</option>
                      <option>7</option>
                      <option>8</option>
                    </select>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn primary">Search Cars</button>
                </div>
              </form>
              <datalist id="sa-airports">
                <option value="CPT - Cape Town Intl">
                <option value="JNB - OR Tambo (Johannesburg)">
                <option value="DUR - King Shaka (Durban)">
                <option value="PLZ - Gqeberha (Port Elizabeth)">
                <option value="GRJ - George">
                <option value="HLA - Lanseria (Johannesburg)">
              </datalist>
            </div>
          </div>
        </section>
        <section id="flights" class="page" style="display:none">
          <div class="page-navigation" style="z-index: 9999 !important;">
            <button class="back-btn" onclick="showPage('home'); setTimeout(() => openSidePanel('flights'), 200);" style="pointer-events: auto !important;">← Back to Flights</button>
            <button class="back-btn" onclick="showPage('home');" style="pointer-events: auto !important;">🏠 Back to Home</button>
          </div>
          <h2>Book a Flight</h2>
          <div class="cards">
            <div class="form-card">
              <h3>✈️ Search Flights</h3>
              <form id="flightForm">
                <div class="form-grid flight-form-grid">
                  <div class="form-field flight-trip-type">
                    <label for="flightTrip">Trip type</label>
                    <div class="inline">
                      <label><input type="radio" name="trip" value="oneway" checked> One way</label>
                      <label><input type="radio" name="trip" value="return"> Return</label>
                    </div>
                  </div>
                  <div class="flight-row">
                    <div class="form-field">
                      <label for="fromAirport">From</label>
                      <input id="fromAirport" name="from" list="sa-airports" placeholder="Select airport" required>
                    </div>
                    <div class="form-field">
                      <label for="toAirport">To</label>
                      <input id="toAirport" name="to" list="sa-airports" placeholder="Select airport" required>
                    </div>
                  </div>
                  <div class="flight-row">
                    <div class="form-field">
                      <label for="departDate">Depart</label>
                      <input id="departDate" name="depart" type="date" required>
                    </div>
                    <div class="form-field">
                      <label for="travellers">Travellers</label>
                      <select id="travellers" name="travellers">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-field" id="returnDateField" style="display:none;">
                    <label for="returnDate">Return</label>
                    <input id="returnDate" name="return" type="date">
                  </div>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn primary">Search Flights</button>
                </div>
              </form>
              <datalist id="sa-airports">
                <option value="CPT - Cape Town Intl">
                <option value="JNB - OR Tambo (Johannesburg)">
                <option value="DUR - King Shaka (Durban)">
                <option value="PLZ - Gqeberha (Port Elizabeth)">
                <option value="GRJ - George">
                <option value="HLA - Lanseria (Johannesburg)">
              </datalist>
            </div>
          </div>
        </section>
        <section id="ride" class="page" style="display:none">
          <div class="page-navigation" style="z-index: 9999 !important;">
            <button class="back-btn" onclick="showPage('home'); setTimeout(() => openSidePanel('ride'), 200);" style="pointer-events: auto !important;">← Back to Rides</button>
            <button class="back-btn" onclick="showPage('home');" style="pointer-events: auto !important;">🏠 Back to Home</button>
          </div>
          <h2>Request a Ride</h2>
          <div class="cards">
            <div class="info-card">
              <h3>🚕 Ride Services</h3>
              <p>Book reliable transportation for airport transfers, city tours, or point-to-point travel across South Africa.</p>
              <button class="btn primary" onclick="alert('Ride booking system coming soon!')">Request a Ride</button>
            </div>
          </div>
        </section>
    <section id="reviews" class="page" style="display:none"><h2>Reviews</h2><div id="reviewsFeed"></div></section>
    <section id="about" class="page" style="display:none"><h2>About</h2><div id="aboutBox"></div></section>
  </main>

  <footer>© 2025 2goWhere • info@2gowhere.com</footer>

  <!-- Side Panel System -->
  <div id="sidePanelOverlay" class="side-panel-overlay">
    <div id="sidePanel" class="side-panel">
      <div class="side-panel-header">
        <h2 id="sidePanelTitle">Panel Title</h2>
        <button id="sidePanelClose" class="side-panel-close">✕</button>
      </div>
      <div id="sidePanelContent" class="side-panel-content">
        <!-- Dynamic content will be loaded here -->
      </div>
    </div>
  </div>

  <!-- South Africa Map Modal -->
  <div id="mapModal" class="map-modal" style="display: none;">
    <div class="map-modal-content">
      <div class="map-modal-header">
        <h2>🗺️ Explore South Africa - Interactive Map</h2>
        <button id="mapModalClose" class="map-modal-close">✕</button>
      </div>
      <div class="map-container">
        <div id="southAfricaMap" class="south-africa-map">
          <!-- Interactive map will be loaded here -->
          <div class="map-placeholder">
            <div class="map-loading">Loading Interactive Map...</div>
            <div class="map-info">
              <h3>🌟 Discover South Africa's Top Attractions</h3>
              <p>Explore over 150+ attractions across all 9 provinces with our interactive map</p>
            </div>
          </div>
        </div>
        <div class="map-sidebar">
          <h3>🎯 Featured Attractions</h3>
          <div id="mapAttractionsList" class="map-attractions-list">
            <!-- Attraction pins will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.__OPENWEATHER_KEY__ = "demo_openweather_key_2gowhere"; 
    window.__CRIMEOMETER_KEY__ = "demo_crime_key_2gowhere";
    
    // Global debug function to test button clicks
    window.testPanelOpen = function(type) {
      console.log('Test panel open called for:', type);
      alert('Button click detected for: ' + type);
    };
  </script>
  <script type="module" src="scripts/live-api.module.min.js"></script>
  <script defer src="scripts/script.min.js"></script>
  <script>
    // Attraction data (expanded with real SA attractions, beaches, hiking, adventure)
    const attractionsData = {
      'table-mountain': {
        name: 'Table Mountain',
        location: 'Cape Town, Western Cape',
        image: 'images/capetown_1.jpg',
        description: 'Table Mountain is one of the most iconic landmarks in South Africa and a must-visit attraction in Cape Town. Standing at 1,084 meters above sea level, this flat-topped mountain offers breathtaking 360-degree views of the city, coastline, and surrounding peaks.',
        highlights: ['Cable car ride to the summit with rotating floors', 'Over 350 routes for hikers and rock climbers', 'Home to over 2,200 species of plants', 'UNESCO World Heritage Site', 'Stunning sunset and sunrise views'],
        activities: ['Hiking', 'Cable Car Ride', 'Photography', 'Rock Climbing', 'Picnicking'],
        hours: 'Cable car: 8:00 AM - 8:00 PM (weather dependent)',
        price: 'Adults: R395 | Children: R200 (Cable car round trip)',
        bestTime: 'Early morning or late afternoon to avoid crowds and witness spectacular views'
      },
      'kruger-park': {
        name: 'Kruger National Park',
        location: 'Mpumalanga & Limpopo',
        image: 'images/safari_1.jpg',
        description: 'Kruger National Park is one of Africa\'s largest game reserves, spanning nearly 20,000 square kilometers. It\'s home to an incredible diversity of wildlife, including the Big Five.',
        highlights: ['Big Five game viewing', 'Over 500 bird species', '147 mammal species', 'Self-drive and guided safari options', 'Multiple rest camps and luxury lodges'],
        activities: ['Game Drives', 'Bush Walks', 'Bird Watching', 'Photography', 'Night Safaris'],
        hours: 'Gates open: 5:30 AM - 6:30 AM | Close: 5:30 PM - 6:30 PM (seasonal)',
        price: 'Adults: R440/day | Children: R220/day',
        bestTime: 'May to September (dry season) for best wildlife viewing'
      },
      'drakensberg': {
        name: 'Drakensberg Mountains',
        location: 'KwaZulu-Natal',
        image: 'images/bg_drakensberg.jpg.jpg',
        description: 'The Drakensberg is the highest mountain range in Southern Africa, rising to over 3,000 meters. This UNESCO World Heritage Site features dramatic basalt cliffs, pristine rivers, and ancient San rock art.',
        highlights: ['UNESCO World Heritage Site', 'Ancient San rock art', 'Tugela Falls - second highest waterfall', 'Amphitheatre rock formation', 'Alpine wildflowers'],
        activities: ['Hiking', 'Rock Climbing', 'Horse Riding', 'Trout Fishing', 'Cave Exploration'],
        hours: 'Open year-round, 24/7',
        price: 'Park entrance: R50-R100 per person',
        bestTime: 'October to April for hiking; June to August for snow'
      },
      'durban-beaches': {
        name: 'Durban Golden Mile',
        location: 'Durban, KwaZulu-Natal',
        image: 'images/durban_1.jpg',
        description: 'Durban\'s Golden Mile is a stretch of beautiful beaches along the warm Indian Ocean. Year-round sunshine and warm waters make it perfect for swimming, surfing, and beach activities.',
        highlights: ['Year-round warm weather', 'World-class surfing', 'Protected swimming with shark nets', 'Beachfront promenade', 'uShaka Marine World nearby'],
        activities: ['Swimming', 'Surfing', 'Beach Volleyball', 'Fishing', 'Dolphin Watching'],
        hours: 'Beaches open 24/7 | Lifeguards: 6:00 AM - 6:00 PM',
        price: 'Free access',
        bestTime: 'December to March for warmest weather'
      },
      'garden-route': {
        name: 'Garden Route',
        location: 'Western Cape & Eastern Cape',
        image: 'images/beach_1.jpg',
        description: 'The Garden Route is a 300km stretch of spectacular coastal scenery between Mossel Bay and Storms River, featuring indigenous forests, charming towns, pristine beaches, and dramatic mountain passes.',
        highlights: ['Tsitsikamma National Park', 'Knysna Lagoon and Heads', 'Plettenberg Bay beaches', 'Indigenous forests', 'Adventure activities and whale watching'],
        activities: ['Road Tripping', 'Hiking', 'Whale Watching', 'Kayaking', 'Bungee Jumping'],
        hours: 'Route accessible year-round',
        price: 'Individual attraction fees vary (R50-R300)',
        bestTime: 'September to November for flowers and whales'
      },
      'robben-island': {
        name: 'Robben Island',
        location: 'Cape Town, Western Cape',
        image: 'images/capetown_2.jpg',
        description: 'Robben Island is a UNESCO World Heritage Site and former prison where Nelson Mandela was imprisoned for 18 of his 27 years. Tours are led by former political prisoners.',
        highlights: ['Nelson Mandela\'s prison cell', 'Tours by former prisoners', 'UNESCO World Heritage Site', 'Historic village', 'Seal and penguin colonies'],
        activities: ['Guided Tours', 'Museum Visits', 'Historical Learning', 'Photography', 'Wildlife Viewing'],
        hours: 'Tours depart: 9:00 AM, 11:00 AM, 1:00 PM, 3:00 PM daily',
        price: 'Adults: R550 | Children: R310 (includes ferry)',
        bestTime: 'Year-round; book in advance'
      },
      'camps-bay': {
        name: 'Camps Bay Beach',
        location: 'Cape Town, Western Cape',
        image: 'images/beach_1.jpg',
        description: 'Camps Bay is one of Cape Town\'s most famous beaches, with pristine white sand, turquoise waters, and stunning views of the Twelve Apostles mountain range. The beach is lined with trendy cafes, bars, and restaurants.',
        highlights: ['Pristine white sand', 'Views of Twelve Apostles', 'Trendy cafes and restaurants', 'Sunset views', 'Safe swimming area'],
        activities: ['Swimming', 'Sunbathing', 'Beach Volleyball', 'Dining', 'Photography'],
        hours: 'Open 24/7 | Lifeguards: daylight hours',
        price: 'Free access',
        bestTime: 'November to March for warm weather'
      },
      'blyde-river-canyon': {
        name: 'Blyde River Canyon',
        location: 'Mpumalanga',
        image: 'images/bg_drakensberg.jpg.jpg',
        description: 'Blyde River Canyon is one of the largest canyons on Earth and a natural wonder of South Africa. The lush, subtropical foliage covers the canyon, creating breathtaking scenery with dramatic viewpoints.',
        highlights: ['Third largest canyon in the world', 'God\'s Window viewpoint', 'Three Rondavels rock formation', 'Bourke\'s Luck Potholes', 'Subtropical vegetation'],
        activities: ['Scenic Drives', 'Hiking', 'Boat Trips', 'Photography', 'Bird Watching'],
        hours: 'Open year-round, daylight hours',
        price: 'Viewpoints: R20-R50 per person',
        bestTime: 'Year-round; summer for lush greenery'
      },
      'boulders-beach': {
        name: 'Boulders Beach (Penguin Colony)',
        location: 'Simon\'s Town, Western Cape',
        image: 'images/capetown_2.jpg',
        description: 'Boulders Beach is famous for its colony of African penguins. Visitors can observe these endangered birds in their natural habitat and swim in the sheltered coves surrounded by giant granite boulders.',
        highlights: ['African penguin colony (2,000+ birds)', 'Sheltered swimming coves', 'Boardwalks for viewing', 'Part of Table Mountain National Park', 'Family-friendly'],
        activities: ['Penguin Watching', 'Swimming', 'Photography', 'Beach Walks', 'Snorkeling'],
        hours: '8:00 AM - 5:00 PM (Dec-Jan until 6:30 PM)',
        price: 'Adults: R152 | Children: R76',
        bestTime: 'Year-round; mornings for active penguins'
      },
      'lions-head-hike': {
        name: 'Lion\'s Head Hiking Trail',
        location: 'Cape Town, Western Cape',
        image: 'images/capetown_1.jpg',
        description: 'Lion\'s Head is one of Cape Town\'s most popular hiking trails, offering panoramic 360-degree views of the city, ocean, and mountains. The trail is especially popular for full moon hikes.',
        highlights: ['360-degree summit views', 'Moderate 2-3 hour hike', 'Full moon night hikes', 'Views of Table Mountain and coast', 'Suitable for most fitness levels'],
        activities: ['Hiking', 'Photography', 'Sunrise/Sunset Viewing', 'Full Moon Hikes'],
        hours: 'Open 24/7 (start early or late afternoon)',
        price: 'Free',
        bestTime: 'Year-round; early morning or sunset'
      },
      'tsitsikamma-national-park': {
        name: 'Tsitsikamma National Park',
        location: 'Eastern Cape',
        image: 'images/beach_1.jpg',
        description: 'Tsitsikamma National Park is a coastal reserve in the Garden Route, known for its indigenous forests, dramatic coastline, and the famous Storms River Suspension Bridge.',
        highlights: ['Storms River Suspension Bridge', 'Indigenous coastal forests', 'Otter Trail hiking', 'Marine Protected Area', 'Bloukrans Bridge bungee'],
        activities: ['Hiking', 'Kayaking', 'Bungee Jumping', 'Snorkeling', 'Zip-lining'],
        hours: '7:00 AM - 6:00 PM',
        price: 'Adults: R152 | Children: R76',
        bestTime: 'September to May for mild weather'
      },
      'addo-elephant-park': {
        name: 'Addo Elephant National Park',
        location: 'Eastern Cape',
        image: 'images/safari_2.jpg',
        description: 'Addo Elephant National Park is home to over 600 elephants, along with lions, buffalo, rhinos, and leopards (Big Five). It\'s one of South Africa\'s most popular safari destinations.',
        highlights: ['Over 600 elephants', 'Big Five viewing', 'Malaria-free', 'Self-drive and guided safaris', 'Multiple rest camps'],
        activities: ['Game Drives', 'Horseback Safaris', 'Bird Watching', 'Photography', 'Night Drives'],
        hours: '7:00 AM - 6:00 PM',
        price: 'Adults: R380 | Children: R190',
        bestTime: 'Year-round; summer for elephant sightings'
      },
      'chapman-peak-drive': {
        name: 'Chapman\'s Peak Drive',
        location: 'Cape Town, Western Cape',
        image: 'images/capetown_1.jpg',
        description: 'Chapman\'s Peak Drive is one of the most scenic coastal roads in the world, carved into the mountainside with breathtaking views of Hout Bay and the Atlantic Ocean.',
        highlights: ['9km scenic coastal drive', '114 curves with ocean views', 'Lookout points', 'Cycling route', 'Film location for many movies'],
        activities: ['Scenic Driving', 'Cycling', 'Photography', 'Picnicking'],
        hours: '7:00 AM - 6:00 PM (extended in summer)',
        price: 'Toll: R51 per vehicle',
        bestTime: 'Year-round; clear days for best views'
      },
      'hermanus-whale-watching': {
        name: 'Hermanus Whale Watching',
        location: 'Hermanus, Western Cape',
        image: 'images/beach_1.jpg',
        description: 'Hermanus is known as the best land-based whale watching destination in the world. Southern Right Whales visit the bay annually from June to November.',
        highlights: ['Best land-based whale watching', 'Southern Right Whales', 'Cliff Path walking trail', 'Whale Crier alerts', 'Annual Whale Festival'],
        activities: ['Whale Watching', 'Coastal Walks', 'Boat Tours', 'Photography', 'Wine Tasting'],
        hours: 'Open 24/7; best viewing daylight hours',
        price: 'Free (cliff path); boat tours R900+',
        bestTime: 'June to November (whale season)'
      },
      'otter-trail': {
        name: 'Otter Trail',
        location: 'Tsitsikamma, Eastern Cape',
        image: 'images/beach_1.jpg',
        description: 'The Otter Trail is South Africa\'s most famous multi-day hiking trail, a 5-day coastal route through pristine indigenous forest and rocky shoreline.',
        highlights: ['5-day coastal hike (42.5km)', 'Indigenous coastal forest', 'River crossings', 'Rustic overnight huts', 'Marine and bird life'],
        activities: ['Backpacking', 'Hiking', 'Wildlife Viewing', 'Photography', 'Swimming'],
        hours: 'Bookings essential (limited to 12 hikers/day)',
        price: 'R2,760 per person (5 days)',
        bestTime: 'September to April (book 12+ months ahead)'
      },
      'augrabies-falls': {
        name: 'Augrabies Falls National Park',
        location: 'Northern Cape',
        image: 'images/safari_1.jpg',
        description: 'Augrabies Falls is a spectacular waterfall on the Orange River, where the river plunges 56 meters into a granite gorge, creating a thunderous roar and mist.',
        highlights: ['56-meter waterfall', 'Orange River gorge', 'Klipspringer Trail hiking', 'Night sky (astronomy)', 'Unique desert flora'],
        activities: ['Waterfall Viewing', 'Hiking', 'Star Gazing', 'Kayaking', 'Photography'],
        hours: 'Gates open: 6:30 AM - 6:30 PM',
        price: 'Adults: R152 | Children: R76',
        bestTime: 'February to May (after rains for full flow)'
      },
      'robben-island': {
        name: 'Robben Island',
        location: 'Western Cape',
        image: 'images/capetown_1.jpg',
        description: 'Historic island prison where Nelson Mandela was incarcerated for 18 years. UNESCO World Heritage Site.',
        highlights: ['Nelson Mandela prison cell', 'UNESCO World Heritage Site', 'Guided tours by ex-political prisoners', 'Historical significance', 'Ferry ride from V&A Waterfront'],
        activities: ['Historical Tours', 'Ferry Trip', 'Museum Visit', 'Photography'],
        hours: '9:00 AM - 3:00 PM (weather dependent)',
        price: 'Adults: R550 | Children: R400',
        bestTime: 'Year-round (book in advance)'
      },
      'cape-point': {
        name: 'Cape Point & Cape of Good Hope',
        location: 'Western Cape',
        image: 'images/beach_1.jpg',
        description: 'Dramatic cliffs at the southwestern tip of Africa with historic lighthouse and stunning ocean views.',
        highlights: ['Cape of Good Hope Nature Reserve', 'Historic lighthouse', 'Baboon colonies', 'Shipwreck beaches', 'Flying Dutchman Funicular'],
        activities: ['Lighthouse Climbing', 'Wildlife Viewing', 'Hiking', 'Beach Visits', 'Photography'],
        hours: '6:00 AM - 6:00 PM (Apr-Sep) | 6:00 AM - 7:30 PM (Oct-Mar)',
        price: 'Adults: R185 | Children: R95',
        bestTime: 'September to November (whale season)'
      },
      'pilanesberg': {
        name: 'Pilanesberg National Park',
        location: 'North West Province',
        image: 'images/safari_2.jpg',
        description: 'Malaria-free Big Five game reserve in an ancient volcanic crater near Sun City.',
        highlights: ['Big Five (malaria-free)', 'Ancient volcanic crater', 'Over 360 bird species', 'Self-drive safaris', 'Near Sun City resort'],
        activities: ['Game Drives', 'Bird Watching', 'Photography', 'Hot Air Ballooning'],
        hours: 'Gates open: 5:30 AM | Close: 6:30 PM',
        price: 'Adults: R130 | Children: R65',
        bestTime: 'May to September (dry season)'
      },
      'blyde-river-canyon': {
        name: 'Blyde River Canyon',
        location: 'Mpumalanga',
        image: 'images/safari_1.jpg',
        description: 'Third largest canyon in the world with spectacular viewpoints and unique rock formations.',
        highlights: ['Third largest canyon globally', 'Gods Window viewpoint', 'Three Rondavels rock formation', 'Bourkes Luck Potholes', 'Panorama Route'],
        activities: ['Scenic Drives', 'Hiking', 'Photography', 'Boat Cruises', 'Viewpoint Visits'],
        hours: 'Open 24/7 (viewpoints 6:00 AM - 6:00 PM)',
        price: 'Free access to most viewpoints',
        bestTime: 'April to September (clear skies)'
      },
      'hermanus': {
        name: 'Hermanus Whale Watching',
        location: 'Western Cape',
        image: 'images/beach_1.jpg',
        description: 'World-renowned whale watching destination with Southern Right whales visible from shore.',
        highlights: ['Land-based whale watching', 'Whale Festival (September)', 'Cliff Path walks', 'Wine estates nearby', 'Shark cage diving'],
        activities: ['Whale Watching', 'Boat Tours', 'Wine Tasting', 'Shark Cage Diving', 'Cliff Walks'],
        hours: 'Best viewing: 9:00 AM - 4:00 PM',
        price: 'Free from shore | Boat tours from R800',
        bestTime: 'June to November (whale season)'
      },
      'tsitsikamma': {
        name: 'Tsitsikamma National Park',
        location: 'Eastern Cape',
        image: 'images/beach_1.jpg',
        description: 'Marine and coastal park with indigenous forests, suspension bridges, and adventure activities.',
        highlights: ['Suspension bridge over Storms River', 'Marine protected area', 'Indigenous forests', 'Otter Trail start point', 'Canopy tours'],
        activities: ['Hiking', 'Kayaking', 'Zip-lining', 'Snorkeling', 'Suspension Bridge Walk'],
        hours: '7:00 AM - 6:00 PM',
        price: 'Adults: R152 | Children: R76',
        bestTime: 'October to April (warm weather)'
      },
      'kgalagadi': {
        name: 'Kgalagadi Transfrontier Park',
        location: 'Northern Cape',
        image: 'images/safari_1.jpg',
        description: 'Vast semi-desert park famous for black-maned Kalahari lions and spectacular red sand dunes.',
        highlights: ['Black-maned Kalahari lions', 'Red sand dunes', 'Cheetah and leopard sightings', 'Gemsbok herds', 'Dark sky reserve'],
        activities: ['Game Drives', 'Photography', 'Star Gazing', 'Self-drive Safaris'],
        hours: 'Gates open: 7:30 AM | Close: 6:00 PM',
        price: 'Adults: R152 | Children: R76',
        bestTime: 'March to May (cooler temperatures)'
      },
      'golden-gate': {
        name: 'Golden Gate Highlands National Park',
        location: 'Free State',
        image: 'images/safari_2.jpg',
        description: 'Spectacular golden sandstone cliffs and grasslands with unique rock formations.',
        highlights: ['Golden sandstone cliffs', 'Unique rock formations', 'Highveld grasslands', 'San rock art', 'Mountain biking trails'],
        activities: ['Hiking', 'Mountain Biking', 'Rock Art Viewing', 'Photography', 'Horse Riding'],
        hours: 'Gates open: 6:00 AM | Close: 6:00 PM',
        price: 'Adults: R152 | Children: R76',
        bestTime: 'March to May (autumn colors)'
      },
      'addo-elephant': {
        name: 'Addo Elephant National Park',
        location: 'Eastern Cape',
        image: 'images/safari_2.jpg',
        description: 'Home to over 600 elephants and the only park in South Africa to house the Big Seven.',
        highlights: ['Over 600 elephants', 'Big Seven wildlife', 'Marine section with whales', 'Dense elephant population', 'Flightless dung beetle'],
        activities: ['Elephant Viewing', 'Game Drives', 'Marine Wildlife', 'Photography'],
        hours: 'Gates open: 7:00 AM | Close: 6:00 PM',
        price: 'Adults: R152 | Children: R76',
        bestTime: 'Year-round (elephants always visible)'
      },
      'hluhluwe-imfolozi': {
        name: 'Hluhluwe-iMfolozi Park',
        location: 'KwaZulu-Natal',
        image: 'images/safari_1.jpg',
        description: 'Oldest proclaimed nature reserve in Africa, famous for saving the white rhino from extinction.',
        highlights: ['White rhino conservation success', 'Oldest proclaimed reserve in Africa', 'Big Five wildlife', 'Wilderness trails', 'Bird watching paradise'],
        activities: ['Rhino Viewing', 'Game Drives', 'Wilderness Trails', 'Bird Watching'],
        hours: 'Gates open: 5:00 AM | Close: 7:00 PM (summer)',
        price: 'Adults: R140 | Children: R70',
        bestTime: 'May to September (dry season)'
      },
      'cango-caves': {
        name: 'Cango Caves',
        location: 'Western Cape',
        image: 'images/placeholder_1.jpg',
        description: 'Spectacular limestone cave system in the Klein Karoo with impressive stalactite formations.',
        highlights: ['Limestone cave system', 'Stalactite and stalagmite formations', 'Van Zyl Hall chamber', 'Adventure caving tours', 'Archaeological significance'],
        activities: ['Cave Tours', 'Adventure Caving', 'Photography', 'Educational Tours'],
        hours: '9:00 AM - 4:00 PM',
        price: 'Standard tour: R160 | Adventure tour: R200',
        bestTime: 'Year-round (constant temperature)'
      },
      'cradle-of-humankind': {
        name: 'Cradle of Humankind',
        location: 'Gauteng',
        image: 'images/safari_2.jpg',
        description: 'UNESCO World Heritage Site with important human ancestor fossils and interactive visitor centers.',
        highlights: ['UNESCO World Heritage Site', 'Human ancestor fossils', 'Sterkfontein Caves', 'Maropeng Visitor Centre', 'Mrs Ples fossil'],
        activities: ['Museum Visits', 'Cave Tours', 'Educational Tours', 'Fossil Viewing'],
        hours: '9:00 AM - 5:00 PM',
        price: 'Combined ticket: R210 | Individual sites: R130',
        bestTime: 'Year-round (indoor attractions)'
      },
      'soweto-tours': {
        name: 'Soweto Township Tours',
        location: 'Gauteng',
        image: 'images/durban_1.jpg',
        description: 'Cultural tours of South Africas largest township, including Mandela House and Vilakazi Street.',
        highlights: ['Nelson Mandela House', 'Vilakazi Street (Nobel Prize winners)', 'Hector Pieterson Museum', 'Local shebeen visits', 'Cultural immersion'],
        activities: ['Cultural Tours', 'Historical Sites', 'Local Dining', 'Community Visits'],
        hours: 'Tours available 8:00 AM - 5:00 PM',
        price: 'Half-day tours from R650',
        bestTime: 'Year-round (cultural experience)'
      }
    };

    // Function to close attraction detail and return to attractions list
    function closeAttractionDetail() {
      const cards = document.getElementById('attractionCards');
      const detail = document.getElementById('attractionDetail');
      const searchContainer = document.querySelector('.search-container');
      const attractionsTitle = document.querySelector('#attractions h2');
      
      // Show main attractions view and hide detail view
      if (cards) cards.style.display = 'grid';
      if (detail) detail.style.display = 'none';
      if (searchContainer) searchContainer.style.display = 'block';
      if (attractionsTitle) attractionsTitle.style.display = 'block';
      
      // Scroll to top of attractions page
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Search function for attractions page
    window.searchAttractions = function() {
      const searchInput = document.getElementById('attractionSearch');
      const query = searchInput?.value.trim().toLowerCase() || '';
      const attractionCards = document.getElementById('attractionCards');
      
      if (!attractionCards) {
        // If called before DOM is ready, retry in 100ms
        setTimeout(window.searchAttractions, 100);
        return;
      }
      
      console.log('Searching attractions for:', query);
      
      // Get all attractions data and filter
      const allAttractions = Object.entries(attractionsData||{}).map(([key, attraction]) => ({
        key,
        ...attraction
      }));
      
      const filtered = query === '' ? allAttractions : allAttractions.filter(attraction =>
        attraction.name.toLowerCase().includes(query) ||
        attraction.location.toLowerCase().includes(query) ||
        (attraction.activities && attraction.activities.some(activity => activity.toLowerCase().includes(query))) ||
        (attraction.highlights && attraction.highlights.some(highlight => highlight.toLowerCase().includes(query))) ||
        (attraction.description && attraction.description.toLowerCase().includes(query))
      );
      
      // Clear existing cards and populate with filtered results
      attractionCards.innerHTML = '';
      
      if (filtered.length === 0) {
        attractionCards.innerHTML = '<div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.8); background: rgba(26,84,144,0.1); border-radius: 12px; margin: 20px 0;"><h3 style="color: var(--gold);">No attractions found</h3><p>Try a different search term or <button onclick="document.getElementById(\'attractionSearch\').value=\'\'; window.searchAttractions();" style="background: none; border: none; color: var(--gold); text-decoration: underline; cursor: pointer;">browse all attractions</button>.</p></div>';
        return;
      }
      
      // Show search result count
      if (query !== '') {
        const countDiv = document.createElement('div');
        countDiv.style.cssText = 'text-align: center; margin: 20px 0; color: rgba(255,255,255,0.9); font-weight: 600;';
        countDiv.innerHTML = `Found ${filtered.length} attraction${filtered.length !== 1 ? 's' : ''} matching "${query}"`;
        attractionCards.appendChild(countDiv);
      }
      
      filtered.forEach(attraction => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-attraction', attraction.key);
        card.innerHTML = `
          <img src="${attraction.image}" alt="${attraction.name}" class="card-image">
          <div class="card-content">
            <h3>${attraction.name}</h3>
            <p>${attraction.description ? attraction.description.substring(0, 80) + '...' : 'Discover this amazing South African attraction'}</p>
            <span class="location">📍 ${attraction.location}</span>
          </div>
        `;
        
        // Add click handler for the card
        card.addEventListener('click', () => {
          showAttractionDetail(attraction.key);
        });
        
        attractionCards.appendChild(card);
      });
    }
    
    // Enable search functionality
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('attractionSearch');
      
      // Enter key search
      searchInput?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          searchAttractions();
        }
      });
      
      // Real-time search as user types (debounced)
      let searchTimeout;
      searchInput?.addEventListener('input', () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(searchAttractions, 300);
      });
      
      // Clear search button functionality
      searchInput?.addEventListener('focus', () => {
        if (searchInput.value.trim() === '') {
          searchAttractions(); // Show all attractions when focused
        }
      });
      
      // Initialize real-time map when DOM is loaded
      let realTimeMap;
      let attractionMarkers = [];
      
      function initializeRealTimeMap() {
        try {
          console.log('Initializing real-time map...');
          
          // Hide loading indicator
          const loadingIndicator = document.getElementById('mapLoadingIndicator');
          if (loadingIndicator) {
            loadingIndicator.style.display = 'none';
          }
          
          // Initialize Leaflet map centered on South Africa
          realTimeMap = L.map('realTimeMap').setView([-29.0852, 24.6791], 5);
          
          // Add satellite/street view tile layers
          const streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors',
            maxZoom: 18
          });
          
          const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '© Esri, Maxar, Earthstar Geographics',
            maxZoom: 18
          });
          
          // Add default street layer
          streetLayer.addTo(realTimeMap);
          
          // Layer control for switching between views
          const baseLayers = {
            "Street View": streetLayer,
            "Satellite View": satelliteLayer
          };
          L.control.layers(baseLayers).addTo(realTimeMap);
          
          // Add attraction markers with real coordinates
          addAttractionMarkers();
          
          // Add custom controls
          addCustomMapControls();
          
          console.log('Real-time map initialized successfully');
          
        } catch (error) {
          console.error('Error initializing real-time map:', error);
          const mapContainer = document.getElementById('realTimeMap');
          if (mapContainer) {
            mapContainer.innerHTML = '<div style="color: red; padding: 20px; text-align: center;">Error loading real-time map. Please check your internet connection.</div>';
          }
        }
      }
      
      function addAttractionMarkers() {
        const attractions = [
          // Western Cape
          { name: 'Table Mountain', lat: -33.9628, lng: 18.4098, type: 'Natural Wonder', color: '#ff6b6b' },
          { name: 'Robben Island', lat: -33.8067, lng: 18.3669, type: 'Historical Site', color: '#4ecdc4' },
          { name: 'V&A Waterfront', lat: -33.9067, lng: 18.4192, type: 'Entertainment', color: '#45b7d1' },
          { name: 'Cape Point', lat: -34.3587, lng: 18.4941, type: 'Natural Wonder', color: '#96ceb4' },
          { name: 'Stellenbosch Wine Route', lat: -33.9321, lng: 18.8602, type: 'Wine Tourism', color: '#ffeaa7' },
          { name: 'Hermanus Whale Watching', lat: -34.4187, lng: 19.2345, type: 'Wildlife', color: '#74b9ff' },
          
          // Gauteng
          { name: 'Apartheid Museum', lat: -26.2309, lng: 27.9111, type: 'Museum', color: '#fdcb6e' },
          { name: 'Cradle of Humankind', lat: -25.9461, lng: 27.7279, type: 'UNESCO Site', color: '#e17055' },
          { name: 'Gold Reef City', lat: -26.2361, lng: 27.9139, type: 'Theme Park', color: '#a29bfe' },
          { name: 'Union Buildings', lat: -25.7461, lng: 28.2314, type: 'Government', color: '#6c5ce7' },
          
          // KwaZulu-Natal
          { name: 'uShaka Marine World', lat: -29.8714, lng: 31.0464, type: 'Aquarium', color: '#00b894' },
          { name: 'Drakensberg Mountains', lat: -28.7500, lng: 29.2500, type: 'Natural Wonder', color: '#00a085' },
          
          // Mpumalanga
          { name: 'Kruger National Park', lat: -24.0078, lng: 31.4911, type: 'Safari', color: '#00b894' },
          { name: 'Blyde River Canyon', lat: -24.5500, lng: 30.8000, type: 'Natural Wonder', color: '#55a3ff' },
          
          // Eastern Cape
          { name: 'Addo Elephant Park', lat: -33.4817, lng: 25.7539, type: 'Wildlife', color: '#fd79a8' },
          { name: 'Tsitsikamma National Park', lat: -33.9700, lng: 23.8900, type: 'Adventure', color: '#fdcb6e' },
          
          // Free State
          { name: 'Golden Gate National Park', lat: -28.5167, lng: 28.6333, type: 'National Park', color: '#fab1a0' },
          
          // North West
          { name: 'Sun City Resort', lat: -25.3408, lng: 27.1050, type: 'Resort', color: '#e84393' },
          
          // Northern Cape
          { name: 'Kimberley Big Hole', lat: -28.7282, lng: 24.7499, type: 'Historical', color: '#636e72' },
          { name: 'Kgalagadi Transfrontier Park', lat: -25.5000, lng: 20.5000, type: 'Safari', color: '#2d3436' }
        ];
        
        attractions.forEach(attraction => {
          // Create custom icon
          const customIcon = L.divIcon({
            className: 'custom-marker',
            html: `<div style="background-color: ${attraction.color}; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; font-size: 10px;">📍</div>`,
            iconSize: [26, 26],
            iconAnchor: [13, 13]
          });
          
          // Create marker
          const marker = L.marker([attraction.lat, attraction.lng], { icon: customIcon })
            .addTo(realTimeMap)
            .bindPopup(`
              <div style="text-align: center; min-width: 200px;">
                <h3 style="margin: 0 0 8px 0; color: #1a5490;">${attraction.name}</h3>
                <p style="margin: 4px 0; color: #666; font-weight: 600;">${attraction.type}</p>
                <button onclick="showMapAttraction('${attraction.name}')" 
                        style="background: #1a5490; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-top: 8px;">
                  View Details
                </button>
              </div>
            `, {
              maxWidth: 250,
              className: 'custom-popup'
            });
          
          attractionMarkers.push(marker);
        });
        
        console.log(`Added ${attractions.length} attraction markers to the map`);
      }
      
      function addCustomMapControls() {
        // Custom control for map info
        const infoControl = L.control({position: 'topright'});
        infoControl.onAdd = function(map) {
          const div = L.DomUtil.create('div', 'info-control');
          div.innerHTML = `
            <button onclick="showMapInfo()" style="background: rgba(26, 84, 144, 0.9); color: white; border: none; padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 12px;">
              ℹ️ Map Info
            </button>
          `;
          return div;
        };
        infoControl.addTo(realTimeMap);
        
        // Custom control for attractions filter
        const filterControl = L.control({position: 'topright'});
        filterControl.onAdd = function(map) {
          const div = L.DomUtil.create('div', 'filter-control');
          div.innerHTML = `
            <button onclick="toggleAttractionFilter()" style="background: rgba(255, 208, 122, 0.9); color: #1a5490; border: none; padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 12px; margin-top: 5px;">
              🎯 Filter
            </button>
          `;
          return div;
        };
        filterControl.addTo(realTimeMap);
      }
      
      // Initialize map after Leaflet is loaded
      setTimeout(() => {
        if (typeof L !== 'undefined') {
          initializeRealTimeMap();
          updateMapClock();
        } else {
          console.error('Leaflet library not loaded');
          setTimeout(() => initializeRealTimeMap(), 2000);
        }
      }, 1500);
      

    });

    // Global datasets used across UI components
    const airportsData = [
      { code: 'CPT', name: 'Cape Town International Airport', city: 'Cape Town' },
      { code: 'JNB', name: 'OR Tambo International Airport', city: 'Johannesburg' },
      { code: 'DUR', name: 'King Shaka International Airport', city: 'Durban' },
      { code: 'HLA', name: 'Lanseria International Airport', city: 'Johannesburg' },
      { code: 'PLZ', name: 'Chief Dawid Stuurman International', city: 'Gqeberha (Port Elizabeth)' },
      { code: 'GRJ', name: 'George Airport', city: 'George' },
      { code: 'ELS', name: 'East London Airport', city: 'East London' },
      { code: 'MQP', name: 'Kruger Mpumalanga International', city: 'Mbombela (Nelspruit)' },
      { code: 'BFN', name: 'Bram Fischer International Airport', city: 'Bloemfontein' },
      { code: 'KIM', name: 'Kimberley Airport', city: 'Kimberley' },
      { code: 'UTN', name: 'Upington Airport', city: 'Upington' },
      { code: 'PHW', name: 'Phalaborwa Airport', city: 'Phalaborwa (Kruger Gate)' },
      { code: 'HDS', name: 'Hoedspruit Eastgate Airport', city: 'Hoedspruit (Kruger)' },
      { code: 'SIS', name: 'Sishen Airport', city: 'Sishen' },
      { code: 'NTY', name: 'Pilanesberg International Airport', city: 'Sun City / Pilanesberg' }
    ];

    const carRentalsData = [
      { name: 'Avis', city: 'Cape Town', at: 'CPT Airport' },
      { name: 'Budget', city: 'Johannesburg', at: 'OR Tambo (JNB)' },
      { name: 'Hertz', city: 'Durban', at: 'King Shaka (DUR)' },
      { name: 'Europcar', city: 'Gqeberha', at: 'PLZ Airport' },
      { name: 'Sixt', city: 'George', at: 'GRJ Airport' },
    ];

    const hotelsData = [
      { name: 'Table Bay Hotel', city: 'Cape Town', rating: 5, image: 'images/capetown_1.jpg' },
      { name: 'The Silo Hotel', city: 'Cape Town V&A Waterfront', rating: 5, image: 'images/capetown_2.jpg' },
      { name: 'One&Only Cape Town', city: 'Cape Town', rating: 5, image: 'images/capetown_1.jpg' },
      { name: 'Belmond Mount Nelson', city: 'Cape Town', rating: 5, image: 'images/capetown_2.jpg' },
      { name: 'Twelve Apostles Hotel', city: 'Camps Bay, Cape Town', rating: 5, image: 'images/beach_1.jpg' },
      { name: 'Sandton Sun', city: 'Johannesburg', rating: 5, image: 'images/safari_2.jpg' },
      { name: 'Saxon Hotel', city: 'Johannesburg', rating: 5, image: 'images/safari_1.jpg' },
      { name: 'Four Seasons The Westcliff', city: 'Johannesburg', rating: 5, image: 'images/safari_2.jpg' },
      { name: 'Beverly Hills Hotel', city: 'Umhlanga, Durban', rating: 5, image: 'images/durban_1.jpg' },
      { name: 'Oyster Box Hotel', city: 'Umhlanga, Durban', rating: 5, image: 'images/durban_1.jpg' },
      { name: 'The Plettenberg Hotel', city: 'Plettenberg Bay', rating: 5, image: 'images/beach_1.jpg' },
      { name: 'Fancourt Hotel', city: 'George', rating: 5, image: 'images/beach_1.jpg' },
      { name: 'Sabi Sabi Private Game Reserve', city: 'Kruger Area', rating: 5, image: 'images/safari_1.jpg' },
      { name: 'Singita Kruger National Park', city: 'Kruger Area', rating: 5, image: 'images/safari_2.jpg' },
      { name: 'Lion Sands Game Reserve', city: 'Sabi Sands, Kruger', rating: 5, image: 'images/safari_1.jpg' },
      { name: 'Radisson Blu Hotel Waterfront', city: 'Cape Town', rating: 4, image: 'images/capetown_1.jpg' },
      { name: 'Protea Hotel by Marriott', city: 'George', rating: 4, image: 'images/beach_1.jpg' },
      { name: 'Southern Sun Elangeni & Maharani', city: 'Durban', rating: 4, image: 'images/durban_1.jpg' },
      { name: 'The Capital Menlyn Maine', city: 'Pretoria', rating: 4, image: 'images/safari_2.jpg' },
      { name: 'Arabella Hotel & Spa', city: 'Hermanus', rating: 4, image: 'images/beach_1.jpg' }
    ];

    // South African malls dataset (major malls)
    const mallsData = [
      { name: 'Sandton City', city: 'Johannesburg', shops: 300, image: 'images/malls/sandton mall.jpg', hours: { mon:'09:00-20:00', tue:'09:00-20:00', wed:'09:00-20:00', thu:'09:00-20:00', fri:'09:00-21:00', sat:'09:00-21:00', sun:'09:00-18:00' } },
      { name: 'Mall of Africa', city: 'Midrand', shops: 300, image: 'images/malls/mall of africa.webp', hours: { mon:'09:00-20:00', tue:'09:00-20:00', wed:'09:00-20:00', thu:'09:00-20:00', fri:'09:00-21:00', sat:'09:00-21:00', sun:'09:00-18:00' } },
      { name: 'Canal Walk', city: 'Cape Town', shops: 400, image: 'images/malls/canal walk.jpg', hours: { mon:'09:00-21:00', tue:'09:00-21:00', wed:'09:00-21:00', thu:'09:00-21:00', fri:'09:00-21:00', sat:'09:00-21:00', sun:'09:00-19:00' } },
      { name: 'V&A Waterfront', city: 'Cape Town', shops: 450, image: 'images/malls/v&a weterfront.jpg', hours: { mon:'09:00-21:00', tue:'09:00-21:00', wed:'09:00-21:00', thu:'09:00-21:00', fri:'09:00-21:00', sat:'09:00-21:00', sun:'09:00-21:00' } },
      { name: 'Gateway Theatre of Shopping', city: 'Umhlanga', shops: 400, image: 'images/malls/gateway theatre of shoping.jpg', hours: { mon:'09:00-21:00', tue:'09:00-21:00', wed:'09:00-21:00', thu:'09:00-21:00', fri:'09:00-21:00', sat:'09:00-21:00', sun:'09:00-19:00' } },
      { name: 'Menlyn Park', city: 'Pretoria', shops: 300, image: 'images/malls/Menlyn-Park-Shopping-Centre.jpg', hours: { mon:'09:00-20:00', tue:'09:00-20:00', wed:'09:00-20:00', thu:'09:00-20:00', fri:'09:00-20:00', sat:'09:00-20:00', sun:'09:00-18:00' } },
      { name: 'Eastgate Mall', city: 'Johannesburg', shops: 250, image: 'images/malls/east gate mall.jpg', hours: { mon:'09:00-19:00', tue:'09:00-19:00', wed:'09:00-19:00', thu:'09:00-19:00', fri:'09:00-19:00', sat:'09:00-19:00', sun:'09:00-18:00' } },
      { name: 'Clearwater Mall', city: 'Roodepoort', shops: 250, image: 'images/malls/clearwater mall.jpg', hours: { mon:'09:00-19:00', tue:'09:00-19:00', wed:'09:00-19:00', thu:'09:00-19:00', fri:'09:00-19:00', sat:'09:00-19:00', sun:'09:00-17:00' } },
      { name: 'Cresta Shopping Centre', city: 'Randburg', shops: 260, image: 'images/malls/cresta shoping center.jpg', hours: { mon:'09:00-19:00', tue:'09:00-19:00', wed:'09:00-19:00', thu:'09:00-19:00', fri:'09:00-19:00', sat:'09:00-19:00', sun:'09:00-17:00' } },
      { name: 'Brooklyn Mall', city: 'Pretoria', shops: 220, image: 'images/malls/brookly shoping centere.avif', hours: { mon:'09:00-19:00', tue:'09:00-19:00', wed:'09:00-19:00', thu:'09:00-19:00', fri:'09:00-19:00', sat:'09:00-19:00', sun:'09:00-17:00' } },
      { name: 'The Pavilion', city: 'Westville', shops: 230, image: 'images/malls/Pavilion mall.webp', hours: { mon:'09:00-19:00', tue:'09:00-19:00', wed:'09:00-19:00', thu:'09:00-19:00', fri:'09:00-19:00', sat:'09:00-19:00', sun:'09:00-18:00' } },
      { name: 'Cavendish Square', city: 'Cape Town', shops: 200, image: 'images/malls/cavendish mall.jpg', hours: { mon:'09:00-19:00', tue:'09:00-19:00', wed:'09:00-19:00', thu:'09:00-19:00', fri:'09:00-19:00', sat:'09:00-19:00', sun:'10:00-17:00' } },
      { name: 'Somerset Mall', city: 'Somerset West', shops: 200, image: 'images/malls/somerset mall.webp', hours: { mon:'09:00-19:00', tue:'09:00-19:00', wed:'09:00-19:00', thu:'09:00-19:00', fri:'09:00-19:00', sat:'09:00-19:00', sun:'10:00-17:00' } },
      { name: 'Rosebank Mall', city: 'Johannesburg', shops: 150, image: 'images/malls/rosebank-mall.jpg', hours: { mon:'09:00-19:00', tue:'09:00-19:00', wed:'09:00-19:00', thu:'09:00-19:00', fri:'09:00-19:00', sat:'09:00-19:00', sun:'09:00-17:00' } }
    ];

    // Local placeholder pool for offline/blocked scenarios
    const mallPlaceholderPool = [
      'images/malls/sandton mall.jpg','images/malls/mall of africa.webp','images/malls/canal walk.jpg','images/malls/v&a weterfront.jpg',
      'images/malls/gateway theatre of shoping.jpg','images/malls/Menlyn-Park-Shopping-Centre.jpg','images/malls/east gate mall.jpg','images/malls/clearwater mall.jpg',
      'images/malls/cresta shoping center.jpg','images/malls/brookly shoping centere.avif','images/malls/Pavilion mall.webp','images/malls/cavendish mall.jpg',
      'images/malls/somerset mall.webp','images/malls/rosebank-mall.jpg','images/malls/pavillion mall.jpg'
    ];
    function pickMallPlaceholder(idx=0){ return mallPlaceholderPool[idx % mallPlaceholderPool.length]; }

    function getMallStatus(mall, now = new Date()) {
      try {
        const days = ['sun','mon','tue','wed','thu','fri','sat'];
        const dayKey = days[now.getDay()];
        const spec = mall.hours?.[dayKey];
        if (!spec || /^closed$/i.test(spec)) return { isOpen:false, opensAt:null, closesAt:null, statusText:'Closed today' };
        const [openStr, closeStr] = spec.split('-');
        const toMins = (s) => { const [h,m] = s.split(':').map(Number); return h*60 + (m||0); };
        const minsNow = now.getHours()*60 + now.getMinutes();
        const o = toMins(openStr), c = toMins(closeStr);
        const isOpen = minsNow >= o && minsNow < c;
        const statusText = isOpen ? `Open — closes ${closeStr}` : `Closed — opens ${openStr}`;
        return { isOpen, opensAt: openStr, closesAt: closeStr, statusText };
      } catch { return { isOpen:false, opensAt:null, closesAt:null, statusText:'Hours unavailable' }; }
    }

    // Global profile helpers (used across details/forms)
    window.__twgProfileKey = 'twg_user_profile_v1';
    function loadUserProfile() {
      try { return JSON.parse(localStorage.getItem(window.__twgProfileKey)||'null'); } catch { return null; }
    }
    function saveUserProfile(p) {
      try { localStorage.setItem(window.__twgProfileKey, JSON.stringify(p||{})); } catch {}
    }
    function attachProfile(obj) {
      const p = loadUserProfile();
      if (p) {
        const fullName = `${p.title? p.title+' ' : ''}${p.name||''}${p.surname? ' '+p.surname : ''}`.trim();
        obj.user = { name: p.name||'', surname: p.surname||'', title: p.title||'', fullName, email: p.email||'', phone: p.phone||'', verified: !!p.verified };
      }
    }

    // Online payment processor (demo)
    async function processOnlinePayment({ cardNumber, cardExpiry, cardCVC, amount }) {
      // In production, integrate Stripe/PayStack/PayFast/etc. here.
      // For demo: validate format and simulate success.
      const cardClean = (cardNumber||'').replace(/\s/g,'');
      const expiryClean = (cardExpiry||'').replace(/\D/g,'');
      const cvcClean = (cardCVC||'').replace(/\D/g,'');
      if (cardClean.length < 13 || expiryClean.length < 4 || cvcClean.length < 3) {
        return false; // invalid
      }
      // Simulate async payment API call
      await new Promise(r => setTimeout(r, 800));
      // Demo: always succeed
      console.log(`Processed payment: R${amount} via card ending ${cardClean.slice(-4)}`);
      return true;
    }

    // Patch: override corrupted functions with clean versions
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => { page.style.display = 'none'; });
      const slideshow = document.querySelector('.slideshow');
      const hero = document.querySelector('.hero');
      if (pageId === 'home') {
        if (slideshow) slideshow.style.display = 'block';
        if (hero) hero.style.display = 'flex';
      } else {
        if (slideshow) slideshow.style.display = 'none';
        if (hero) hero.style.display = 'none';
      }
      const selectedPage = document.getElementById(pageId);
      if (selectedPage) {
        selectedPage.style.display = 'block';
        if (pageId === 'attractions') {
          const cards = document.getElementById('attractionCards');
          const detail = document.getElementById('attractionDetail');
          const searchInput = document.getElementById('attractionSearch');
          if (cards) cards.style.display = 'grid';
          if (detail) detail.style.display = 'none';
          
          // Clear search input and load all attractions immediately
          if (searchInput) {
            searchInput.value = '';
          }
          
          // Load all attractions immediately when page opens
          searchAttractions();
          
          // Focus on search input after loading
          setTimeout(() => {
            if (searchInput) {
              searchInput.focus();
            }
          }, 200);
        }
        if (pageId === 'malls') {
          const cards = document.getElementById('mallCards');
          const detail = document.getElementById('mallDetail');
          const searchInput = document.getElementById('mallSearch');
          if (cards) cards.style.display = 'grid';
          if (detail) detail.style.display = 'none';
          
          // Clear search input and load all malls
          if (searchInput) {
            searchInput.value = '';
            // Attach search listener
            searchInput.removeEventListener('input', searchMalls);
            searchInput.addEventListener('input', searchMalls);
          }
          
          // Load all malls
          searchMalls();
        }
        if (pageId === 'hotels') {
          const cards = document.getElementById('hotelCards');
          const detail = document.getElementById('hotelDetail');
          const searchInput = document.getElementById('hotelSearch');
          if (cards) cards.style.display = 'grid';
          if (detail) detail.style.display = 'none';
          
          // Clear search input and load all hotels
          if (searchInput) {
            searchInput.value = '';
            // Attach search listener
            searchInput.removeEventListener('input', searchHotels);
            searchInput.addEventListener('input', searchHotels);
          }
          
          // Load all hotels
          searchHotels();
        }
      }
      const menuEl = document.getElementById('hamburgerMenu');
      if (menuEl) menuEl.classList.remove('open');
    }

    function showAttractionDetail(attractionId) {
      const attraction = attractionsData[attractionId];
      if (!attraction) return;
      const detailContent = document.getElementById('attractionDetailContent');
      if (!detailContent) return;
      detailContent.innerHTML = `
        <div class="detail-header">
          <img src="${attraction.image}" alt="${attraction.name}" class="detail-image">
          <div class="detail-title">
            <h2>${attraction.name}</h2>
            <p class="detail-location">📍 ${attraction.location}</p>
          </div>
        </div>
        <div class="detail-body">
          <section class="detail-section">
            <h3>About</h3>
            <p>${attraction.description}</p>
          </section>
          <section class="detail-section">
            <h3>Highlights</h3>
            <ul class="highlights-list">
              ${attraction.highlights.map(h => `<li>${h}</li>`).join('')}
            </ul>
          </section>
          <section class="detail-section">
            <h3>Activities</h3>
            <div class="activity-tags">
              ${attraction.activities.map(a => `<span class="tag">${a}</span>`).join('')}
            </div>
          </section>
          <div class="detail-info-grid">
            <section class="detail-section">
              <h3>⏰ Hours</h3>
              <p>${attraction.hours}</p>
            </section>
            <section class="detail-section">
              <h3>💰 Price</h3>
              <p>${attraction.price}</p>
            </section>
          </div>
          <section class="detail-section">
            <h3>🌟 Best Time to Visit</h3>
            <p>${attraction.bestTime}</p>
          </section>
          <section class="detail-section">
            <h3>Book a Visit</h3>
            <form id="attractionBookingForm">
              <div class="form-grid">
                <div class="form-field"><label for="abName">Name</label><input id="abName" name="name" required></div>
                <div class="form-field"><label for="abEmail">Email</label><input id="abEmail" name="email" type="email" required></div>
                <div class="form-field"><label for="abPhone">Phone</label><input id="abPhone" name="phone" type="tel"></div>
                <div class="form-field"><label for="abDate">Preferred date</label><input id="abDate" name="date" type="date"></div>
                <div class="form-field"><label for="abPaymentMethod">Payment</label>
                  <select id="abPaymentMethod" name="paymentMethod" required>
                    <option value="">Select</option>
                    <option value="online">Pay online now</option>
                    <option value="onsite">Pay at property</option>
                  </select>
                </div>
              </div>
              <div id="abOnlinePayment" style="display:none; margin-top:12px;">
                <h4 style="margin:0 0 8px 0; font-size:14px;">Card details</h4>
                <div class="form-grid">
                  <div class="form-field"><label for="abCardNumber">Card number</label><input id="abCardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19"></div>
                  <div class="form-field"><label for="abCardExpiry">Expiry (MM/YY)</label><input id="abCardExpiry" name="cardExpiry" placeholder="12/25" maxlength="5"></div>
                  <div class="form-field"><label for="abCardCVC">CVC</label><input id="abCardCVC" name="cardCVC" placeholder="123" maxlength="4"></div>
                </div>
              </div>
              <div class="form-actions"><button class="btn primary" type="submit">Confirm Booking</button></div>
            </form>
          </section>
        </div>`;
      // Hide main attractions view and show detail view
      const cards = document.getElementById('attractionCards');
      const detail = document.getElementById('attractionDetail');
      const searchContainer = document.querySelector('.search-container');
      const attractionsTitle = document.querySelector('#attractions h2');
      
      if (cards) cards.style.display = 'none';
      if (detail) detail.style.display = 'block';
      if (searchContainer) searchContainer.style.display = 'none';
      if (attractionsTitle) attractionsTitle.style.display = 'none';
      // Prefill from profile and wire submit
      const p = loadUserProfile();
      if (p) {
        const n = document.getElementById('abName'); const e = document.getElementById('abEmail'); const ph = document.getElementById('abPhone');
        const fullName = `${p.title? p.title+' ' : ''}${p.name||''}${p.surname? ' '+p.surname : ''}`.trim();
        if (n && !n.value) n.value = fullName; if (e && !e.value) e.value = p.email||''; if (ph && !ph.value) ph.value = p.phone||'';
      }
      const form = document.getElementById('attractionBookingForm');
      const pmSelect = document.getElementById('abPaymentMethod');
      const onlinePay = document.getElementById('abOnlinePayment');
      pmSelect?.addEventListener('change', () => {
        onlinePay.style.display = (pmSelect.value === 'online') ? 'block' : 'none';
        if (pmSelect.value === 'online') {
          form.querySelector('#abCardNumber')?.setAttribute('required','required');
          form.querySelector('#abCardExpiry')?.setAttribute('required','required');
          form.querySelector('#abCardCVC')?.setAttribute('required','required');
        } else {
          form.querySelector('#abCardNumber')?.removeAttribute('required');
          form.querySelector('#abCardExpiry')?.removeAttribute('required');
          form.querySelector('#abCardCVC')?.removeAttribute('required');
        }
      });
      form?.addEventListener('submit', async (ev) => {
        ev.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        data.itemType = 'attraction'; data.itemKey = attractionId; data.itemName = attraction.name; data.location = attraction.location;
        attachProfile(data);
        if (data.paymentMethod === 'online') {
          // Simulate online payment
          const paymentOk = await processOnlinePayment({ cardNumber: data.cardNumber, cardExpiry: data.cardExpiry, cardCVC: data.cardCVC, amount: 100 });
          if (!paymentOk) { alert('Payment failed. Please check your card details.'); return; }
          data.paymentStatus = 'paid';
        } else {
          data.paymentStatus = 'onsite';
        }
        try {
          const res = await fetch('/.netlify/functions/send-booking', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
          const j = await res.json();
          alert(j?.ok ? (data.paymentMethod==='online'? 'Booking confirmed & paid!' : 'Booking request sent!') : 'Submitted');
        } catch { alert('Booking submitted (demo).'); }
      });
    }

    // Malls: render, detail open/close
    function renderMalls() {
      const wrap = document.getElementById('mallCards');
      if (!wrap) return;
      wrap.innerHTML = (mallsData||[]).map((m,idx) => {
        const st = getMallStatus(m);
        return `
          <div class="card" data-mall="${idx}">
            ${m.image ? `<img src="${m.image}" alt="${m.name}" class="card-image">` : ''}
            <div class="card-content">
              <h3>${m.name}</h3>
              <p>${m.city} • ${m.shops} shops</p>
              <p><span class="badge" style="${st.isOpen?'background:#2e7d32':'background:#9e9e9e'};color:#fff;padding:2px 6px;border-radius:10px;font-size:12px;">${st.statusText}</span></p>
            </div>
          </div>`;
      }).join('');
      wrap.querySelectorAll('[data-mall]').forEach(card => {
        card.addEventListener('click', () => {
          const idx = Number(card.getAttribute('data-mall'));
          showMallDetail(idx);
        });
      });
      // JS image fallback for missing local mall images
      wrap.querySelectorAll('[data-mall] img.card-image').forEach(img => {
        const card = img.closest('[data-mall]');
        const idx = Number(card?.getAttribute('data-mall'));
        const m = (mallsData||[])[idx];
        if (!m) return;
        const fb = mallPlaceholderPool[idx % mallPlaceholderPool.length];
        img.addEventListener('error', () => { img.src = fb; });
        if (img.complete && img.naturalWidth === 0) { img.src = fb; }
      });
    }

    // Mall search functionality
    function searchMalls() {
      const searchTerm = document.getElementById('mallSearch')?.value.toLowerCase().trim() || '';
      const wrap = document.getElementById('mallCards');
      if (!wrap) return;
      
      const filteredMalls = (mallsData || []).filter(m => {
        if (!searchTerm) return true;
        return (m.name || '').toLowerCase().includes(searchTerm) ||
               (m.city || '').toLowerCase().includes(searchTerm) ||
               (m.province || '').toLowerCase().includes(searchTerm);
      });
      
      wrap.innerHTML = filteredMalls.map((m, originalIdx) => {
        const idx = mallsData.indexOf(m);
        const st = getMallStatus(m);
        return `
          <div class="card" data-mall="${idx}">
            ${m.image ? `<img src="${m.image}" alt="${m.name}" class="card-image">` : ''}
            <div class="card-content">
              <h3>${m.name}</h3>
              <p>${m.city} • ${m.shops} shops</p>
              <p><span class="badge" style="${st.isOpen?'background:#2e7d32':'background:#9e9e9e'};color:#fff;padding:2px 6px;border-radius:10px;font-size:12px;">${st.statusText}</span></p>
            </div>
          </div>`;
      }).join('');
      
      wrap.querySelectorAll('[data-mall]').forEach(card => {
        card.addEventListener('click', () => {
          const idx = Number(card.getAttribute('data-mall'));
          showMallDetail(idx);
        });
      });
      
      wrap.querySelectorAll('[data-mall] img.card-image').forEach(img => {
        const card = img.closest('[data-mall]');
        const idx = Number(card?.getAttribute('data-mall'));
        const m = (mallsData||[])[idx];
        if (!m) return;
        const fb = mallPlaceholderPool[idx % mallPlaceholderPool.length];
        img.addEventListener('error', () => { img.src = fb; });
        if (img.complete && img.naturalWidth === 0) { img.src = fb; }
      });
    }

    function showMallDetail(idx) {
      const m = (mallsData||[])[idx];
      if (!m) return;
      showPage('malls');
      const cards = document.getElementById('mallCards');
      const detail = document.getElementById('mallDetail');
      const box = document.getElementById('mallDetailContent');
      if (cards && detail && box) {
        const st = getMallStatus(m);
        cards.style.display = 'none';
        detail.style.display = 'block';
        const hoursRow = (label, spec) => `<div class="hours-row"><span>${label}</span><span>${spec||'Closed'}</span></div>`;
        box.innerHTML = `
          <div class="detail-header">
            ${m.image ? `<img src="${m.image}" alt="${m.name}" class="detail-image">` : ''}
            <div class="detail-title">
              <h2>${m.name}</h2>
              <p class="detail-location">📍 ${m.city}</p>
              <p><span class="badge" style="${st.isOpen?'background:#2e7d32':'background:#9e9e9e'};color:#fff;padding:4px 8px;border-radius:10px;font-size:12px;">${st.statusText}</span></p>
            </div>
          </div>
          <div class="detail-body">
            <section class="detail-section"><h3>About</h3><p>${m.name} features approximately ${m.shops} shops in ${m.city}. Browse fashion, food, entertainment and services all under one roof.</p></section>
            <div class="detail-info-grid">
              <section class="detail-section"><h3>Shops</h3><p>${m.shops}+ stores</p></section>
              <section class="detail-section"><h3>Status</h3><p>${st.isOpen? 'Open' : 'Closed'} ${st.closesAt? `• Closes ${st.closesAt}` : ''}</p></section>
            </div>
            <section class="detail-section">
              <h3>Opening Hours</h3>
              <div class="hours-grid">
                ${hoursRow('Mon', m.hours?.mon)}
                ${hoursRow('Tue', m.hours?.tue)}
                ${hoursRow('Wed', m.hours?.wed)}
                ${hoursRow('Thu', m.hours?.thu)}
                ${hoursRow('Fri', m.hours?.fri)}
                ${hoursRow('Sat', m.hours?.sat)}
                ${hoursRow('Sun', m.hours?.sun)}
              </div>
            </section>
          </div>
        `;
        const imgEl = detail.querySelector('.detail-image');
        if (imgEl) {
          const fb = mallPlaceholderPool[idx % mallPlaceholderPool.length];
          imgEl.addEventListener('error', () => { imgEl.src = fb; });
          if (imgEl.complete && imgEl.naturalWidth === 0) { imgEl.src = fb; }
        }
      }
    }

    function closeMallDetail() {
      const cards = document.getElementById('mallCards');
      const detail = document.getElementById('mallDetail');
      if (cards && detail) { cards.style.display = 'grid'; detail.style.display = 'none'; }
    }
    
    // Function to show malls list - ensure it's globally accessible
    window.showMallsList = function() {
      console.log('Showing malls list...');
      
      // Make sure we're on the malls page
      showPage('malls');
      
      // Use setTimeout to ensure page transition is complete
      setTimeout(() => {
        // Hide detail view and show cards
        const cards = document.getElementById('mallCards');
        const detail = document.getElementById('mallDetail');
        
        if (cards && detail) {
          detail.style.display = 'none';
          cards.style.display = 'grid';
          
          // Ensure malls are rendered
          if (typeof renderMalls === 'function') {
            renderMalls();
          }
          
          console.log('Malls list displayed successfully');
        } else {
          console.error('Mall cards or detail elements not found');
        }
        
        // Close any open side panels
        const sidePanel = document.querySelector('.side-panel');
        if (sidePanel) {
          sidePanel.classList.remove('open');
        }
      }, 100);
    };

    // Hotels: render, detail open/close
    function renderHotels() {
      const wrap = document.getElementById('hotelCards');
      if (!wrap) return;
      wrap.innerHTML = (hotelsData||[]).map((h,idx) => `
        <div class="card" data-hotel="${idx}">
          ${h.image ? `<img src="${h.image}" alt="${h.name}" class="card-image">` : ''}
          <div class="card-content">
            <h3>${h.name}</h3>
            <p>${h.city} • <span class="stars">${'★'.repeat(h.rating)}</span></p>
          </div>
        </div>
      `).join('');
      wrap.querySelectorAll('[data-hotel]').forEach(card => {
        card.addEventListener('click', () => {
          const idx = Number(card.getAttribute('data-hotel'));
          showHotelDetail(idx);
        });
      });
    }

    // Hotel search functionality
    function searchHotels() {
      const searchTerm = document.getElementById('hotelSearch')?.value.toLowerCase().trim() || '';
      const wrap = document.getElementById('hotelCards');
      if (!wrap) return;
      
      const filteredHotels = (hotelsData || []).filter(h => {
        if (!searchTerm) return true;
        return (h.name || '').toLowerCase().includes(searchTerm) ||
               (h.city || '').toLowerCase().includes(searchTerm);
      });
      
      wrap.innerHTML = filteredHotels.map(h => {
        const idx = hotelsData.indexOf(h);
        return `
          <div class="card" data-hotel="${idx}">
            ${h.image ? `<img src="${h.image}" alt="${h.name}" class="card-image">` : ''}
            <div class="card-content">
              <h3>${h.name}</h3>
              <p>${h.city} • <span class="stars">${'★'.repeat(h.rating)}</span></p>
            </div>
          </div>
        `;
      }).join('');
      
      wrap.querySelectorAll('[data-hotel]').forEach(card => {
        card.addEventListener('click', () => {
          const idx = Number(card.getAttribute('data-hotel'));
          showHotelDetail(idx);
        });
      });
    }

    function showHotelDetail(idx) {
      const h = (hotelsData||[])[idx];
      if (!h) return;
      showPage('hotels');
      const cards = document.getElementById('hotelCards');
      const detail = document.getElementById('hotelDetail');
      const box = document.getElementById('hotelDetailContent');
      if (cards && detail && box) {
        cards.style.display = 'none';
        detail.style.display = 'block';
        box.innerHTML = `
          <div class="detail-header">
            ${h.image ? `<img src="${h.image}" alt="${h.name}" class="detail-image">` : ''}
            <div class="detail-title">
              <h2>${h.name}</h2>
              <p class="detail-location">📍 ${h.city}</p>
            </div>
          </div>
          <div class="detail-body">
            <section class="detail-section"><h3>About</h3><p>Experience comfort at ${h.name} in ${h.city}. Premium amenities and great locations.</p></section>
            <div class="detail-info-grid">
              <section class="detail-section"><h3>Rating</h3><p><span class="stars">${'★'.repeat(h.rating)}</span></p></section>
            </div>
            <section class="detail-section">
              <h3>Book this hotel</h3>
              <form id="hotelBookingForm">
                <div class="form-grid">
                  <div class="form-field"><label for="hbName">Name</label><input id="hbName" name="name" required></div>
                  <div class="form-field"><label for="hbEmail">Email</label><input id="hbEmail" name="email" type="email" required></div>
                  <div class="form-field"><label for="hbCheckIn">Check-in</label><input id="hbCheckIn" name="checkin" type="date" required></div>
                  <div class="form-field"><label for="hbCheckOut">Check-out</label><input id="hbCheckOut" name="checkout" type="date" required></div>
                  <div class="form-field"><label for="hbGuests">Guests</label><select id="hbGuests" name="guests"><option>1</option><option>2</option><option>3</option><option>4</option></select></div>
                  <div class="form-field"><label for="hbPaymentMethod">Payment</label>
                    <select id="hbPaymentMethod" name="paymentMethod" required>
                      <option value="">Select</option>
                      <option value="online">Pay online now</option>
                      <option value="onsite">Pay at property</option>
                    </select>
                  </div>
                </div>
                <div id="hbOnlinePayment" style="display:none; margin-top:12px;">
                  <h4 style="margin:0 0 8px 0; font-size:14px;">Card details</h4>
                  <div class="form-grid">
                    <div class="form-field"><label for="hbCardNumber">Card number</label><input id="hbCardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19"></div>
                    <div class="form-field"><label for="hbCardExpiry">Expiry (MM/YY)</label><input id="hbCardExpiry" name="cardExpiry" placeholder="12/25" maxlength="5"></div>
                    <div class="form-field"><label for="hbCardCVC">CVC</label><input id="hbCardCVC" name="cardCVC" placeholder="123" maxlength="4"></div>
                  </div>
                </div>
                <div class="form-actions"><button class="btn primary" type="submit">Confirm Booking</button></div>
              </form>
            </section>
          </div>
        `;
        const form = document.getElementById('hotelBookingForm');
        // Prefill from profile
        const p = loadUserProfile();
        if (p) {
          const fullName = `${p.title? p.title+' ' : ''}${p.name||''}${p.surname? ' '+p.surname : ''}`.trim();
          const n = form.querySelector('#hbName'); const e = form.querySelector('#hbEmail');
          if (n && !n.value) n.value = fullName; if (e && !e.value) e.value = p.email||'';
        }
        const pmSelect = document.getElementById('hbPaymentMethod');
        const onlinePay = document.getElementById('hbOnlinePayment');
        pmSelect?.addEventListener('change', () => {
          onlinePay.style.display = (pmSelect.value === 'online') ? 'block' : 'none';
          if (pmSelect.value === 'online') {
            form.querySelector('#hbCardNumber')?.setAttribute('required','required');
            form.querySelector('#hbCardExpiry')?.setAttribute('required','required');
            form.querySelector('#hbCardCVC')?.setAttribute('required','required');
          } else {
            form.querySelector('#hbCardNumber')?.removeAttribute('required');
            form.querySelector('#hbCardExpiry')?.removeAttribute('required');
            form.querySelector('#hbCardCVC')?.removeAttribute('required');
          }
        });
        form?.addEventListener('submit', async (e) => {
          e.preventDefault();
          const data = Object.fromEntries(new FormData(form).entries());
          data.itemType = 'hotel'; data.itemKey = String(idx); data.itemName = h.name; data.city = h.city;
          attachProfile(data);
          if (data.paymentMethod === 'online') {
            const paymentOk = await processOnlinePayment({ cardNumber: data.cardNumber, cardExpiry: data.cardExpiry, cardCVC: data.cardCVC, amount: 200 });
            if (!paymentOk) { alert('Payment failed. Please check your card details.'); return; }
            data.paymentStatus = 'paid';
          } else {
            data.paymentStatus = 'onsite';
          }
          try {
            const res = await fetch('/.netlify/functions/send-booking', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
            const j = await res.json();
            alert(j?.ok ? (data.paymentMethod==='online'? 'Booking confirmed & paid!' : 'Booking request sent!') : 'Submitted');
          } catch { alert('Booking submitted (demo).'); }
        });
      }
    }

    function closeHotelDetail() {
      const cards = document.getElementById('hotelCards');
      const detail = document.getElementById('hotelDetail');
      if (cards && detail) { cards.style.display = 'grid'; detail.style.display = 'none'; }
    }

    // Generic place detail (airports, car rentals)
    function openPlaceDetail(place) {
      showPage('place');
      document.getElementById('placeTitle').textContent = place.title || 'Place';
      const box = document.getElementById('placeDetailContent');
      const avatar = place.image ? `<img src="${place.image}" alt="${place.title}" class="detail-image">` : '';
      box.innerHTML = `
        <div class="detail-header">
          ${avatar}
          <div class="detail-title">
            <h2>${place.title}</h2>
            <p class="detail-location">${place.subtitle||''}</p>
          </div>
        </div>
        <div class="detail-body">
          <section class="detail-section"><h3>About</h3><p>Information for ${place.title} ${place.subtitle? '— '+place.subtitle:''}.</p></section>
          <section class="detail-section"><h3>Contact & Booking</h3>
            <form id="placeBookingForm">
              <div class="form-grid">
                  <div class="form-field"><label for="pbName">Name</label><input id="pbName" name="name" required></div>
                  <div class="form-field"><label for="pbEmail">Email</label><input id="pbEmail" name="email" type="email" required></div>
                  <div class="form-field"><label for="pbPhone">Phone</label><input id="pbPhone" name="phone" type="tel"></div>
                <div class="form-field"><label for="pbDate">Date</label><input id="pbDate" name="date" type="date"></div>
                <div class="form-field"><label for="pbMessage">Message</label><input id="pbMessage" name="message" placeholder="Your request"></div>
                <div class="form-field"><label for="pbPaymentMethod">Payment</label>
                  <select id="pbPaymentMethod" name="paymentMethod" required>
                    <option value="">Select</option>
                    <option value="online">Pay online now</option>
                    <option value="onsite">Pay at location</option>
                  </select>
                </div>
              </div>
              <div id="pbOnlinePayment" style="display:none; margin-top:12px;">
                <h4 style="margin:0 0 8px 0; font-size:14px;">Card details</h4>
                <div class="form-grid">
                  <div class="form-field"><label for="pbCardNumber">Card number</label><input id="pbCardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19"></div>
                  <div class="form-field"><label for="pbCardExpiry">Expiry (MM/YY)</label><input id="pbCardExpiry" name="cardExpiry" placeholder="12/25" maxlength="5"></div>
                  <div class="form-field"><label for="pbCardCVC">CVC</label><input id="pbCardCVC" name="cardCVC" placeholder="123" maxlength="4"></div>
                </div>
              </div>
              <div class="form-actions"><button class="btn primary" type="submit">Confirm Request</button></div>
            </form>
          </section>
        </div>
      `;
        // Prefill from profile
        const p = loadUserProfile();
        if (p) {
          const n = document.getElementById('pbName'); const e = document.getElementById('pbEmail'); const ph = document.getElementById('pbPhone');
          const fullName = `${p.title? p.title+' ' : ''}${p.name||''}${p.surname? ' '+p.surname : ''}`.trim();
          if (n && !n.value) n.value = fullName; if (e && !e.value) e.value = p.email||''; if (ph && !ph.value) ph.value = p.phone||'';
        }
      const form = document.getElementById('placeBookingForm');
      const pmSelect = document.getElementById('pbPaymentMethod');
      const onlinePay = document.getElementById('pbOnlinePayment');
      pmSelect?.addEventListener('change', () => {
        onlinePay.style.display = (pmSelect.value === 'online') ? 'block' : 'none';
        if (pmSelect.value === 'online') {
          form.querySelector('#pbCardNumber')?.setAttribute('required','required');
          form.querySelector('#pbCardExpiry')?.setAttribute('required','required');
          form.querySelector('#pbCardCVC')?.setAttribute('required','required');
        } else {
          form.querySelector('#pbCardNumber')?.removeAttribute('required');
          form.querySelector('#pbCardExpiry')?.removeAttribute('required');
          form.querySelector('#pbCardCVC')?.removeAttribute('required');
        }
      });
      form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        data.itemType = place.type; data.itemKey = place.key || ''; data.itemName = place.title; data.subtitle = place.subtitle||'';
          attachProfile(data);
        if (data.paymentMethod === 'online') {
          const paymentOk = await processOnlinePayment({ cardNumber: data.cardNumber, cardExpiry: data.cardExpiry, cardCVC: data.cardCVC, amount: 50 });
          if (!paymentOk) { alert('Payment failed. Please check your card details.'); return; }
          data.paymentStatus = 'paid';
        } else {
          data.paymentStatus = 'onsite';
        }
        try {
          const res = await fetch('/.netlify/functions/send-booking', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
          const j = await res.json();
          alert(j?.ok ? (data.paymentMethod==='online'? 'Request confirmed & paid!' : 'Request sent!') : 'Submitted');
        } catch { alert('Request submitted (demo).'); }
      });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      // Add click handlers to attraction cards
      document.querySelectorAll('.card[data-attraction]').forEach(card => {
        card.addEventListener('click', () => {
          const attractionId = card.getAttribute('data-attraction');
          showAttractionDetail(attractionId);
        });
      });
      // Render hotels dataset for Hotels page
      renderHotels();
      // Render malls dataset for Malls page
      renderMalls();

      // Auth state helpers
      // Profile helpers defined globally above

      // Auth UI wiring
      const authModal = document.getElementById('authModal');
      const authTitle = document.getElementById('authTitle');
      const authForm = document.getElementById('authForm');
      const authMsg = document.getElementById('authMsg');
      const nameRow = document.getElementById('authNameRow');
      const surnameRow = document.getElementById('authSurnameRow');
      const titleInput = document.getElementById('authTitleSelect');
      const passRow = document.getElementById('authPassRow');
      const pass2Row = document.getElementById('authPass2Row');
      const passInput = document.getElementById('authPassword');
      const pass2Input = document.getElementById('authPassword2');
      const surnameInput = document.getElementById('authSurname');
      const remember = document.getElementById('authRemember');
      const sendBtn = document.getElementById('authSendOtp');
      const otpRow = document.getElementById('otpRow');
      const otpActions = document.getElementById('otpActions');
      const loginAction = document.getElementById('authLoginAction');
      const closeBtn = authModal.querySelector('.dd-close');
      let authMode = 'signin'; // signin | login
      let pendingOtp = '';

      async function hashPassword(pwd) {
        try {
          const enc = new TextEncoder().encode(pwd||'');
          const buf = await crypto.subtle.digest('SHA-256', enc);
          return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
        } catch { return 'plain:' + (pwd||''); }
      }

      function openAuth(mode='signin') {
        authMode = mode;
        authTitle.textContent = mode === 'signin' ? 'Sign in' : 'Log in';
        nameRow.style.display = 'block';
        surnameRow.style.display = 'block';
        // Title always visible
        passRow.style.display = 'block';
        pass2Row.style.display = mode === 'signin' ? 'block' : 'none';
        passInput.value = '';
        pass2Input.value = '';
        passInput.required = true;
        pass2Input.required = (mode === 'signin');
        otpRow.style.display = 'none'; otpActions.style.display = 'none'; pendingOtp = '';
        authMsg.textContent = '';
        const p = loadUserProfile();
        if (p) {
          if (titleInput) titleInput.value = p.title||'';
          authForm.querySelector('#authName').value = p.name||'';
          surnameInput.value = p.surname||'';
          authForm.querySelector('#authEmail').value = p.email||'';
          authForm.querySelector('#authPhone').value = p.phone||'';
          remember.checked = true;
        } else {
          authForm.reset();
        }
        // Set bottom action label
        if (loginAction) loginAction.textContent = (mode === 'signin') ? 'Create Account' : 'Log in';
        authModal.style.display = 'block';
      }
      function closeAuth() { authModal.style.display = 'none'; }

      document.getElementById('signupBtn')?.addEventListener('click', () => openAuth('signin'));
      document.getElementById('loginBtn')?.addEventListener('click', () => openAuth('login'));
      closeBtn?.addEventListener('click', closeAuth);
      document.addEventListener('click', (e) => { if (authModal.style.display==='block' && !authModal.contains(e.target) && !e.target.closest('#signupBtn,#loginBtn')) closeAuth(); });

      async function sendOtp(email, phone) {
        try {
          const res = await fetch('/.netlify/functions/send-otp', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, phone }) });
          const j = await res.json();
          return j?.otp || '';
        } catch {
          // Demo fallback: generate locally
          return String(Math.floor(100000 + Math.random()*900000));
        }
      }

      sendBtn?.addEventListener('click', async () => {
        const fd = new FormData(authForm);
        const title = fd.get('title')?.toString().trim()||'';
        const name = fd.get('name')?.toString().trim()||'';
        const surname = fd.get('surname')?.toString().trim()||'';
        const email = fd.get('email')?.toString().trim()||'';
        const phone = fd.get('phone')?.toString().trim()||'';
        if (!email) { authMsg.textContent = 'Please enter your email.'; return; }
        pendingOtp = await sendOtp(email, phone);
        otpRow.style.display = 'block'; otpActions.style.display = 'flex';
        authMsg.textContent = `OTP sent to ${email}${phone? ' and '+phone: ''} (demo)`;
        if (remember.checked) saveUserProfile({ title, name, surname, email, phone, verified:false });
      });

      document.getElementById('authResend')?.addEventListener('click', async () => {
        const email = authForm.querySelector('#authEmail').value.trim();
        const phone = authForm.querySelector('#authPhone').value.trim();
        pendingOtp = await sendOtp(email, phone);
        authMsg.textContent = 'OTP re-sent (demo).';
      });

      document.getElementById('authVerify')?.addEventListener('click', () => {
        const code = (authForm.querySelector('#authOtp').value||'').trim();
        if (!code) { authMsg.textContent = 'Enter the OTP code.'; return; }
        if (pendingOtp && code === pendingOtp) {
          const p = loadUserProfile() || {};
          p.title = titleInput?.value || p.title || '';
          p.name = authForm.querySelector('#authName').value.trim() || p.name || '';
          p.surname = surnameInput?.value.trim() || p.surname || '';
          p.email = authForm.querySelector('#authEmail').value.trim() || p.email || '';
          p.phone = authForm.querySelector('#authPhone').value.trim() || p.phone || '';
          p.verified = true; saveUserProfile(p);
          authMsg.textContent = 'Verified! You are signed in.';
          setTimeout(closeAuth, 700);
          updateAuthBadges();
        } else {
          authMsg.textContent = 'Invalid code. Try again or resend.';
        }
      });

      // Password-based actions
      loginAction?.addEventListener('click', async () => {
        const fd = new FormData(authForm);
        const title = (fd.get('title')||'').toString().trim();
        const name = (fd.get('name')||'').toString().trim();
        const surname = (fd.get('surname')||'').toString().trim();
        const email = (fd.get('email')||'').toString().trim();
        const phone = (fd.get('phone')||'').toString().trim();
        const pwd = (fd.get('password')||'').toString();
        const pwd2 = (fd.get('password2')||'').toString();
        if (!email) { authMsg.textContent = 'Please enter your email.'; return; }
        if (authMode === 'login') {
          if (!pwd) { authMsg.textContent = 'Enter your password.'; return; }
          const p = loadUserProfile();
          if (!p || !p.email || !p.pwdHash) { authMsg.textContent = 'No saved account. Please Sign in first.'; return; }
          if (p.email !== email) { authMsg.textContent = 'Email does not match saved account.'; return; }
          const h = await hashPassword(pwd);
          if (h === p.pwdHash) {
            // update optional profile props if provided
            if (title) p.title = title;
            if (name) p.name = name;
            if (surname) p.surname = surname;
            p.verified = true; saveUserProfile(p);
            authMsg.textContent = 'Logged in successfully.';
            setTimeout(closeAuth, 600); updateAuthBadges();
          } else {
            authMsg.textContent = 'Incorrect password.';
          }
        } else {
          // signin (create account)
          if (name.length < 2) { authMsg.textContent = 'Please enter your first name.'; return; }
          if (surname.length < 2) { authMsg.textContent = 'Please enter your surname.'; return; }
          if (!pwd || pwd.length < 6) { authMsg.textContent = 'Create a password of at least 6 characters.'; return; }
          if (pwd !== pwd2) { authMsg.textContent = 'Passwords do not match.'; return; }
          const p = { title, name, surname, email, phone, verified: false };
          p.pwdHash = await hashPassword(pwd);
          saveUserProfile(p);
          authMsg.textContent = 'Account created. Please verify via OTP.';
          // Auto-send OTP to streamline flow
          try {
            pendingOtp = await sendOtp(email, phone);
            otpRow.style.display = 'block'; otpActions.style.display = 'flex';
          } catch {}
          updateAuthBadges();
        }
      });

      // Badge/Buttons update
      function updateAuthBadges() {
        const p = loadUserProfile();
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        if (p?.verified) {
          if (signupBtn) signupBtn.textContent = 'My Account';
          if (loginBtn) loginBtn.textContent = 'Sign out';
          loginBtn?.addEventListener('click', (e) => {
            // sign out
            e.preventDefault();
            localStorage.removeItem(window.__twgProfileKey);
            updateAuthBadges();
          }, { once:true });
        } else {
          if (signupBtn) signupBtn.textContent = 'Sign in';
          if (loginBtn) loginBtn.textContent = 'Login';
        }
      }
      updateAuthBadges();

      // Intercept toolbar/home buttons: stack panels on Home instead of navigating
      const homeStack = document.getElementById('homeStack');
      const inlineRoutes = new Set(['cars','flights','explore']);
      const directPageRoutes = new Set(['hotels','malls']);
      const toolbarDropdown = document.getElementById('toolbarDropdown');
      let dropdownKind = null;
      let dropdownAnchor = null;

      document.querySelectorAll('[data-route]').forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          const route = item.getAttribute('data-route');
          const isTopNav = item.classList.contains('nav-item');
          const isGoldButton = item.classList.contains('cta');
          
          console.log('Route clicked:', route, 'isTopNav:', isTopNav);
          
          // Always handle Home: navigate to Home and scroll to top
          if (route === 'home') {
            try { closeToolbarDropdown(); } catch {}
            showPage('home');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return;
          }
          
          // Search button should open dropdown
          if (route === 'search' && isTopNav) {
            console.log('Opening search dropdown for toolbar search');
            openToolbarDropdown(route, item);
            return;
          }
          
          // Toolbar nav "Attractions" should open dropdown
          if (route === 'attractions' && isTopNav) {
            openToolbarDropdown(route, item);
            return;
          }
          
          // Toolbar nav "Explore" should open dropdown
          if (route === 'explore' && isTopNav) {
            openToolbarDropdown(route, item);
            return;
          }
          
          // Gold button for attractions goes directly to page
          if (isGoldButton && route === 'attractions') {
            try { closeToolbarDropdown(); } catch {}
            showPage(route);
            return;
          }
          
          // Gold buttons for hotels/malls go directly to page
          if (isGoldButton && directPageRoutes.has(route)) {
            try { closeToolbarDropdown(); } catch {}
            showPage(route);
            return;
          }
          
          // Other gold buttons (CTA) should open side panels
          if (isGoldButton && inlineRoutes.has(route)) {
            openSidePanel(route);
            return;
          }
          
          if (isTopNav && inlineRoutes.has(route)) {
            openToolbarDropdown(route, item);
            return;
          }
          if (inlineRoutes.has(route)) {
            showPage('home');
            addHomePanel(route);
          } else {
            showPage(route);
          }
        });
      });

      // Side Panel System Functions
      const sidePanelOverlay = document.getElementById('sidePanelOverlay');
      const sidePanel = document.getElementById('sidePanel');
      const sidePanelTitle = document.getElementById('sidePanelTitle');
      const sidePanelContent = document.getElementById('sidePanelContent');
      const sidePanelClose = document.getElementById('sidePanelClose');
      
      // Debug: Check if elements exist
      console.log('Side panel elements check:');
      console.log('sidePanelOverlay:', !!sidePanelOverlay);
      console.log('sidePanel:', !!sidePanel);
      console.log('sidePanelTitle:', !!sidePanelTitle);
      console.log('sidePanelContent:', !!sidePanelContent);
      console.log('sidePanelClose:', !!sidePanelClose);
      
      // Make openSidePanel globally accessible
      window.openSidePanel = function(type) {
        console.log('Opening side panel:', type); // Debug log
        
        const sidePanelOverlay = document.getElementById('sidePanelOverlay');
        const sidePanel = document.getElementById('sidePanel');
        const sidePanelTitle = document.getElementById('sidePanelTitle');
        const sidePanelContent = document.getElementById('sidePanelContent');
        
        const panelConfigs = {
          explore: {
            title: '🔍 Explore South Africa',
            content: generateExploreContent(),
            className: 'panel-explore'
          },
          hotels: {
            title: '🏨 Hotels & Accommodation',
            content: generateHotelsContent(),
            className: 'panel-hotels'
          },
          attractions: {
            title: '🎭 Top Attractions',
            content: generateAttractionsContent(),
            className: 'panel-attractions'
          },
          malls: {
            title: '🛍️ Shopping Malls',
            content: generateMallsContent(),
            className: 'panel-malls'
          },
          cars: {
            title: '🚗 Car Rentals',
            content: generateCarsContent(),
            className: 'panel-cars'
          },
          flights: {
            title: '✈️ Book Flights',
            content: generateFlightsContent(),
            className: 'panel-flights'
          },
          ride: {
            title: '🚕 Request a Ride',
            content: generateRideContent(),
            className: 'panel-ride'
          }
        };
        
        const config = panelConfigs[type];
        if (!config) {
          console.error('No panel config found for type:', type);
          return;
        }
        
        console.log('Panel config found, updating content');
        
        // Remove any existing panel classes
        if (sidePanel) {
          sidePanel.className = sidePanel.className.replace(/panel-\w+/g, '').trim();
          sidePanel.classList.add('side-panel', config.className);
          console.log('Panel classes applied:', sidePanel.className);
          console.log('Panel should have background:', config.className);
        }
        
        if (sidePanelTitle) sidePanelTitle.textContent = config.title;
        if (sidePanelContent) sidePanelContent.innerHTML = config.content;
        
        // Apply background image directly as fallback
        const backgroundImages = {
          'panel-explore': 'images/capetown_1.jpg',
          'panel-hotels': 'images/capetown_2.jpg',
          'panel-attractions': 'images/safari_1.jpg',
          'panel-malls': 'images/durban_1.jpg',
          'panel-cars': 'images/safari_2.jpg',
          'panel-flights': 'images/capetown_1.jpg',
          'panel-ride': 'images/durban_1.jpg'
        };
        
        if (sidePanel && backgroundImages[config.className]) {
          const bgImage = backgroundImages[config.className];
          sidePanel.style.backgroundImage = `
            linear-gradient(135deg, rgba(10, 61, 110, 0.85), rgba(26, 84, 144, 0.85), rgba(45, 107, 176, 0.85)), 
            url('${bgImage}')
          `;
          sidePanel.style.backgroundSize = 'cover';
          sidePanel.style.backgroundPosition = 'center';
          sidePanel.style.backgroundRepeat = 'no-repeat';
          console.log('Background image applied:', bgImage);
        }
        
        if (sidePanelOverlay) {
          sidePanelOverlay.classList.add('active');
          console.log('Panel should now be visible with background:', config.className);
        } else {
          console.error('sidePanelOverlay element not found');
        }
        
        // Initialize any interactive elements if needed
        console.log('Side panel opened successfully');
      };
      
      function closeSidePanel() {
        console.log('Closing side panel'); // Debug log
        if (sidePanelOverlay) {
          sidePanelOverlay.classList.remove('active');
        } else {
          console.error('sidePanelOverlay element not found when trying to close');
        }
      }
      
      // Make closeSidePanel globally accessible
      window.closeSidePanel = closeSidePanel;
      
      // Side panel event listeners
      if (sidePanelClose) {
        sidePanelClose.addEventListener('click', closeSidePanel);
      } else {
        console.error('sidePanelClose element not found for event listener');
      }
      
      if (sidePanelOverlay) {
        sidePanelOverlay.addEventListener('click', (e) => {
          if (e.target === sidePanelOverlay) {
            closeSidePanel();
          }
        });
      } else {
        console.error('sidePanelOverlay element not found for event listener');
      }
      
      // ESC key to close panel
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && sidePanelOverlay.classList.contains('active')) {
          closeSidePanel();
        }
      });

      // Logo click behaves like Home + scroll to top
      const brand = document.getElementById('brandLogo');
      if (brand) {
        const goHomeTop = () => { try { closeToolbarDropdown(); } catch {} showPage('home'); window.scrollTo({ top: 0, behavior: 'smooth' }); };
        brand.addEventListener('click', goHomeTop);
        brand.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); goHomeTop(); } });
      }

      function openToolbarDropdown(kind, anchor) {
        console.log('Opening toolbar dropdown:', kind);
        dropdownKind = kind;
        dropdownAnchor = anchor;
        renderToolbarDropdown(kind);
        positionDropdown(anchor);
        toolbarDropdown.style.display = 'block';
      }

      function closeToolbarDropdown() {
        toolbarDropdown.style.display = 'none';
        toolbarDropdown.innerHTML = '';
        dropdownKind = null;
        dropdownAnchor = null;
      }

      function positionDropdown(anchor) {
        const r = anchor.getBoundingClientRect();
        const dd = toolbarDropdown;
        const padding = 8;
        const top = r.bottom + window.scrollY + 8;
        let left = r.left + window.scrollX;
        
        // Mobile responsive width
        const isMobile = window.innerWidth < 768;
        if (isMobile) {
          dd.style.maxWidth = 'calc(100vw - 24px)';
          dd.style.left = '12px';
          dd.style.right = '12px';
          dd.style.width = 'auto';
        } else {
          dd.style.maxWidth = '420px';
          dd.style.left = left + 'px';
          dd.style.right = 'auto';
          dd.style.width = '';
        }
        
        dd.style.top = top + 'px';
        
        // Ensure within viewport on desktop
        if (!isMobile) {
          setTimeout(() => {
            const ddRect = dd.getBoundingClientRect();
            const overflowX = (ddRect.right) - window.innerWidth + padding;
            if (overflowX > 0) {
              left = Math.max(12, left - overflowX);
              dd.style.left = left + 'px';
            }
          }, 10);
        }
      }

      function renderToolbarDropdown(kind) {
        const titleMap = { attractions: 'Attractions', hotels: 'Hotels', cars: 'Rent a Car', flights: 'Book a Flight', explore: 'Explore', search: 'Search' };
        let inner = `<div class="dd-header"><span class="dd-title">${titleMap[kind] || kind}</span><button class="dd-close" aria-label="Close">✕</button></div>`;
        if (kind === 'attractions') {
          // Add search functionality to attractions dropdown
          inner += `
            <div class="dd-search">
              <input id="attractionsDropdownSearch" class="search-input" type="search" placeholder="Search attractions across South Africa..." autocomplete="off">
            </div>`;
          const items = Object.entries(attractionsData||{}).map(([key,a]) => ({ key, name:a.name, location:a.location, image:a.image }));
          inner += '<ul id="attractionsDropdownList" class="dd-list">';
          items.forEach(i => {
            inner += '<li><button class="dropdown-item" data-action="open-attraction" data-key="' + i.key + '">';
            inner += '<div class="dd-item">';
            inner += '<div class="dd-avatar">';
            if (i.image) {
              inner += '<img src="' + i.image + '" alt="' + i.name + '">';
            } else {
              inner += '🎭';
            }
            inner += '</div>';
            inner += '<div class="dd-text"><h4>' + i.name + '</h4><small>' + (i.location||'') + '</small></div>';
            inner += '</div></button></li>';
          });
          inner += '</ul>';
        } else if (kind === 'hotels') {
          inner += '<ul class="dd-list">';
          (hotelsData||[]).forEach((h,idx) => {
            inner += '<li><button class="dropdown-item" data-action="open-hotels" data-idx="' + idx + '">';
            inner += '<div class="dd-item">';
            inner += '<div class="dd-avatar">';
            if (h.image) {
              inner += '<img src="' + h.image + '" alt="' + h.name + '">';
            } else {
              inner += '🏨';
            }
            inner += '</div>';
            inner += '<div class="dd-text"><h4>' + h.name + '</h4><small>' + h.city + ' • <span class="stars">' + '★'.repeat(h.rating) + '</span></small></div>';
            inner += '</div></button></li>';
          });
          inner += '</ul>';
        } else if (kind === 'cars') {
          inner += `
            <form id=\"ddCarForm\" class=\"dd-form\">
              <input name=\"pickup\" list=\"sa-airports\" placeholder=\"Pick-up\" required>
              <input name=\"from\" type=\"date\" required>
              <button class=\"btn primary\" type=\"submit\">Search</button>
            </form>`;
        } else if (kind === 'flights') {
          inner += `
            <form id=\"ddFlightForm\" class=\"dd-form\">
              <input name=\"from\" list=\"sa-airports\" placeholder=\"From\" required>
              <input name=\"to\" list=\"sa-airports\" placeholder=\"To\" required>
              <input name=\"depart\" type=\"date\" required>
              <button class=\"btn primary\" type=\"submit\">Search</button>
            </form>`;
        } else if (kind === 'search') {
          inner += `
            <div class="dd-search">
              <input id="liveSearch" class="search-input" type="search" placeholder="Search attractions, hotels, malls, airports, cars..." autocomplete="off">
              <button id="liveSearchBtn" class="search-btn" type="button">🔍</button>
            </div>
            <div id="searchResults" class="search-results-dropdown"></div>`;
        }
        toolbarDropdown.innerHTML = inner;

        // Bind events
        toolbarDropdown.querySelector('.dd-close')?.addEventListener('click', closeToolbarDropdown);

        // Add search functionality for search dropdown
        if (kind === 'search') {
          const liveSearchInput = document.getElementById('liveSearch');
          const liveSearchBtn = document.getElementById('liveSearchBtn');
          if (liveSearchInput) {
            let searchTimeout;
            
            liveSearchInput.addEventListener('input', function() {
              clearTimeout(searchTimeout);
              searchTimeout = setTimeout(() => {
                if (typeof window.performLiveSearch === 'function') {
                  window.performLiveSearch();
                }
              }, 300);
            });

            if (liveSearchBtn) {
              liveSearchBtn.addEventListener('click', function() {
                if (typeof window.performLiveSearch === 'function') {
                  window.performLiveSearch();
                }
              });
            }

            liveSearchInput.addEventListener('focus', function() {
              if (this.value.trim().length >= 1) {
                const searchResults = document.getElementById('searchResults');
                if (searchResults) {
                  searchResults.style.display = 'block';
                }
              }
            });

            // Focus the search input when dropdown opens
            setTimeout(() => liveSearchInput.focus(), 100);
          }
        }

        // Add search functionality for attractions dropdown
        if (kind === 'attractions') {
          const searchInput = document.getElementById('attractionsDropdownSearch');
          const resultsList = document.getElementById('attractionsDropdownList');
          
          function filterAttractions(query = '') {
            const items = Object.entries(attractionsData||{}).map(([key,a]) => ({ key, name:a.name, location:a.location, image:a.image }));
            const filtered = query.trim() === '' ? items : items.filter(item => 
              item.name.toLowerCase().includes(query.toLowerCase()) ||
              item.location.toLowerCase().includes(query.toLowerCase())
            );
            
            resultsList.innerHTML = '';
            filtered.forEach(i => {
              const li = document.createElement('li');
              li.innerHTML = `<button class="dropdown-item" data-action="open-attraction" data-key="${i.key}">
                <div class="dd-item">
                  <div class="dd-avatar">
                    ${i.image ? `<img src="${i.image}" alt="${i.name}">` : '🎭'}
                  </div>
                  <div class="dd-text"><h4>${i.name}</h4><small>${i.location||''}</small></div>
                </div>
              </button>`;
              resultsList.appendChild(li);
            });
          }
          
          filterAttractions(); // Show all initially
          searchInput?.addEventListener('input', (e) => filterAttractions(e.target.value));
        }

        if (kind === 'attractions') {
          toolbarDropdown.querySelectorAll('[data-action="open-attraction"]').forEach(btn => {
            btn.addEventListener('click', () => {
              const key = btn.getAttribute('data-key');
              showPage('attractions');
              showAttractionDetail(key);
              closeToolbarDropdown();
            });
          });
        }
        if (kind === 'hotels') {
          toolbarDropdown.querySelectorAll('[data-action="open-hotels"]').forEach(btn => {
            btn.addEventListener('click', () => { showPage('hotels'); closeToolbarDropdown(); });
          });
        }
        if (kind === 'cars') {
          const f = toolbarDropdown.querySelector('#ddCarForm');
          f?.addEventListener('submit', (e) => {
            e.preventDefault();
            const d = new FormData(f);
            alert(`Searching cars from ${d.get('pickup')} on ${d.get('from')}`);
            closeToolbarDropdown();
          });
        }
        if (kind === 'flights') {
          const f = toolbarDropdown.querySelector('#ddFlightForm');
          f?.addEventListener('submit', (e) => {
            e.preventDefault();
            const d = new FormData(f);
            alert(`Searching flights ${d.get('from')} → ${d.get('to')} on ${d.get('depart')}`);
            closeToolbarDropdown();
          });
        }
        if (kind === 'search') {
          const input = toolbarDropdown.querySelector('#ddSearch');
          const results = toolbarDropdown.querySelector('#ddResults');
          const pages = [
            { type:'page', key:'home', title:'Home', subtitle:'', icon:'🏠' },
            { type:'page', key:'explore', title:'Explore', subtitle:'Discover datasets', icon:'🔎' },
            { type:'page', key:'attractions', title:'Attractions', subtitle:'View attractions', icon:'🎭' },
            { type:'page', key:'hotels', title:'Hotels', subtitle:'Browse stays', icon:'🏨' },
            { type:'page', key:'flights', title:'Flights', subtitle:'Book flights', icon:'✈️' },
            { type:'page', key:'cars', title:'Rent a Car', subtitle:'Find rentals', icon:'🚗' },
            { type:'page', key:'ride', title:'Request a Ride', subtitle:'Get a ride', icon:'🚕' },
          ];
          function aggregate() {
            const atts = Object.entries(attractionsData||{}).map(([key,a]) => ({ type:'attraction', key, title:a.name, subtitle:a.location||'', image:a.image }));
            const hotels = (hotelsData||[]).map((h,idx) => ({ type:'hotel', key:String(idx), title:h.name, subtitle:h.city||'', image:h.image }));
            const airports = (airportsData||[]).map(a => ({ type:'airport', key:a.code, title:`${a.code} — ${a.name}`, subtitle:a.city, icon:'✈️' }));
            const cars = (carRentalsData||[]).map(c => ({ type:'car', key:c.name, title:c.name, subtitle:`${c.city} • ${c.at}`, icon:'🚗' }));
            return [...pages, ...atts, ...hotels, ...airports, ...cars];
          }
          const all = aggregate();
          function render(q=''){
            const needle = q.trim().toLowerCase();
            const data = needle ? all.filter(item => (`${item.title} ${item.subtitle}`.toLowerCase().includes(needle))) : all.slice(0,8);
            results.innerHTML = data.map(item => {
              const avatar = item.image ? `<img src="${item.image}" alt="${item.title}">` : (item.icon || (item.type==='hotel'?'🏨': item.type==='attraction'?'🎭':'🔎'));
              return `<li>
                <button class="dropdown-item" data-action="go" data-type="${item.type}" data-key="${item.key}" data-title="${item.title.replace(/"/g,'&quot;')}" data-subtitle="${(item.subtitle||'').replace(/"/g,'&quot;')}" data-image="${item.image||''}">
                  <div class="dd-item">
                    <div class="dd-avatar">${avatar}</div>
                    <div class="dd-text"><h4>${item.title}</h4><small>${item.subtitle||''}</small></div>
                  </div>
                </button>
              </li>`;
            }).join('');
          }
          input?.addEventListener('input', () => render(input.value));
          toolbarDropdown.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-action="go"]');
            if (!btn) return;
            const type = btn.getAttribute('data-type');
            const key = btn.getAttribute('data-key');
            const title = btn.getAttribute('data-title') || '';
            const subtitle = btn.getAttribute('data-subtitle') || '';
            const image = btn.getAttribute('data-image') || '';
            if (type === 'page') {
              showPage(key);
            } else if (type === 'attraction') {
              showPage('attractions');
              showAttractionDetail(key);
            } else if (type === 'hotel') {
              showHotelDetail(Number(key));
            } else if (type === 'airport') {
              openPlaceDetail({ type:'airport', key, title, subtitle, image, icon:'✈️' });
            } else if (type === 'car') {
              openPlaceDetail({ type:'car', key, title, subtitle, image, icon:'🚗' });
            }
            closeToolbarDropdown();
          });
          input?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
              const first = toolbarDropdown.querySelector('[data-action="go"]');
              if (first) first.click();
            }
          });
          render('');
        }
        if (kind === 'explore') {
          const results = toolbarDropdown.querySelector('#ddResults');
          const atts = Object.entries(attractionsData||{}).map(([key,a]) => ({ type:'attraction', key, title:a.name, subtitle:a.location||'', image:a.image }));
          const hotels = (hotelsData||[]).map((h,idx) => ({ type:'hotel', key:String(idx), title:h.name, subtitle:h.city||'', image:h.image, rating:h.rating }));
          const airports = (airportsData||[]).map(a => ({ type:'airport', key:a.code, title:`${a.code} — ${a.name}`, subtitle:a.city }));
          const all = [...atts, ...hotels, ...airports];
          results.innerHTML = all.map(item => {
            const avatar = item.image ? `<img src="${item.image}" alt="${item.title}">` : (item.type==='airport'?'✈️': item.type==='hotel'?'🏨':'🎭');
            const ratingHTML = (item.type==='hotel' && item.rating) ? `<span class="stars">${'★'.repeat(item.rating)}</span> ` : '';
            return `<li>
              <button class="dropdown-item" data-action="open-explore" data-type="${item.type}" data-key="${item.key}" data-title="${item.title.replace(/"/g,'&quot;')}" data-subtitle="${(item.subtitle||'').replace(/"/g,'&quot;')}" data-image="${item.image||''}">
                <div class="dd-item">
                  <div class="dd-avatar">${avatar}</div>
                  <div class="dd-text"><h4>${item.title}</h4><small>${ratingHTML}${item.subtitle||''}</small></div>
                </div>
              </button>
            </li>`;
          }).join('');
          toolbarDropdown.querySelectorAll('[data-action="open-explore"]').forEach(btn => {
            btn.addEventListener('click', () => {
              const type = btn.getAttribute('data-type');
              const key = btn.getAttribute('data-key');
              const title = btn.getAttribute('data-title')||'';
              const subtitle = btn.getAttribute('data-subtitle')||'';
              const image = btn.getAttribute('data-image')||'';
              if (type === 'attraction') {
                showPage('attractions'); showAttractionDetail(key);
              } else if (type === 'hotel') {
                showHotelDetail(Number(key));
              } else if (type === 'airport') {
                openPlaceDetail({ type:'airport', key, title, subtitle, image });
              }
              closeToolbarDropdown();
            });
          });
        }
      }

      document.addEventListener('click', (e) => {
        if (!toolbarDropdown.contains(e.target) && !dropdownAnchor?.contains(e.target)) {
          closeToolbarDropdown();
        }
      });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeToolbarDropdown(); });
      window.addEventListener('resize', () => { if (dropdownAnchor) positionDropdown(dropdownAnchor); });
      
      // Side Panel Content Generators
      function generateExploreContent() {
        const currentTime = new Date();
        const timeOfDay = currentTime.getHours() < 12 ? 'Morning' : currentTime.getHours() < 17 ? 'Afternoon' : 'Evening';
        const featuredCount = Object.keys(attractionsData || {}).length;
        
        return `
          <h3>🌍 Discover South Africa</h3>
          <p>Good ${timeOfDay}! Explore curated collections of the best experiences across the Rainbow Nation.</p>
          
          <div class="panel-stats">
            <div class="stat-item">
              <span class="stat-number">${featuredCount}+</span>
              <div class="stat-label">Attractions</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">${(hotelsData || []).length}+</span>
              <div class="stat-label">Hotels</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">9</span>
              <div class="stat-label">Provinces</div>
            </div>
          </div>
          
          <div class="cards">
            <div class="card" onclick="navigateFromPanel('explore', 'beaches')">
              <h4>🏖️ Coastal Paradise</h4>
              <p>3,000km of pristine coastline from Atlantic to Indian Ocean</p>
              <small>🌊 Live: Perfect beach weather today!</small>
            </div>
            <div class="card" onclick="navigateFromPanel('explore', 'hiking')">
              <h4>🏔️ Mountain Adventures</h4>
              <p>From Table Mountain to the mighty Drakensberg peaks</p>
              <small>⛰️ Live: Clear hiking conditions</small>
            </div>
            <div class="card" onclick="navigateFromPanel('explore', 'attractions')">
              <h4>🦁 Wildlife & Culture</h4>
              <p>Big 5 safaris, wine routes, and rainbow nation heritage</p>
              <small>🌟 Live: Peak season experiences</small>
            </div>
            <div class="card" onclick="navigateFromPanel('explore', 'hotels')">
              <h4>🏨 Luxury Stays</h4>
              <p>From Cape Town penthouses to Kruger safari lodges</p>
              <small>💎 Live: Best rates available now</small>
            </div>
          </div>
        `;
      }
      
      function generateHotelsContent() {
        return `
          <h3>🏨 South African Hotels & Accommodations</h3>
          <p>Search and discover premium hotels across South Africa with live availability and exclusive deals.</p>
          
          <div class="panel-search">
            <div class="search-container">
              <input type="text" id="hotelPanelSearch" placeholder="Search hotels, cities, or amenities..." class="panel-search-input">
              <button class="search-btn" onclick="searchPanelHotels()">🔍</button>
            </div>
          </div>
          
          <div class="panel-stats">
            <div class="stat-item">
              <span class="stat-number">200+</span>
              <div class="stat-label">Hotels</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">5000+</span>
              <div class="stat-label">Rooms Available</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">24/7</span>
              <div class="stat-label">Live Support</div>
            </div>
          </div>
          
          <div id="hotelSearchResults" class="search-results">
            ${generateDefaultHotels()}
          </div>
          
          <div style="margin-top: 30px; text-align: center;">
            <button class="btn primary" onclick="navigateFromPanel('page', 'hotels')">View Full Hotels Directory</button>
          </div>
        `;
      }
      
      function generateAttractionsContent() {
        return `
          <h3>🌟 Discover South African Attractions</h3>
          <p>Search and explore attractions across all 9 provinces with live updates and detailed information.</p>
          
          <div class="panel-search">
            <div class="search-container">
              <input type="text" id="attractionPanelSearch" placeholder="Search attractions, cities, or provinces..." class="panel-search-input">
              <button class="search-btn" onclick="searchPanelAttractions()">🔍</button>
            </div>
          </div>
          
          <div class="panel-stats">
            <div class="stat-item">
              <span class="stat-number">150+</span>
              <div class="stat-label">Attractions</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">9</span>
              <div class="stat-label">Provinces</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">Live</span>
              <div class="stat-label">Updates</div>
            </div>
          </div>
          
          <div id="attractionSearchResults" class="search-results">
            ${generateDefaultAttractions()}
          </div>
          
          <div style="margin-top: 30px; text-align: center;">
            <button class="btn primary" onclick="navigateFromPanel('page', 'attractions')">View Full Attractions Page</button>
          </div>
        `;
      }
      
      function generateMallsContent() {
        const currentHour = new Date().getHours();
        const isOpen = currentHour >= 9 && currentHour < 21;
        const openStatus = isOpen ? '🟢 Open' : '🔴 Closed';
        
        return `
          <h3>🛍️ South African Shopping Centers</h3>
          <p>Search and discover shopping malls across South Africa with live status updates and detailed information.</p>
          
          <div class="panel-search">
            <div class="search-container">
              <input type="text" id="mallPanelSearch" placeholder="Search malls, cities, or brands..." class="panel-search-input">
              <button class="search-btn" onclick="searchPanelMalls()">🔍</button>
            </div>
          </div>
          
          <div class="panel-stats">
            <div class="stat-item">
              <span class="stat-number">80+</span>
              <div class="stat-label">Shopping Malls</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">${openStatus.split(' ')[1]}</span>
              <div class="stat-label">Current Status</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">2000+</span>
              <div class="stat-label">Stores</div>
            </div>
          </div>
          
          <div id="mallSearchResults" class="search-results">
            ${generateDefaultMalls()}
          </div>
          
          <div style="margin-top: 30px; text-align: center;">
            <button class="btn primary" onclick="navigateFromPanel('page', 'malls')">View Full Malls Directory</button>
          </div>
        `;
      }
      
      function generateCarsContent() {
        const todayDiscount = Math.floor(Math.random() * 15) + 10; // 10-25% discount
        const availableCars = Math.floor(Math.random() * 50) + 150; // 150-200 cars
        
        return `
          <h3>🚗 Car Rental Services</h3>
          <p>Live availability and instant booking for your South African adventure.</p>
          
          <div class="panel-stats">
            <div class="stat-item">
              <span class="stat-number">${availableCars}</span>
              <div class="stat-label">Cars Available</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">${todayDiscount}%</span>
              <div class="stat-label">Today's Discount</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">24/7</span>
              <div class="stat-label">Pickup Available</div>
            </div>
          </div>
          
          <div class="cards">
            <div class="card" onclick="navigateFromPanel('cars', 'economy')">
              <h4>🚗 Economy Fleet</h4>
              <p>Toyota Corolla, VW Polo, Nissan Micra</p>
              <small>💰 From R${Math.floor(250 * (100-todayDiscount)/100)}/day • ${Math.floor(availableCars * 0.4)} available</small>
            </div>
            <div class="card" onclick="navigateFromPanel('cars', 'suv')">
              <h4>🚙 Safari Ready SUVs</h4>
              <p>Toyota Fortuner, Ford Everest, Isuzu MU-X</p>
              <small>🦁 From R${Math.floor(450 * (100-todayDiscount)/100)}/day • Perfect for Kruger</small>
            </div>
            <div class="card" onclick="navigateFromPanel('cars', 'luxury')">
              <h4>🏎️ Luxury Collection</h4>
              <p>BMW, Mercedes, Audi premium selection</p>
              <small>✨ From R${Math.floor(800 * (100-todayDiscount)/100)}/day • VIP service included</small>
            </div>
          </div>
          <div style="margin-top: 30px; text-align: center;">
            <button class="btn primary" onclick="navigateFromPanel('page', 'cars')">Book Your Car Now</button>
          </div>
        `;
      }
      
      function generateFlightsContent() {
        const flightDeals = Math.floor(Math.random() * 30) + 20; // 20-50% off
        const todayFlights = Math.floor(Math.random() * 50) + 80; // 80-130 flights
        
        return `
          <h3>✈️ Flight Booking</h3>
          <p>Live flight schedules and exclusive deals on domestic and international routes.</p>
          
          <div class="panel-stats">
            <div class="stat-item">
              <span class="stat-number">${todayFlights}</span>
              <div class="stat-label">Today's Flights</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">${flightDeals}%</span>
              <div class="stat-label">Best Deal</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">3</span>
              <div class="stat-label">Major Airports</div>
            </div>
          </div>
          
          <div class="cards">
            <div class="card" onclick="navigateFromPanel('flights', 'domestic')">
              <h4>🇿🇦 Domestic Routes</h4>
              <p>CPT ↔ JNB ↔ DUR • Daily connections</p>
              <small>🔥 From R899 • Next flight in 2 hours</small>
            </div>
            <div class="card" onclick="navigateFromPanel('flights', 'international')">
              <h4>🌍 International</h4>
              <p>London, Dubai, New York, Sydney</p>
              <small>✈️ Special rates • Premium airlines</small>
            </div>
            <div class="card" onclick="navigateFromPanel('flights', 'business')">
              <h4>💼 Business Class</h4>
              <p>Luxury lounges, priority boarding</p>
              <small>👑 Upgrade from R2,500 • Limited seats</small>
            </div>
          </div>
          <div style="margin-top: 30px; text-align: center;">
            <button class="btn primary" onclick="navigateFromPanel('page', 'flights')">Search & Book Flights</button>
          </div>
        `;
      }
      
      function generateRideContent() {
        const driversOnline = Math.floor(Math.random() * 20) + 30; // 30-50 drivers
        const avgWaitTime = Math.floor(Math.random() * 3) + 2; // 2-5 minutes
        
        return `
          <h3>🚕 Transportation Services</h3>
          <p>Live driver tracking and instant ride booking across South Africa.</p>
          
          <div class="panel-stats">
            <div class="stat-item">
              <span class="stat-number">${driversOnline}</span>
              <div class="stat-label">Drivers Online</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">${avgWaitTime}</span>
              <div class="stat-label">Avg Wait (min)</div>
            </div>
            <div class="stat-item">
              <span class="stat-number">4.8★</span>
              <div class="stat-label">Driver Rating</div>
            </div>
          </div>
          
          <div class="cards">
            <div class="card" onclick="navigateFromPanel('ride', 'city')">
              <h4>🚗 City Rides</h4>
              <p>Quick urban transportation • GPS tracked</p>
              <small>⚡ ${avgWaitTime} min ETA • From R25 base fare</small>
            </div>
            <div class="card" onclick="navigateFromPanel('ride', 'airport')">
              <h4>🛫 Airport Transfers</h4>
              <p>OR Tambo, Cape Town, King Shaka</p>
              <small>✈️ Fixed rates • Meet & greet service</small>
            </div>
            <div class="card" onclick="navigateFromPanel('ride', 'group')">
              <h4>👥 Group Transport</h4>
              <p>7-seater vehicles, mini-buses</p>
              <small>🚐 Perfect for families • Advanced booking</small>
            </div>
          </div>
          <div style="margin-top: 30px; text-align: center;">
            <button class="btn primary" onclick="navigateFromPanel('page', 'ride')">Request Ride Now</button>
          </div>
        `;
      }
      
      // Navigation function for panel items - moved to global scope
      // Function to go back to parent panel instead of closing entirely
      window.goBackToParentPanel = function(panelType) {
        console.log('Going back to parent panel:', panelType);
        try {
          // First navigate to home page
          if (typeof showPage === 'function') {
            showPage('home');
          }
          // Then open the side panel after a small delay
          setTimeout(() => {
            if (typeof openSidePanel === 'function') {
              openSidePanel(panelType);
            }
          }, 100);
        } catch (error) {
          console.error('Error in goBackToParentPanel:', error);
        }
      };
      
      // Make sure showPage is accessible
      if (typeof window.showPage === 'undefined' && typeof showPage === 'function') {
        window.showPage = showPage;
      }
      
      // Comprehensive South African Attractions Database (moved up for availability)
      window.southAfricanAttractions = [
        // Western Cape
        { name: 'Table Mountain', city: 'Cape Town', province: 'Western Cape', type: 'Natural Wonder', rating: 5, description: 'Iconic flat-topped mountain with cable car access', admission: 'R365', hours: '8:00-18:00' },
        { name: 'Robben Island', city: 'Cape Town', province: 'Western Cape', type: 'Historical Site', rating: 5, description: 'Former prison island, UNESCO World Heritage Site', admission: 'R550', hours: '9:00-15:00' },
        { name: 'V&A Waterfront', city: 'Cape Town', province: 'Western Cape', type: 'Entertainment', rating: 4, description: 'Historic harbor with shopping, dining, and attractions', admission: 'Free', hours: '10:00-22:00' },
        { name: 'Cape Point', city: 'Cape Peninsula', province: 'Western Cape', type: 'Natural Wonder', rating: 5, description: 'Dramatic cliffs where two oceans meet', admission: 'R75', hours: '6:00-18:00' },
        { name: 'Stellenbosch Wine Route', city: 'Stellenbosch', province: 'Western Cape', type: 'Wine Tourism', rating: 5, description: 'Historic wine region with premium tastings', admission: 'R50-200', hours: '9:00-17:00' },
        { name: 'Hermanus Whale Watching', city: 'Hermanus', province: 'Western Cape', type: 'Wildlife', rating: 5, description: 'Best land-based whale watching in the world', admission: 'Free', hours: 'All day' },
        
        // Gauteng
        { name: 'Apartheid Museum', city: 'Johannesburg', province: 'Gauteng', type: 'Museum', rating: 5, description: 'Comprehensive history of apartheid era', admission: 'R100', hours: '9:00-17:00' },
        { name: 'Cradle of Humankind', city: 'Maropeng', province: 'Gauteng', type: 'UNESCO Site', rating: 5, description: 'World heritage paleontological site', admission: 'R200', hours: '9:00-17:00' },
        { name: 'Gold Reef City', city: 'Johannesburg', province: 'Gauteng', type: 'Theme Park', rating: 4, description: 'Mining-themed amusement park', admission: 'R250', hours: '9:30-17:00' },
        { name: 'Union Buildings', city: 'Pretoria', province: 'Gauteng', type: 'Government', rating: 4, description: 'Seat of South African government', admission: 'Free', hours: '8:00-16:00' },
        
        // KwaZulu-Natal & Mpumalanga
        { name: 'Kruger National Park', city: 'Nelspruit', province: 'Mpumalanga', type: 'Safari', rating: 5, description: 'Premier wildlife safari destination', admission: 'R440', hours: '5:30-18:30' },
        { name: 'Drakensberg Mountains', city: 'Bergville', province: 'KwaZulu-Natal', type: 'Natural Wonder', rating: 5, description: 'Spectacular mountain range with hiking trails', admission: 'R50', hours: 'All day' },
        { name: 'uShaka Marine World', city: 'Durban', province: 'KwaZulu-Natal', type: 'Aquarium', rating: 4, description: 'One of the world\'s largest aquariums', admission: 'R280', hours: '9:00-17:00' },
        { name: 'Golden Gate National Park', city: 'Clarens', province: 'Free State', type: 'National Park', rating: 4, description: 'Distinctive golden sandstone cliffs', admission: 'R50', hours: '6:00-18:00' },
        
        // Eastern Cape
        { name: 'Addo Elephant Park', city: 'Port Elizabeth', province: 'Eastern Cape', type: 'Wildlife', rating: 5, description: 'Home to over 600 elephants', admission: 'R320', hours: '7:00-19:00' },
        { name: 'Tsitsikamma National Park', city: 'Storms River', province: 'Eastern Cape', type: 'Adventure', rating: 5, description: 'Coastal park with bungee jumping and canopy tours', admission: 'R50', hours: '7:00-18:00' },
        
        // Additional attractions
        { name: 'Blyde River Canyon', city: 'Graskop', province: 'Mpumalanga', type: 'Natural Wonder', rating: 5, description: 'Third largest canyon in the world', admission: 'Free', hours: 'All day' },
        { name: 'Sun City Resort', city: 'Rustenburg', province: 'North West', type: 'Resort', rating: 4, description: 'Luxury resort with casino and entertainment', admission: 'Varies', hours: '24/7' },
        { name: 'Kimberley Big Hole', city: 'Kimberley', province: 'Northern Cape', type: 'Historical', rating: 4, description: 'Largest hand-dug excavation in the world', admission: 'R120', hours: '8:00-17:00' },
        { name: 'Kgalagadi Transfrontier Park', city: 'Upington', province: 'Northern Cape', type: 'Safari', rating: 5, description: 'Desert wildlife and red sand dunes', admission: 'R320', hours: '7:30-18:30' }
      ];

      // Initialize the home page interactive map
      function initializeHomeSouthAfricaMap() {
        const mapContainer = document.getElementById('homeSouthAfricaMap');
        if (!mapContainer) {
          console.error('Map container not found');
          return;
        }
        
        console.log('Initializing South Africa map with', window.southAfricanAttractions.length, 'attractions');
        
        // Create comprehensive real-time South Africa map with all attractions
        const mapSVG = `
          <div class="interactive-map">
            <div class="map-header">
              <div class="map-stats">
                <span class="live-indicator">🔴 LIVE</span>
                <span class="attraction-count">${window.southAfricanAttractions.length}+ Attractions</span>
                <span class="province-count">9 Provinces Mapped</span>
                <span class="real-time-weather">🌤️ ${new Date().toLocaleTimeString()}</span>
              </div>
            </div>
            <svg viewBox="0 0 1000 700" class="sa-map-svg" style="width: 100%; height: 500px; display: block;">
              <defs>
                <linearGradient id="saGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(26, 84, 144, 0.4)"/>
                  <stop offset="50%" stop-color="rgba(45, 107, 176, 0.3)"/>
                  <stop offset="100%" stop-color="rgba(26, 84, 144, 0.2)"/>
                </linearGradient>
                <filter id="glow">
                  <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                  <feMerge>
                    <feMergeNode in="coloredBlur"/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>
              
              <!-- Accurate South Africa outline with neighboring countries -->
              <path d="M180 280 L220 240 L280 200 L380 180 L480 175 L580 185 L680 220 L750 280 L780 350 L760 420 L720 480 L650 520 L580 540 L480 550 L380 545 L280 520 L220 480 L180 420 L160 350 Z" 
                    fill="url(#saGradient)" stroke="#1a5490" stroke-width="3" filter="url(#glow)"/>
              
              <!-- Lesotho -->
              <circle cx="450" cy="400" r="25" fill="rgba(26, 84, 144, 0.6)" stroke="#1a5490" stroke-width="2"/>
              <text x="435" y="375" fill="#fff" font-size="10" font-weight="bold">Lesotho</text>
              
              <!-- Swaziland (Eswatini) -->
              <ellipse cx="580" cy="320" rx="15" ry="20" fill="rgba(26, 84, 144, 0.6)" stroke="#1a5490" stroke-width="2"/>
              <text x="560" y="305" fill="#fff" font-size="10" font-weight="bold">Eswatini</text>
              
              <!-- Province boundaries with enhanced styling -->
              <g class="provinces" stroke="rgba(255, 208, 122, 0.4)" stroke-width="2" fill="none">
                <!-- Western Cape -->
                <path d="M180 420 L220 380 L320 400 L280 480 L200 500 Z"/>
                <text x="230" y="450" fill="rgba(255,255,255,0.9)" font-size="14" font-weight="600">Western Cape</text>
                
                <!-- Eastern Cape -->
                <path d="M320 400 L480 420 L520 480 L450 520 L320 500 Z"/>
                <text x="380" y="470" fill="rgba(255,255,255,0.9)" font-size="14" font-weight="600">Eastern Cape</text>
                
                <!-- KwaZulu-Natal -->
                <path d="M520 350 L580 330 L620 380 L580 450 L520 430 Z"/>
                <text x="540" y="390" fill="rgba(255,255,255,0.9)" font-size="14" font-weight="600">KZN</text>
                
                <!-- Free State -->
                <path d="M400 320 L480 300 L520 350 L480 400 L400 380 Z"/>
                <text x="430" y="350" fill="rgba(255,255,255,0.9)" font-size="14" font-weight="600">Free State</text>
                
                <!-- Gauteng -->
                <circle cx="450" cy="270" r="30" fill="none" stroke="rgba(255, 208, 122, 0.6)" stroke-width="3"/>
                <text x="430" y="275" fill="rgba(255,255,255,0.9)" font-size="12" font-weight="700">GAUTENG</text>
                
                <!-- Mpumalanga -->
                <path d="M510 250 L580 240 L600 290 L560 310 L510 290 Z"/>
                <text x="530" y="275" fill="rgba(255,255,255,0.9)" font-size="14" font-weight="600">Mpumalanga</text>
                
                <!-- Limpopo -->
                <path d="M480 200 L580 190 L620 240 L580 280 L510 250 Z"/>
                <text x="520" y="225" fill="rgba(255,255,255,0.9)" font-size="14" font-weight="600">Limpopo</text>
                
                <!-- North West -->
                <path d="M380 250 L450 240 L480 280 L450 320 L380 300 Z"/>
                <text x="390" y="280" fill="rgba(255,255,255,0.9)" font-size="14" font-weight="600">North West</text>
                
                <!-- Northern Cape -->
                <path d="M220 300 L380 280 L400 350 L320 400 L220 380 Z"/>
                <text x="270" y="340" fill="rgba(255,255,255,0.9)" font-size="14" font-weight="600">Northern Cape</text>
              </g>
              
              <!-- All South African Attractions with Real-Time Positioning -->
              <g class="attraction-pins">
                <!-- Western Cape Attractions -->
                <g class="western-cape-attractions">
                  <circle cx="220" cy="430" r="10" fill="#ff6b6b" stroke="#fff" stroke-width="3" class="attraction-pin natural-wonder" data-attraction="Table Mountain" onclick="showMapAttraction('Table Mountain')" title="Table Mountain - Natural Wonder"/>
                  <circle cx="215" cy="440" r="8" fill="#4ecdc4" stroke="#fff" stroke-width="2" class="attraction-pin historical" data-attraction="Robben Island" onclick="showMapAttraction('Robben Island')" title="Robben Island - Historical Site"/>
                  <circle cx="225" cy="435" r="8" fill="#45b7d1" stroke="#fff" stroke-width="2" class="attraction-pin entertainment" data-attraction="V&A Waterfront" onclick="showMapAttraction('V&A Waterfront')" title="V&A Waterfront - Entertainment"/>
                  <circle cx="240" cy="460" r="9" fill="#96ceb4" stroke="#fff" stroke-width="2" class="attraction-pin natural-wonder" data-attraction="Cape Point" onclick="showMapAttraction('Cape Point')" title="Cape Point - Natural Wonder"/>
                  <circle cx="280" cy="420" r="8" fill="#ffeaa7" stroke="#fff" stroke-width="2" class="attraction-pin wine-tourism" data-attraction="Stellenbosch Wine Route" onclick="showMapAttraction('Stellenbosch Wine Route')" title="Stellenbosch Wine Route - Wine Tourism"/>
                  <circle cx="260" cy="450" r="9" fill="#74b9ff" stroke="#fff" stroke-width="2" class="attraction-pin wildlife" data-attraction="Hermanus Whale Watching" onclick="showMapAttraction('Hermanus Whale Watching')" title="Hermanus Whale Watching - Wildlife"/>
                </g>
                
                <!-- Gauteng Attractions -->
                <g class="gauteng-attractions">
                  <circle cx="450" cy="270" r="10" fill="#fdcb6e" stroke="#fff" stroke-width="3" class="attraction-pin museum" data-attraction="Apartheid Museum" onclick="showMapAttraction('Apartheid Museum')" title="Apartheid Museum - Museum"/>
                  <circle cx="440" cy="280" r="9" fill="#e17055" stroke="#fff" stroke-width="2" class="attraction-pin unesco" data-attraction="Cradle of Humankind" onclick="showMapAttraction('Cradle of Humankind')" title="Cradle of Humankind - UNESCO Site"/>
                  <circle cx="460" cy="275" r="8" fill="#a29bfe" stroke="#fff" stroke-width="2" class="attraction-pin theme-park" data-attraction="Gold Reef City" onclick="showMapAttraction('Gold Reef City')" title="Gold Reef City - Theme Park"/>
                  <circle cx="470" cy="260" r="8" fill="#6c5ce7" stroke="#fff" stroke-width="2" class="attraction-pin government" data-attraction="Union Buildings" onclick="showMapAttraction('Union Buildings')" title="Union Buildings - Government"/>
                </g>
                
                <!-- KwaZulu-Natal Attractions -->
                <g class="kzn-attractions">
                  <circle cx="570" cy="360" r="10" fill="#00b894" stroke="#fff" stroke-width="3" class="attraction-pin aquarium" data-attraction="uShaka Marine World" onclick="showMapAttraction('uShaka Marine World')" title="uShaka Marine World - Aquarium"/>
                  <circle cx="500" cy="380" r="11" fill="#00a085" stroke="#fff" stroke-width="3" class="attraction-pin natural-wonder" data-attraction="Drakensberg Mountains" onclick="showMapAttraction('Drakensberg Mountains')" title="Drakensberg Mountains - Natural Wonder"/>
                </g>
                
                <!-- Mpumalanga Attractions -->
                <g class="mpumalanga-attractions">
                  <circle cx="580" cy="280" r="12" fill="#00b894" stroke="#fff" stroke-width="3" class="attraction-pin safari" data-attraction="Kruger National Park" onclick="showMapAttraction('Kruger National Park')" title="Kruger National Park - Premier Safari"/>
                  <circle cx="550" cy="260" r="9" fill="#55a3ff" stroke="#fff" stroke-width="2" class="attraction-pin natural-wonder" data-attraction="Blyde River Canyon" onclick="showMapAttraction('Blyde River Canyon')" title="Blyde River Canyon - Natural Wonder"/>
                </g>
                
                <!-- Eastern Cape Attractions -->
                <g class="eastern-cape-attractions">
                  <circle cx="520" cy="470" r="9" fill="#fd79a8" stroke="#fff" stroke-width="2" class="attraction-pin wildlife" data-attraction="Addo Elephant Park" onclick="showMapAttraction('Addo Elephant Park')" title="Addo Elephant Park - Wildlife"/>
                  <circle cx="480" cy="500" r="8" fill="#fdcb6e" stroke="#fff" stroke-width="2" class="attraction-pin adventure" data-attraction="Tsitsikamma National Park" onclick="showMapAttraction('Tsitsikamma National Park')" title="Tsitsikamma National Park - Adventure"/>
                </g>
                
                <!-- Free State Attractions -->
                <g class="free-state-attractions">
                  <circle cx="460" cy="360" r="8" fill="#fab1a0" stroke="#fff" stroke-width="2" class="attraction-pin national-park" data-attraction="Golden Gate National Park" onclick="showMapAttraction('Golden Gate National Park')" title="Golden Gate National Park"/>
                </g>
                
                <!-- North West Attractions -->
                <g class="north-west-attractions">
                  <circle cx="400" cy="260" r="10" fill="#e84393" stroke="#fff" stroke-width="3" class="attraction-pin resort" data-attraction="Sun City Resort" onclick="showMapAttraction('Sun City Resort')" title="Sun City Resort"/>
                </g>
                
                <!-- Northern Cape Attractions -->
                <g class="northern-cape-attractions">
                  <circle cx="350" cy="340" r="8" fill="#636e72" stroke="#fff" stroke-width="2" class="attraction-pin historical" data-attraction="Kimberley Big Hole" onclick="showMapAttraction('Kimberley Big Hole')" title="Kimberley Big Hole - Historical"/>
                  <circle cx="300" cy="380" r="9" fill="#2d3436" stroke="#fff" stroke-width="2" class="attraction-pin safari" data-attraction="Kgalagadi Transfrontier Park" onclick="showMapAttraction('Kgalagadi Transfrontier Park')" title="Kgalagadi Transfrontier Park - Desert Safari"/>
                </g>
                
                <!-- Major City Labels -->
                <g class="city-labels">
                  <text x="230" y="445" fill="#fff" font-size="14" font-weight="bold" text-shadow="2px 2px 4px rgba(0,0,0,0.7)">CAPE TOWN</text>
                  <text x="460" y="285" fill="#fff" font-size="14" font-weight="bold" text-shadow="2px 2px 4px rgba(0,0,0,0.7)">JOHANNESBURG</text>
                  <text x="575" y="375" fill="#fff" font-size="14" font-weight="bold" text-shadow="2px 2px 4px rgba(0,0,0,0.7)">DURBAN</text>
                  <text x="480" y="270" fill="#fff" font-size="12" font-weight="bold" text-shadow="2px 2px 4px rgba(0,0,0,0.7)">PRETORIA</text>
                  <text x="590" y="295" fill="#fff" font-size="12" font-weight="bold" text-shadow="2px 2px 4px rgba(0,0,0,0.7)">KRUGER</text>
                </g>
              </g>
            </svg>
            
            <div class="map-controls">
              <button class="map-zoom-btn" onclick="zoomMap(1.3)">🔍 Zoom In</button>
              <button class="map-zoom-btn" onclick="zoomMap(0.7)">🔍 Zoom Out</button>
              <button class="map-zoom-btn" onclick="resetMapZoom()">↻ Reset View</button>
              <button class="map-filter-btn" onclick="toggleAttractionFilter()">🎯 Filter</button>
              <button class="map-view-btn" onclick="toggleMapView()">🗺️ Satellite</button>
              <button class="map-info-btn" onclick="showMapInfo()">ℹ️ Info</button>
            </div>
            
            <div class="map-legend">
              <div class="legend-header">Attraction Types</div>
              <div class="legend-grid">
                <div class="legend-item"><span class="legend-dot natural-wonder"></span> Natural Wonders</div>
                <div class="legend-item"><span class="legend-dot wildlife"></span> Wildlife & Safari</div>
                <div class="legend-item"><span class="legend-dot historical"></span> Historical Sites</div>
                <div class="legend-item"><span class="legend-dot cultural"></span> Cultural</div>
                <div class="legend-item"><span class="legend-dot adventure"></span> Adventure</div>
                <div class="legend-item"><span class="legend-dot entertainment"></span> Entertainment</div>
              </div>
            </div>
            
            <div class="attraction-filter-panel" id="attractionFilterPanel" style="display: none;">
              <h4>Filter Attractions</h4>
              <div class="filter-options">
                <label><input type="checkbox" value="all" checked onchange="filterAttractions()"> Show All</label>
                <label><input type="checkbox" value="natural-wonder" onchange="filterAttractions()"> Natural Wonders</label>
                <label><input type="checkbox" value="wildlife" onchange="filterAttractions()"> Wildlife</label>
                <label><input type="checkbox" value="historical" onchange="filterAttractions()"> Historical</label>
                <label><input type="checkbox" value="adventure" onchange="filterAttractions()"> Adventure</label>
                <label><input type="checkbox" value="entertainment" onchange="filterAttractions()"> Entertainment</label>
              </div>
            </div>
          </div>
        `;
        
        try {
          mapContainer.innerHTML = mapSVG;
          console.log('Map HTML successfully inserted');
          
          // Initialize real-time clock update
          setTimeout(() => {
            updateMapClock();
          }, 100);
          
        } catch (error) {
          console.error('Error inserting map HTML:', error);
          mapContainer.innerHTML = '<div style="color: red; padding: 20px;">Error loading map. Please refresh the page.</div>';
        }
      }
      
      // Populate attractions list in home sidebar
      function populateHomeMapAttractions() {
        const attractionsList = document.getElementById('homeMapAttractionsList');
        if (!attractionsList) {
          console.error('Attractions list container not found');
          return;
        }
        if (!window.southAfricanAttractions) {
          console.error('Attractions data not available');
          return;
        }
        
        try {
          const featuredAttractions = window.southAfricanAttractions.slice(0, 10);
          console.log('Populating attractions list with', featuredAttractions.length, 'items');
          
          attractionsList.innerHTML = featuredAttractions.map(attraction => `
            <div class="map-attraction-item" onclick="showMapAttraction('${attraction.name}')">
              <h4>📍 ${attraction.name}</h4>
              <p>${attraction.city}, ${attraction.province}</p>
              <span class="attraction-type">${attraction.type}</span>
            </div>
          `).join('');
          
          console.log('Attractions list populated successfully');
        } catch (error) {
          console.error('Error populating attractions list:', error);
          attractionsList.innerHTML = '<div style="color: red; padding: 10px;">Error loading attractions</div>';
        }
      }
      
      // Show detailed attraction information
      window.showDetailedAttraction = function(attractionName) {
        const detailedAttractions = {
          'Table Mountain': {
            name: 'Table Mountain National Park',
            location: 'Cape Town, Western Cape',
            rating: '4.8⭐ (45,231 reviews)',
            image: 'https://images.unsplash.com/photo-1580060839134-75a5edca2e99',
            description: 'Table Mountain is a flat-topped mountain forming a prominent landmark overlooking the city of Cape Town. It is a significant tourist attraction, with many visitors using the cableway or hiking to the top.',
            details: {
              type: 'Natural Wonder & National Park',
              established: '1998',
              elevation: '1,085 meters',
              area: '25,000 hectares',
              visitors: '4.2 million annually'
            },
            pricing: {
              cableCar: 'Adults: R365, Children: R185',
              parking: 'R20/day',
              hiking: 'Free'
            },
            hours: '8:00 AM - 6:00 PM (Cable car), All day (Hiking)',
            features: ['Rotating Cable Car', '360° Views', 'Hiking Trails', 'Restaurant', 'Gift Shop', 'Wheelchair Accessible'],
            highlights: 'UNESCO World Heritage Site, New7Wonders of Nature finalist, Over 2,200 plant species'
          },
          'Kruger National Park': {
            name: 'Kruger National Park',
            location: 'Mpumalanga & Limpopo Provinces',
            rating: '4.7⭐ (28,542 reviews)',
            image: 'https://images.unsplash.com/photo-1516026672322-bc52d61a55d5',
            description: 'One of Africa\'s largest game reserves, Kruger National Park is home to the Big Five and offers exceptional wildlife viewing opportunities across diverse ecosystems.',
            details: {
              type: 'National Park & Safari Destination',
              established: '1898',
              area: '19,485 km²',
              animals: '500+ bird species, 147 mammals',
              camps: '25 rest camps'
            },
            pricing: {
              dayVisit: 'Adults: R440, Children: R220',
              wildCard: 'R2,415 annually',
              accommodation: 'From R1,200/night'
            },
            hours: '5:30 AM - 6:30 PM (Summer), 6:00 AM - 6:00 PM (Winter)',
            features: ['Big Five Game Viewing', 'Self-Drive Safari', 'Guided Game Drives', 'Bush Walks', 'Bird Watching', 'Photography Hides'],
            highlights: 'Largest national park in South Africa, Malaria-free areas available, Excellent self-drive routes'
          },
          'Robben Island': {
            name: 'Robben Island Museum',
            location: 'Western Cape, 7km from Cape Town',
            rating: '4.6⭐ (12,847 reviews)',
            image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96',
            description: 'Former prison island where Nelson Mandela was incarcerated for 18 years. Now a museum and UNESCO World Heritage Site offering guided tours.',
            details: {
              type: 'Historical Site & Museum',
              established: '1997 (as museum)',
              significance: 'Political prison 1961-1991',
              area: '5.07 km²',
              guides: 'Former political prisoners'
            },
            pricing: {
              adultTour: 'R550 (includes ferry)',
              childTour: 'R300 (4-17 years)',
              senior: 'R440 (60+ years)'
            },
            hours: '9:00 AM - 3:00 PM (Tours depart every 2 hours)',
            features: ['Ferry Journey', 'Prison Tour', 'Mandela\'s Cell', 'Limestone Quarry', 'Museum Exhibits', 'Bus Tour'],
            highlights: 'UNESCO World Heritage Site, Symbol of freedom and democracy, Former political prison'
          },
          'Drakensberg Mountains': {
            name: 'uKhahlamba-Drakensberg Park',
            location: 'KwaZulu-Natal Province',
            rating: '4.9⭐ (8,934 reviews)',
            image: 'https://images.unsplash.com/photo-1598300042247-d088f8ab3a91',
            description: 'Spectacular mountain range featuring ancient San rock art, pristine wilderness, and excellent hiking opportunities in a UNESCO World Heritage Site.',
            details: {
              type: 'Mountain Range & World Heritage Site',
              established: '2000 (UNESCO status)',
              highestPeak: 'Thabana Ntlenyana (3,482m)',
              rockArt: '40,000+ San paintings',
              area: '242,813 hectares'
            },
            pricing: {
              parkEntry: 'R50 per person',
              camping: 'From R180/night',
              chalets: 'From R800/night'
            },
            hours: '6:00 AM - 6:00 PM (Gate hours)',
            features: ['Hiking Trails', 'San Rock Art', 'Camping Sites', 'Trout Fishing', 'Horse Riding', 'Mountain Climbing'],
            highlights: 'UNESCO World Heritage Site, Ancient San rock art, Pristine mountain wilderness'
          },
          'V&A Waterfront': {
            name: 'V&A Waterfront',
            location: 'Cape Town Waterfront District',
            rating: '4.5⭐ (67,423 reviews)',
            image: 'https://images.unsplash.com/photo-1576485290814-1c72aa4bbb8e',
            description: 'Historic working harbor transformed into South Africa\'s most visited destination, featuring shopping, dining, entertainment, and attractions.',
            details: {
              type: 'Mixed-use Waterfront Development',
              opened: '1988',
              area: '123 hectares',
              visitors: '24 million annually',
              shops: '450+ retail outlets'
            },
            pricing: {
              entry: 'Free',
              parking: 'R15/hour',
              aquarium: 'R230 adults'
            },
            hours: '10:00 AM - 10:00 PM (Shopping), Restaurants vary',
            features: ['Shopping Malls', 'Fine Dining', 'Two Oceans Aquarium', 'Zeitz Museum', 'Helicopter Rides', 'Boat Cruises'],
            highlights: 'Working harbor, Nobel Square, Diverse entertainment options'
          },
          'Apartheid Museum': {
            name: 'Apartheid Museum',
            location: 'Johannesburg, Gauteng',
            rating: '4.7⭐ (15,672 reviews)',
            image: 'https://images.unsplash.com/photo-1581833971358-2c8b550f87b3',
            description: 'Comprehensive museum documenting the rise and fall of apartheid in South Africa through powerful exhibits and multimedia presentations.',
            details: {
              type: 'History Museum',
              opened: '2001',
              exhibitions: '22 individual exhibition areas',
              artifacts: '1000+ photographs and documents',
              languages: 'Available in 11 languages'
            },
            pricing: {
              adults: 'R100',
              students: 'R80 (with ID)',
              children: 'R60 (under 18)'
            },
            hours: '9:00 AM - 5:00 PM (Closed Mondays)',
            features: ['Multimedia Exhibitions', 'Film Theatre', 'Audio Tours', 'Educational Programs', 'Research Library', 'Gift Shop'],
            highlights: 'Internationally acclaimed museum, Powerful historical narrative, Educational resource'
          },
          'Cape Point Nature Reserve': {
            name: 'Cape Point Nature Reserve',
            location: 'Cape Peninsula, Western Cape',
            rating: '4.8⭐ (32,154 reviews)',
            image: 'https://images.unsplash.com/photo-1539650116574-75c0c6d73ab2',
            description: 'Dramatic cliffs at the southwestern tip of Africa where the Atlantic and Indian Oceans meet. Historic lighthouse and diverse fynbos vegetation.',
            details: {
              type: 'Nature Reserve & National Park',
              established: '1938',
              area: '7,750 hectares',
              elevation: '249 meters (lighthouse)',
              species: '1,100+ plant species'
            },
            pricing: {
              adults: 'R390',
              children: 'R195 (2-11 years)',
              seniors: 'R195 (60+ years)',
              funicular: 'R75 return'
            },
            hours: '7:00 AM - 5:00 PM (April-September), 6:00 AM - 6:00 PM (October-March)',
            features: ['Historic Lighthouse', 'Flying Dutchman Funicular', 'Restaurant', 'Gift Shop', 'Walking Trails', 'Baboon Viewing'],
            highlights: 'Most southwestern point of Africa, Two Oceans Restaurant, Dramatic coastal scenery'
          },
          'Blyde River Canyon': {
            name: 'Blyde River Canyon Nature Reserve',
            location: 'Mpumalanga Province',
            rating: '4.9⭐ (18,743 reviews)',
            image: 'https://images.unsplash.com/photo-1597149328080-a3e2c4ba4f0d',
            description: 'Third largest canyon in the world featuring spectacular viewpoints, pristine wilderness, and unique geological formations.',
            details: {
              type: 'Canyon & Nature Reserve',
              established: '1965',
              length: '26 kilometers',
              depth: '800 meters average',
              area: '29,000 hectares'
            },
            pricing: {
              entry: 'Free',
              accommodation: 'From R350/night',
              boatCruise: 'R380 adults'
            },
            hours: '24/7 (Viewpoints), Boat cruises: 9:00 AM - 4:00 PM',
            features: ['Three Rondavels Viewpoint', 'God\'s Window', 'Bourke\'s Luck Potholes', 'Pinnacle Rock', 'Boat Cruises', 'Hiking Trails'],
            highlights: 'Third largest canyon globally, Unique rock formations, Pristine wilderness area'
          },
          'Hermanus Whale Watching': {
            name: 'Hermanus Whale Watching',
            location: 'Hermanus, Western Cape',
            rating: '4.8⭐ (24,891 reviews)',
            image: 'https://images.unsplash.com/photo-1559827260-dc66d52bef19',
            description: 'World\'s best land-based whale watching destination. Southern Right Whales visit annually from June to December.',
            details: {
              type: 'Marine Wildlife Destination',
              season: 'June - December (peak: September-November)',
              species: 'Southern Right Whales, Humpback Whales, Brydes Whales',
              distance: 'Whales visible from shore',
              activities: 'Land & boat-based viewing'
            },
            pricing: {
              landBased: 'Free',
              boatTours: 'R650 - R1,200',
              accommodation: 'From R800/night'
            },
            hours: 'Best viewing: 9:00 AM - 4:00 PM, Boat tours: 8:00 AM - 5:00 PM',
            features: ['Cliff Path Walking Trail', 'Official Whale Crier', 'Boat-based Tours', 'Whale Festival (September)', 'Marine Education', 'Restaurants'],
            highlights: 'UNESCO World Heritage Marine Protected Area, Annual Whale Festival, Close-up whale encounters'
          }
        };
        
        const detailedMalls = {
          'Sandton City': {
            name: 'Sandton City',
            location: 'Sandton, Johannesburg - Financial District',
            rating: '4.6⭐ (89,234 reviews)',
            image: 'https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a',
            description: 'Africa\'s premier shopping destination featuring luxury international brands, flagship stores, and world-class dining experiences.',
            details: {
              type: 'Premium Shopping Mall',
              opened: '1973 (renovated 2005)',
              stores: '400+ retail outlets',
              size: '128,000 m² retail space',
              parking: '7,000 parking bays'
            },
            pricing: {
              entry: 'Free',
              parking: 'Free for 2 hours, then R5/hour',
              valet: 'R50'
            },
            hours: '9:00 AM - 9:00 PM (Mon-Thu), 9:00 AM - 10:00 PM (Fri-Sat), 9:00 AM - 6:00 PM (Sun)',
            features: ['Luxury Brands', 'Department Stores', 'Fine Dining', 'Cinema Complex', 'Banks & Services', 'Beauty Salons'],
            highlights: 'Connected to Nelson Mandela Square, Flagship luxury stores, Premium dining precinct'
          },
          'Canal Walk': {
            name: 'Canal Walk Shopping Centre',
            location: 'Century City, Cape Town',
            rating: '4.5⭐ (67,892 reviews)',
            image: 'https://images.unsplash.com/photo-1567226475328-9d6baaf565cf',
            description: 'Largest shopping center in Africa with unique canal-themed architecture, entertainment facilities, and comprehensive retail offering.',
            details: {
              type: 'Super Regional Mall',
              opened: '2000',
              stores: '400+ retail outlets',
              size: '141,000 m² total area',
              entertainment: 'Ice rink, bowling, cinema'
            },
            pricing: {
              entry: 'Free',
              parking: 'Free',
              iceSkating: 'R120/session',
              bowling: 'R180/game'
            },
            hours: '9:00 AM - 9:00 PM (Mon-Thu), 9:00 AM - 10:00 PM (Fri-Sat), 9:00 AM - 6:00 PM (Sun)',
            features: ['400+ Stores', 'Olympic Ice Rink', 'Skate Park', '14-Screen Cinema', 'Bowling Alley', 'Food Courts'],
            highlights: 'Largest mall in Africa, Unique canal architecture, Olympic-standard ice rink'
          },
          'Gateway Theatre of Shopping': {
            name: 'Gateway Theatre of Shopping',
            location: 'Durban North, KwaZulu-Natal',
            rating: '4.4⭐ (45,673 reviews)',
            image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96',
            description: 'Award-winning themed mall with beach-inspired architecture, comprehensive shopping, dining, and unique entertainment offerings.',
            details: {
              type: 'Themed Regional Mall',
              opened: '2001',
              stores: '330+ retail outlets',
              size: '180,000 m² total area',
              theme: 'Coastal & beach inspired'
            },
            pricing: {
              entry: 'Free',
              parking: 'Free',
              waveHouse: 'R350/hour',
              miniGolf: 'R65/round'
            },
            hours: '9:00 AM - 9:00 PM (Mon-Thu), 9:00 AM - 10:00 PM (Fri-Sat), 9:00 AM - 6:00 PM (Sun)',
            features: ['Wave House Surfing', 'IMAX Cinema', 'Mini Golf Course', 'Skate Park', 'Food Courts', 'Game Arcade'],
            highlights: 'Artificial wave surfing, Beach-themed architecture, Family entertainment hub'
          }
        };
        
        const detailedHotels = {
          'One&Only Cape Town': {
            name: 'One&Only Cape Town',
            location: 'V&A Waterfront, Cape Town',
            rating: '4.9⭐ (12,847 reviews)',
            image: 'https://images.unsplash.com/photo-1564501049412-61c2a3083791',
            description: 'Ultra-luxury resort situated on a private island with stunning Table Mountain views, world-class spa, and award-winning restaurants.',
            details: {
              type: '5-Star Luxury Resort',
              opened: '2009',
              rooms: '131 rooms & suites',
              facilities: 'Spa, 3 restaurants, marina',
              awards: 'World Travel Awards Winner'
            },
            pricing: {
              rooms: 'From R15,000/night',
              suites: 'From R35,000/night',
              spa: 'From R2,500/treatment',
              dining: 'R1,200+ per person'
            },
            hours: '24/7 Concierge & Room Service',
            features: ['Island Location', 'Table Mountain Views', 'One&Only Spa', 'Nobu Restaurant', 'Marina Access', 'Butler Service'],
            highlights: 'Private island location, Michelin-starred dining, Exclusive marina access'
          },
          'Saxon Hotel': {
            name: 'Saxon Hotel, Villas & Spa',
            location: 'Sandhurst, Johannesburg',
            rating: '4.8⭐ (8,934 reviews)',
            image: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa',
            description: 'Exclusive boutique hotel where Nelson Mandela wrote his autobiography. Epitome of luxury, privacy, and personalized service.',
            details: {
              type: '5-Star Boutique Hotel',
              opened: '1946 (renovated 2000)',
              rooms: '53 rooms, suites & villas',
              area: '10 acres of gardens',
              heritage: 'Mandela\'s writing retreat'
            },
            pricing: {
              rooms: 'From R12,500/night',
              villas: 'From R45,000/night',
              spa: 'From R2,800/treatment',
              dining: 'R1,500+ per person'
            },
            hours: '24/7 Personalized Service',
            features: ['Villa Suites', 'Qunu Spa', 'Private Pools', 'Butler Service', 'Fine Dining', 'Art Collection'],
            highlights: 'Mandela\'s former residence, Ultimate privacy, World-class art collection'
          },
          'Oyster Box Hotel': {
            name: 'The Oyster Box Hotel',
            location: 'Umhlanga, Durban',
            rating: '4.7⭐ (15,632 reviews)',
            image: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b',
            description: 'Iconic colonial-style hotel on golden beaches with Indian Ocean views, legendary service, and timeless elegance.',
            details: {
              type: '5-Star Beach Resort',
              opened: '1947',
              rooms: '86 rooms & suites',
              beachfront: 'Direct beach access',
              style: 'Colonial architecture'
            },
            pricing: {
              rooms: 'From R8,500/night',
              suites: 'From R18,000/night',
              spa: 'From R1,800/treatment',
              dining: 'R950+ per person'
            },
            hours: '24/7 Service & Concierge',
            features: ['Ocean Views', 'Lighthouse Bar', 'Spa Treatments', 'Beach Access', 'Fine Dining', 'Historic Charm'],
            highlights: 'Iconic lighthouse bar, Beachfront location, Colonial elegance'
          }
        };
        
        const attraction = detailedAttractions[attractionName];
        if (attraction) {
          const popup = `
            <div style="max-width: 500px; font-family: Arial, sans-serif;">
              <h2 style="color: #1a5490; margin: 0 0 10px 0;">${attraction.name}</h2>
              <div style="color: #666; margin-bottom: 10px;">${attraction.rating}</div>
              <p style="margin-bottom: 15px;">${attraction.description}</p>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                  <strong>📍 Location:</strong><br>${attraction.location}
                </div>
                <div>
                  <strong>🕐 Hours:</strong><br>${attraction.hours}
                </div>
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>💰 Pricing:</strong><br>
                ${Object.entries(attraction.pricing).map(([key, value]) => `• ${key}: ${value}`).join('<br>')}
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>🌟 Highlights:</strong><br>
                ${attraction.highlights}
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>✨ Features:</strong><br>
                ${attraction.features.join(' • ')}
              </div>
              
              <button onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(attraction.name + ' ' + attraction.location)}', '_blank')" 
                      style="background: #1a5490; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; margin-right: 10px;">
                🔍 Search on Google
              </button>
              <button onclick="alert('Booking feature coming soon!')" 
                      style="background: #ffd07a; color: #1a5490; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer;">
                📅 Book Now
              </button>
            </div>
          `;
          
          // Create modal overlay
          const modal = document.createElement('div');
          modal.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); display: flex; align-items: center; 
            justify-content: center; z-index: 10000; padding: 20px; box-sizing: border-box;
          `;
          
          const modalContent = document.createElement('div');
          modalContent.style.cssText = `
            background: white; border-radius: 15px; padding: 30px; 
            max-height: 90vh; overflow-y: auto; position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
          `;
          
          const closeBtn = document.createElement('button');
          closeBtn.innerHTML = '✕';
          closeBtn.style.cssText = `
            position: absolute; top: 15px; right: 15px; background: none; 
            border: none; font-size: 24px; cursor: pointer; color: #666;
          `;
          closeBtn.onclick = () => document.body.removeChild(modal);
          
          modalContent.innerHTML = popup;
          modalContent.appendChild(closeBtn);
          modal.appendChild(modalContent);
          document.body.appendChild(modal);
          
          // Close on background click
          modal.onclick = (e) => {
            if (e.target === modal) document.body.removeChild(modal);
          };
        }
      };
      
      // Detailed mall information function
      window.showDetailedMall = function(mallName) {
        const detailedMalls = {
          'Sandton City': {
            name: 'Sandton City',
            location: 'Sandton, Johannesburg - Financial District',
            rating: '4.6⭐ (89,234 reviews)',
            image: 'https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a',
            description: 'Africa\'s premier shopping destination featuring luxury international brands, flagship stores, and world-class dining experiences.',
            details: {
              type: 'Premium Shopping Mall',
              opened: '1973 (renovated 2005)',
              stores: '400+ retail outlets',
              size: '128,000 m² retail space',
              parking: '7,000 parking bays'
            },
            pricing: {
              entry: 'Free',
              parking: 'Free for 2 hours, then R5/hour',
              valet: 'R50'
            },
            hours: '9:00 AM - 9:00 PM (Mon-Thu), 9:00 AM - 10:00 PM (Fri-Sat), 9:00 AM - 6:00 PM (Sun)',
            features: ['Luxury Brands', 'Department Stores', 'Fine Dining', 'Cinema Complex', 'Banks & Services', 'Beauty Salons'],
            highlights: 'Connected to Nelson Mandela Square, Flagship luxury stores, Premium dining precinct'
          },
          'Canal Walk': {
            name: 'Canal Walk Shopping Centre',
            location: 'Century City, Cape Town',
            rating: '4.5⭐ (67,892 reviews)',
            image: 'https://images.unsplash.com/photo-1567226475328-9d6baaf565cf',
            description: 'Largest shopping center in Africa with unique canal-themed architecture, entertainment facilities, and comprehensive retail offering.',
            details: {
              type: 'Super Regional Mall',
              opened: '2000',
              stores: '400+ retail outlets',
              size: '141,000 m² total area',
              entertainment: 'Ice rink, bowling, cinema'
            },
            pricing: {
              entry: 'Free',
              parking: 'Free',
              iceSkating: 'R120/session',
              bowling: 'R180/game'
            },
            hours: '9:00 AM - 9:00 PM (Mon-Thu), 9:00 AM - 10:00 PM (Fri-Sat), 9:00 AM - 6:00 PM (Sun)',
            features: ['400+ Stores', 'Olympic Ice Rink', 'Skate Park', '14-Screen Cinema', 'Bowling Alley', 'Food Courts'],
            highlights: 'Largest mall in Africa, Unique canal architecture, Olympic-standard ice rink'
          },
          'Gateway Theatre of Shopping': {
            name: 'Gateway Theatre of Shopping',
            location: 'Durban North, KwaZulu-Natal',
            rating: '4.4⭐ (45,673 reviews)',
            image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96',
            description: 'Award-winning themed mall with beach-inspired architecture, comprehensive shopping, dining, and unique entertainment offerings.',
            details: {
              type: 'Themed Regional Mall',
              opened: '2001',
              stores: '330+ retail outlets',
              size: '180,000 m² total area',
              theme: 'Coastal & beach inspired'
            },
            pricing: {
              entry: 'Free',
              parking: 'Free',
              waveHouse: 'R350/hour',
              miniGolf: 'R65/round'
            },
            hours: '9:00 AM - 9:00 PM (Mon-Thu), 9:00 AM - 10:00 PM (Fri-Sat), 9:00 AM - 6:00 PM (Sun)',
            features: ['Wave House Surfing', 'IMAX Cinema', 'Mini Golf Course', 'Skate Park', 'Food Courts', 'Game Arcade'],
            highlights: 'Artificial wave surfing, Beach-themed architecture, Family entertainment hub'
          }
        };
        
        const mall = detailedMalls[mallName];
        if (mall) {
          const popup = `
            <div style="max-width: 500px; font-family: Arial, sans-serif;">
              <h2 style="color: #1a5490; margin: 0 0 10px 0;">${mall.name}</h2>
              <div style="color: #666; margin-bottom: 10px;">${mall.rating}</div>
              <p style="margin-bottom: 15px;">${mall.description}</p>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                  <strong>📍 Location:</strong><br>${mall.location}
                </div>
                <div>
                  <strong>🕐 Hours:</strong><br>${mall.hours}
                </div>
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>💰 Pricing:</strong><br>
                ${Object.entries(mall.pricing).map(([key, value]) => `• ${key}: ${value}`).join('<br>')}
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>🌟 Highlights:</strong><br>
                ${mall.highlights}
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>✨ Features:</strong><br>
                ${mall.features.join(' • ')}
              </div>
              
              <button onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(mall.name + ' ' + mall.location)}', '_blank')" 
                      style="background: #1a5490; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; margin-right: 10px;">
                🔍 Search on Google
              </button>
              <button onclick="alert('Store directory and navigation coming soon!')" 
                      style="background: #ffd07a; color: #1a5490; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer;">
                🗺 Store Directory
              </button>
            </div>
          `;
          
          // Create modal overlay
          const modal = document.createElement('div');
          modal.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); display: flex; align-items: center; 
            justify-content: center; z-index: 10000; padding: 20px; box-sizing: border-box;
          `;
          
          const modalContent = document.createElement('div');
          modalContent.style.cssText = `
            background: white; border-radius: 15px; padding: 30px; 
            max-height: 90vh; overflow-y: auto; position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
          `;
          
          const closeBtn = document.createElement('button');
          closeBtn.innerHTML = '✕';
          closeBtn.style.cssText = `
            position: absolute; top: 15px; right: 15px; background: none; 
            border: none; font-size: 24px; cursor: pointer; color: #666;
          `;
          closeBtn.onclick = () => document.body.removeChild(modal);
          
          modalContent.innerHTML = popup;
          modalContent.appendChild(closeBtn);
          modal.appendChild(modalContent);
          document.body.appendChild(modal);
          
          // Close on background click
          modal.onclick = (e) => {
            if (e.target === modal) document.body.removeChild(modal);
          };
        }
      };
      
      // Detailed hotel information function
      window.showDetailedHotel = function(hotelName) {
        const detailedHotels = {
          'One&Only Cape Town': {
            name: 'One&Only Cape Town',
            location: 'V&A Waterfront, Cape Town',
            rating: '4.9⭐ (12,847 reviews)',
            image: 'https://images.unsplash.com/photo-1564501049412-61c2a3083791',
            description: 'Ultra-luxury resort situated on a private island with stunning Table Mountain views, world-class spa, and award-winning restaurants.',
            details: {
              type: '5-Star Luxury Resort',
              opened: '2009',
              rooms: '131 rooms & suites',
              facilities: 'Spa, 3 restaurants, marina',
              awards: 'World Travel Awards Winner'
            },
            pricing: {
              rooms: 'From R15,000/night',
              suites: 'From R35,000/night',
              spa: 'From R2,500/treatment',
              dining: 'R1,200+ per person'
            },
            hours: '24/7 Concierge & Room Service',
            features: ['Island Location', 'Table Mountain Views', 'One&Only Spa', 'Nobu Restaurant', 'Marina Access', 'Butler Service'],
            highlights: 'Private island location, Michelin-starred dining, Exclusive marina access'
          },
          'Saxon Hotel': {
            name: 'Saxon Hotel, Villas & Spa',
            location: 'Sandhurst, Johannesburg',
            rating: '4.8⭐ (8,934 reviews)',
            image: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa',
            description: 'Exclusive boutique hotel where Nelson Mandela wrote his autobiography. Epitome of luxury, privacy, and personalized service.',
            details: {
              type: '5-Star Boutique Hotel',
              opened: '1946 (renovated 2000)',
              rooms: '53 rooms, suites & villas',
              area: '10 acres of gardens',
              heritage: 'Mandela\'s writing retreat'
            },
            pricing: {
              rooms: 'From R12,500/night',
              villas: 'From R45,000/night',
              spa: 'From R2,800/treatment',
              dining: 'R1,500+ per person'
            },
            hours: '24/7 Personalized Service',
            features: ['Villa Suites', 'Qunu Spa', 'Private Pools', 'Butler Service', 'Fine Dining', 'Art Collection'],
            highlights: 'Mandela\'s former residence, Ultimate privacy, World-class art collection'
          },
          'Oyster Box Hotel': {
            name: 'The Oyster Box Hotel',
            location: 'Umhlanga, Durban',
            rating: '4.7⭐ (15,632 reviews)',
            image: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b',
            description: 'Iconic colonial-style hotel on golden beaches with Indian Ocean views, legendary service, and timeless elegance.',
            details: {
              type: '5-Star Beach Resort',
              opened: '1947',
              rooms: '86 rooms & suites',
              beachfront: 'Direct beach access',
              style: 'Colonial architecture'
            },
            pricing: {
              rooms: 'From R8,500/night',
              suites: 'From R18,000/night',
              spa: 'From R1,800/treatment',
              dining: 'R950+ per person'
            },
            hours: '24/7 Service & Concierge',
            features: ['Ocean Views', 'Lighthouse Bar', 'Spa Treatments', 'Beach Access', 'Fine Dining', 'Historic Charm'],
            highlights: 'Iconic lighthouse bar, Beachfront location, Colonial elegance'
          }
        };
        
        const hotel = detailedHotels[hotelName];
        if (hotel) {
          const popup = `
            <div style="max-width: 500px; font-family: Arial, sans-serif;">
              <h2 style="color: #1a5490; margin: 0 0 10px 0;">${hotel.name}</h2>
              <div style="color: #666; margin-bottom: 10px;">${hotel.rating}</div>
              <p style="margin-bottom: 15px;">${hotel.description}</p>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                  <strong>📍 Location:</strong><br>${hotel.location}
                </div>
                <div>
                  <strong>🕐 Service:</strong><br>${hotel.hours}
                </div>
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>💰 Pricing:</strong><br>
                ${Object.entries(hotel.pricing).map(([key, value]) => `• ${key}: ${value}`).join('<br>')}
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>🌟 Highlights:</strong><br>
                ${hotel.highlights}
              </div>
              
              <div style="margin-bottom: 15px;">
                <strong>✨ Amenities:</strong><br>
                ${hotel.features.join(' • ')}
              </div>
              
              <button onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(hotel.name + ' ' + hotel.location)}', '_blank')" 
                      style="background: #1a5490; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; margin-right: 10px;">
                🔍 Search on Google
              </button>
              <button onclick="alert('Booking integration coming soon!')" 
                      style="background: #ffd07a; color: #1a5490; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer;">
                📅 Book Room
              </button>
            </div>
          `;
          
          // Create modal overlay
          const modal = document.createElement('div');
          modal.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); display: flex; align-items: center; 
            justify-content: center; z-index: 10000; padding: 20px; box-sizing: border-box;
          `;
          
          const modalContent = document.createElement('div');
          modalContent.style.cssText = `
            background: white; border-radius: 15px; padding: 30px; 
            max-height: 90vh; overflow-y: auto; position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
          `;
          
          const closeBtn = document.createElement('button');
          closeBtn.innerHTML = '✕';
          closeBtn.style.cssText = `
            position: absolute; top: 15px; right: 15px; background: none; 
            border: none; font-size: 24px; cursor: pointer; color: #666;
          `;
          closeBtn.onclick = () => document.body.removeChild(modal);
          
          modalContent.innerHTML = popup;
          modalContent.appendChild(closeBtn);
          modal.appendChild(modalContent);
          document.body.appendChild(modal);
          
          // Close on background click
          modal.onclick = (e) => {
            if (e.target === modal) document.body.removeChild(modal);
          };
        }
      };
      
      // Keep the simple version for map pins
      window.showMapAttraction = function(attractionName) {
        showDetailedAttraction(attractionName);
      };
      
      // Live Search Functionality - Comprehensive South African Database
      let searchDatabase = {
        attractions: {
          'Table Mountain': {
            name: 'Table Mountain National Park',
            location: 'Cape Town, Western Cape',
            type: 'Natural Wonder',
            image: 'https://images.unsplash.com/photo-1580060839134-75a5edca2e99?w=300&h=200&fit=crop',
            keywords: ['table mountain', 'cape town', 'cable car', 'hiking', 'unesco', 'natural wonder']
          },
          'Kruger National Park': {
            name: 'Kruger National Park',
            location: 'Mpumalanga & Limpopo',
            type: 'Safari Park',
            image: 'https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=300&h=200&fit=crop',
            keywords: ['kruger', 'safari', 'big five', 'wildlife', 'game reserve', 'animals']
          },
          'Robben Island': {
            name: 'Robben Island Museum',
            location: 'Western Cape',
            type: 'Historical Site',
            image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=200&fit=crop',
            keywords: ['robben island', 'mandela', 'prison', 'history', 'museum', 'unesco']
          },
          'Drakensberg Mountains': {
            name: 'uKhahlamba-Drakensberg Park',
            location: 'KwaZulu-Natal',
            type: 'UNESCO Site',
            image: 'https://images.unsplash.com/photo-1598300042247-d088f8ab3a91?w=300&h=200&fit=crop',
            keywords: ['drakensberg', 'mountains', 'hiking', 'rock art', 'unesco', 'wilderness']
          },
          'V&A Waterfront': {
            name: 'V&A Waterfront',
            location: 'Cape Town, Western Cape',
            type: 'Shopping & Dining',
            image: 'https://images.unsplash.com/photo-1576485290814-1c72aa4bbb8e?w=300&h=200&fit=crop',
            keywords: ['waterfront', 'shopping', 'dining', 'harbor', 'aquarium', 'entertainment']
          },
          'Cape Point': {
            name: 'Cape Point Nature Reserve',
            location: 'Cape Peninsula, Western Cape',
            type: 'Nature Reserve',
            image: 'https://images.unsplash.com/photo-1539650116574-75c0c6d73ab2?w=300&h=200&fit=crop',
            keywords: ['cape point', 'lighthouse', 'peninsula', 'cliffs', 'two oceans', 'funicular']
          },
          'Blyde River Canyon': {
            name: 'Blyde River Canyon',
            location: 'Mpumalanga',
            type: 'Natural Wonder',
            image: 'https://images.unsplash.com/photo-1582274528428-1d50b1d96619?w=300&h=200&fit=crop',
            keywords: ['blyde river', 'canyon', 'three rondavels', 'panorama route', 'mpumalanga']
          },
          'Garden Route': {
            name: 'Garden Route',
            location: 'Western Cape & Eastern Cape',
            type: 'Scenic Route',
            image: 'https://images.unsplash.com/photo-1544735716-392fe2489ffa?w=300&h=200&fit=crop',
            keywords: ['garden route', 'knysna', 'plettenberg bay', 'oudtshoorn', 'scenic drive']
          },
          'Sun City': {
            name: 'Sun City Resort',
            location: 'North West Province',
            type: 'Entertainment Resort',
            image: 'https://images.unsplash.com/photo-1586880244386-8b3e34c8382c?w=300&h=200&fit=crop',
            keywords: ['sun city', 'casino', 'resort', 'lost city', 'valley of waves']
          },
          'Apartheid Museum': {
            name: 'Apartheid Museum',
            location: 'Johannesburg, Gauteng',
            type: 'Historical Museum',
            image: 'https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=300&h=200&fit=crop',
            keywords: ['apartheid museum', 'johannesburg', 'history', 'mandela', 'south africa']
          },
          'Cape Winelands': {
            name: 'Cape Winelands',
            location: 'Western Cape',
            type: 'Wine Region',
            image: 'https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?w=300&h=200&fit=crop',
            keywords: ['winelands', 'stellenbosch', 'franschhoek', 'paarl', 'wine tasting']
          },
          'Gold Reef City': {
            name: 'Gold Reef City',
            location: 'Johannesburg, Gauteng',
            type: 'Theme Park',
            image: 'https://images.unsplash.com/photo-1586880244386-8b3e34c8382c?w=300&h=200&fit=crop',
            keywords: ['gold reef city', 'theme park', 'johannesburg', 'rides', 'gold mine']
          },
          'Two Oceans Aquarium': {
            name: 'Two Oceans Aquarium',
            location: 'Cape Town, Western Cape',
            type: 'Aquarium',
            image: 'https://images.unsplash.com/photo-1583212292454-1fe6229603b7?w=300&h=200&fit=crop',
            keywords: ['two oceans aquarium', 'cape town', 'marine life', 'waterfront', 'sharks']
          },
          'Kirstenbosch': {
            name: 'Kirstenbosch Botanical Gardens',
            location: 'Cape Town, Western Cape',
            type: 'Botanical Garden',
            image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=200&fit=crop',
            keywords: ['kirstenbosch', 'botanical gardens', 'cape town', 'fynbos', 'concerts']
          },
          'Cradle of Humankind': {
            name: 'Cradle of Humankind',
            location: 'Gauteng & North West',
            type: 'UNESCO World Heritage',
            image: 'https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=300&h=200&fit=crop',
            keywords: ['cradle of humankind', 'sterk fontein', 'caves', 'fossils', 'human evolution']
          }
        },
        malls: {
          'Sandton City': {
            name: 'Sandton City',
            location: 'Sandton, Johannesburg',
            type: 'Premium Mall',
            image: 'https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?w=300&h=200&fit=crop',
            keywords: ['sandton city', 'shopping', 'luxury', 'johannesburg', 'mall', 'brands']
          },
          'Canal Walk': {
            name: 'Canal Walk Shopping Centre',
            location: 'Century City, Cape Town',
            type: 'Mega Mall',
            image: 'https://images.unsplash.com/photo-1567226475328-9d6baaf565cf?w=300&h=200&fit=crop',
            keywords: ['canal walk', 'shopping', 'cape town', 'ice rink', 'largest mall', 'africa']
          },
          'Gateway Theatre of Shopping': {
            name: 'Gateway Theatre of Shopping',
            location: 'Durban North, KwaZulu-Natal',
            type: 'Themed Mall',
            image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=200&fit=crop',
            keywords: ['gateway', 'durban', 'shopping', 'wave house', 'imax', 'beach theme']
          },
          'Eastgate Shopping Centre': {
            name: 'Eastgate Shopping Centre',
            location: 'Bedfordview, Johannesburg',
            type: 'Regional Mall',
            image: 'https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?w=300&h=200&fit=crop',
            keywords: ['eastgate', 'shopping', 'bedfordview', 'johannesburg', 'cinema', 'restaurants']
          },
          'Menlyn Park Shopping Centre': {
            name: 'Menlyn Park Shopping Centre',
            location: 'Pretoria, Gauteng',
            type: 'Super Regional Mall',
            image: 'https://images.unsplash.com/photo-1567226475328-9d6baaf565cf?w=300&h=200&fit=crop',
            keywords: ['menlyn park', 'pretoria', 'shopping', 'largest', 'time square', 'restaurants']
          },
          'Cavendish Square': {
            name: 'Cavendish Square',
            location: 'Claremont, Cape Town',
            type: 'Upmarket Mall',
            image: 'https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?w=300&h=200&fit=crop',
            keywords: ['cavendish square', 'claremont', 'cape town', 'upmarket', 'shopping', 'cinema']
          },
          'La Lucia Mall': {
            name: 'La Lucia Mall',
            location: 'Durban, KwaZulu-Natal',
            type: 'Regional Mall',
            image: 'https://images.unsplash.com/photo-1567226475328-9d6baaf565cf?w=300&h=200&fit=crop',
            keywords: ['la lucia mall', 'durban', 'shopping', 'north coast', 'restaurants', 'cinema']
          },
          'Pavilion Shopping Centre': {
            name: 'Pavilion Shopping Centre',
            location: 'Westville, Durban',
            type: 'Super Regional Mall',
            image: 'https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?w=300&h=200&fit=crop',
            keywords: ['pavilion', 'westville', 'durban', 'shopping', 'largest', 'kzn']
          }
        },
        hotels: {
          'One&Only Cape Town': {
            name: 'One&Only Cape Town',
            location: 'V&A Waterfront, Cape Town',
            type: '5-Star Luxury Resort',
            image: 'https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=300&h=200&fit=crop',
            keywords: ['one only', 'luxury', 'cape town', 'waterfront', 'resort', 'spa']
          },
          'Saxon Hotel': {
            name: 'Saxon Hotel, Villas & Spa',
            location: 'Sandhurst, Johannesburg',
            type: '5-Star Boutique Hotel',
            image: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=300&h=200&fit=crop',
            keywords: ['saxon hotel', 'luxury', 'johannesburg', 'mandela', 'boutique', 'spa']
          },
          'The Oyster Box': {
            name: 'The Oyster Box',
            location: 'Umhlanga, Durban',
            type: '5-Star Luxury Hotel',
            image: 'https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=300&h=200&fit=crop',
            keywords: ['oyster box', 'umhlanga', 'durban', 'luxury', 'lighthouse', 'curry']
          },
          'Mount Nelson Hotel': {
            name: 'Belmond Mount Nelson Hotel',
            location: 'Gardens, Cape Town',
            type: '5-Star Historic Hotel',
            image: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=300&h=200&fit=crop',
            keywords: ['mount nelson', 'pink lady', 'cape town', 'luxury', 'historic', 'afternoon tea']
          },
          'Singita Lebombo Lodge': {
            name: 'Singita Lebombo Lodge',
            location: 'Kruger National Park',
            type: 'Luxury Safari Lodge',
            image: 'https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=300&h=200&fit=crop',
            keywords: ['singita', 'lebombo', 'kruger', 'safari', 'luxury', 'big five']
          },
          'The Palace of the Lost City': {
            name: 'The Palace of the Lost City',
            location: 'Sun City, North West',
            type: '6-Star Resort',
            image: 'https://images.unsplash.com/photo-1586880244386-8b3e34c8382c?w=300&h=200&fit=crop',
            keywords: ['palace lost city', 'sun city', 'luxury', 'resort', 'gary player', 'casino']
          },
          'Radisson Blu Hotel Sandton': {
            name: 'Radisson Blu Hotel Sandton',
            location: 'Sandton, Johannesburg',
            type: '5-Star Business Hotel',
            image: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=300&h=200&fit=crop',
            keywords: ['radisson blu', 'sandton', 'johannesburg', 'business', 'conference', 'gautrain']
          },
          'Table Bay Hotel': {
            name: 'The Table Bay Hotel',
            location: 'V&A Waterfront, Cape Town',
            type: '5-Star Luxury Hotel',
            image: 'https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=300&h=200&fit=crop',
            keywords: ['table bay hotel', 'waterfront', 'cape town', 'luxury', 'table mountain', 'sun international']
          }
        },
        airports: {
          'OR Tambo International': {
            name: 'OR Tambo International Airport',
            location: 'Johannesburg, Gauteng',
            type: 'International Airport',
            image: 'https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=300&h=200&fit=crop',
            keywords: ['or tambo', 'johannesburg', 'international', 'airport', 'jnb', 'flights']
          },
          'Cape Town International': {
            name: 'Cape Town International Airport',
            location: 'Cape Town, Western Cape',
            type: 'International Airport',
            image: 'https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=300&h=200&fit=crop',
            keywords: ['cape town international', 'cpt', 'airport', 'flights', 'western cape']
          },
          'King Shaka International': {
            name: 'King Shaka International Airport',
            location: 'Durban, KwaZulu-Natal',
            type: 'International Airport',
            image: 'https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=300&h=200&fit=crop',
            keywords: ['king shaka', 'durban', 'international', 'airport', 'dbn', 'kzn']
          },
          'Lanseria International': {
            name: 'Lanseria International Airport',
            location: 'Johannesburg, Gauteng',
            type: 'International Airport',
            image: 'https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=300&h=200&fit=crop',
            keywords: ['lanseria', 'johannesburg', 'international', 'airport', 'flights']
          }
        },
        cars: {
          'Avis Car Rental': {
            name: 'Avis Car Rental',
            location: 'Nationwide locations',
            type: 'Car Rental Service',
            image: 'https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?w=300&h=200&fit=crop',
            keywords: ['avis', 'car rental', 'nationwide', 'airport', 'city locations']
          },
          'Hertz Car Rental': {
            name: 'Hertz Car Rental',
            location: 'Major cities and airports',
            type: 'Car Rental Service',
            image: 'https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?w=300&h=200&fit=crop',
            keywords: ['hertz', 'car rental', 'airports', 'cities', 'luxury cars']
          },
          'Budget Car Rental': {
            name: 'Budget Car Rental',
            location: 'Airports and city centers',
            type: 'Car Rental Service',
            image: 'https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?w=300&h=200&fit=crop',
            keywords: ['budget', 'car rental', 'affordable', 'airports', 'economy cars']
          },
          'Europcar': {
            name: 'Europcar South Africa',
            location: 'Major locations nationwide',
            type: 'Car Rental Service',
            image: 'https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?w=300&h=200&fit=crop',
            keywords: ['europcar', 'car rental', 'south africa', 'european cars', 'premium']
          }
        }
      };
      
      let currentSearchResults = [];
      
      window.performLiveSearch = function() {
        const inputEl = document.getElementById('liveSearch');
        const searchTerm = (inputEl ? inputEl.value : '').toLowerCase().trim();
        
        console.log('performLiveSearch called, searchTerm:', searchTerm);
        
        if (searchTerm.length === 0) {
          const resultsContainer = document.getElementById('searchResults');
          if (resultsContainer) {
            resultsContainer.style.display = 'none';
            resultsContainer.innerHTML = '';
          }
          return;
        }
        
        currentSearchResults = [];

        // Helper function for flexible matching on generic items
        const matchesFields = (item, term) => {
          const fields = [
            item.name, item.location, item.type, item.city, item.province,
            item.description, item.code, item.at, item.brands, item.amenities
          ];
          const hay = fields.filter(f => f).join(' ').toLowerCase();
          if (hay.includes(term)) return true;
          
          // Fuzzy: try a few keywords if present
          const kws = item.keywords || [];
          return kws.some(keyword => {
            const k = String(keyword).toLowerCase();
            if (k.includes(term)) return true;
            const distance = levenshteinDistance(k, term);
            return term.length > 3 && distance <= 2;
          });
        };

        // Build dynamic sources from ALL live datasets - NO LIMITS
        const dynAttractions = (window.southAfricanAttractions || []).map(a => ({
          key: a.name,
          name: a.name,
          location: `${a.city||''}${a.province? ', '+a.province: ''}`,
          city: a.city,
          province: a.province,
          type: a.type || 'Attraction',
          description: a.description || '',
          image: a.image || 'images/capetown_1.jpg',
          category: 'attraction',
          keywords: [a.name, a.city, a.province, a.type].filter(Boolean)
        }));
        
        const dynMalls = (typeof southAfricanMalls !== 'undefined' ? southAfricanMalls : []).map(m => ({
          key: m.name,
          name: m.name,
          location: `${m.city||''}${m.province? ', '+m.province: ''}`,
          city: m.city,
          province: m.province,
          type: 'Shopping Mall',
          description: m.description || '',
          brands: (m.brands || []).join(' '),
          image: m.image || 'images/capetown_2.jpg',
          category: 'mall',
          keywords: [m.name, m.city, m.province, ...(m.brands||[])].filter(Boolean)
        }));
        
        const dynHotels = (typeof southAfricanHotels !== 'undefined' ? southAfricanHotels : []).map(h => ({
          key: h.name,
          name: h.name,
          location: `${h.city||''}${h.province? ', '+h.province: ''}`,
          city: h.city,
          province: h.province,
          type: h.type || 'Hotel',
          description: h.description || '',
          amenities: (h.amenities || []).join(' '),
          image: h.image || 'images/placeholder_1.jpg',
          category: 'hotel',
          keywords: [h.name, h.city, h.province, h.type, ...(h.amenities||[])].filter(Boolean)
        }));
        
        const dynAirports = (typeof airportsData !== 'undefined' ? airportsData : []).map(a => ({
          key: a.code || a.name,
          name: a.name,
          location: a.city || '',
          city: a.city,
          code: a.code,
          type: 'Airport',
          image: 'images/capetown_1.jpg',
          category: 'airport',
          keywords: [a.name, a.city, a.code].filter(Boolean)
        }));
        
        const dynCars = (typeof carRentalsData !== 'undefined' ? carRentalsData : []).map(c => ({
          key: c.name,
          name: c.name,
          location: c.city || '',
          city: c.city,
          type: c.at || 'Car Rental',
          at: c.at,
          image: c.image || 'images/capetown_1.jpg',
          category: 'car',
          keywords: [c.name, c.city, c.at].filter(Boolean)
        }));

        const dynRides = (typeof hotelsData !== 'undefined' ? hotelsData : []).map(r => ({
          key: r.name,
          name: `Ride to ${r.name}`,
          location: r.city || '',
          city: r.city,
          type: 'Transportation',
          description: 'Book a ride service',
          image: 'images/durban_1.jpg',
          category: 'ride',
          keywords: ['ride', 'taxi', 'uber', 'bolt', r.name, r.city].filter(Boolean)
        }));

        // Legacy static DB as fallback
        const staticAttractions = Object.entries(searchDatabase.attractions||{}).map(([key,item]) => ({...item, key, category:'attraction'}));
        const staticMalls = Object.entries(searchDatabase.malls||{}).map(([key,item]) => ({...item, key, category:'mall'}));
        const staticHotels = Object.entries(searchDatabase.hotels||{}).map(([key,item]) => ({...item, key, category:'hotel'}));
        const staticAirports = Object.entries(searchDatabase.airports||{}).map(([key,item]) => ({...item, key, category:'airport'}));
        const staticCars = Object.entries(searchDatabase.cars||{}).map(([key,item]) => ({...item, key, category:'car'}));

        // Merge all sources - NO LIMITS!
        const sourceAttractions = [...dynAttractions, ...staticAttractions];
        const sourceMalls = [...dynMalls, ...staticMalls];
        const sourceHotels = [...dynHotels, ...staticHotels];
        const sourceAirports = [...dynAirports, ...staticAirports];
        const sourceCars = [...dynCars, ...staticCars];
        const sourceRides = [...dynRides];

        // Search ALL items without any limits
        const attractionResults = sourceAttractions.filter(i => matchesFields(i, searchTerm));
        const mallResults = sourceMalls.filter(i => matchesFields(i, searchTerm));
        const hotelResults = sourceHotels.filter(i => matchesFields(i, searchTerm));
        const airportResults = sourceAirports.filter(i => matchesFields(i, searchTerm));
        const carResults = sourceCars.filter(i => matchesFields(i, searchTerm));
        const rideResults = sourceRides.filter(i => matchesFields(i, searchTerm));

        currentSearchResults = [...attractionResults, ...mallResults, ...hotelResults, ...airportResults, ...carResults, ...rideResults];
        displaySearchResults(attractionResults, mallResults, hotelResults, airportResults, carResults, rideResults);
      };
      
      // Helper function for fuzzy string matching
      function levenshteinDistance(str1, str2) {
        const matrix = [];
        
        for (let i = 0; i <= str2.length; i++) {
          matrix[i] = [i];
        }
        
        for (let j = 0; j <= str1.length; j++) {
          matrix[0][j] = j;
        }
        
        for (let i = 1; i <= str2.length; i++) {
          for (let j = 1; j <= str1.length; j++) {
            if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
              matrix[i][j] = matrix[i - 1][j - 1];
            } else {
              matrix[i][j] = Math.min(
                matrix[i - 1][j - 1] + 1,
                matrix[i][j - 1] + 1,
                matrix[i - 1][j] + 1
              );
            }
          }
        }
        
        return matrix[str2.length][str1.length];
      }
      
      window.displaySearchResults = function(attractions, malls, hotels, airports, cars, rides) {
        const resultsContainer = document.getElementById('searchResults');
        
        // Clear and build results HTML
        let resultsHTML = '';
        
        // Add attractions
        if (attractions.length > 0) {
          resultsHTML += `
            <div class="search-category">
              <h4>🎭 Attractions (${attractions.length})</h4>
              ${attractions.map(item => `
                <div class="search-result-item" onclick="showDetailedAttraction('${item.key}')">
                  <img src="${item.image}" alt="${item.name}" class="search-result-image">
                  <div class="search-result-info">
                    <h5>${item.name}</h5>
                    <p>${item.location} • ${item.type}</p>
                  </div>
                  <button class="view-image-search" onclick="event.stopPropagation(); openSearchLightbox('${item.image}', '${item.name}', '${item.location}')">
                    🔍
                  </button>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        // Add malls
        if (malls.length > 0) {
          resultsHTML += `
            <div class="search-category">
              <h4>🛍️ Shopping Malls (${malls.length})</h4>
              ${malls.map(item => `
                <div class="search-result-item" onclick="showDetailedMall('${item.key}')">
                  <img src="${item.image}" alt="${item.name}" class="search-result-image">
                  <div class="search-result-info">
                    <h5>${item.name}</h5>
                    <p>${item.location} • ${item.type}</p>
                  </div>
                  <button class="view-image-search" onclick="event.stopPropagation(); openSearchLightbox('${item.image}', '${item.name}', '${item.location}')">
                    🔍
                  </button>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        // Add hotels
        if (hotels.length > 0) {
          resultsHTML += `
            <div class="search-category">
              <h4>🏨 Hotels (${hotels.length})</h4>
              ${hotels.map(item => `
                <div class="search-result-item" onclick="showDetailedHotel('${item.key}')">
                  <img src="${item.image}" alt="${item.name}" class="search-result-image">
                  <div class="search-result-info">
                    <h5>${item.name}</h5>
                    <p>${item.location} • ${item.type}</p>
                  </div>
                  <button class="view-image-search" onclick="event.stopPropagation(); openSearchLightbox('${item.image}', '${item.name}', '${item.location}')">
                    🔍
                  </button>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        // Add airports
        if (airports && airports.length > 0) {
          resultsHTML += `
            <div class="search-category">
              <h4>✈️ Airports (${airports.length})</h4>
              ${airports.map(item => `
                <div class="search-result-item" onclick="alert('Airport info: ${item.name} - ${item.location}')">
                  <img src="${item.image}" alt="${item.name}" class="search-result-image">
                  <div class="search-result-info">
                    <h5>${item.name}</h5>
                    <p>${item.location} • ${item.type}</p>
                  </div>
                  <button class="view-image-search" onclick="event.stopPropagation(); openSearchLightbox('${item.image}', '${item.name}', '${item.location}')">
                    🔍
                  </button>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        // Add car rentals
        if (cars && cars.length > 0) {
          resultsHTML += `
            <div class="search-category">
              <h4>🚗 Car Rentals (${cars.length})</h4>
              ${cars.map(item => `
                <div class="search-result-item" onclick="openSidePanel('cars')">
                  <img src="${item.image}" alt="${item.name}" class="search-result-image">
                  <div class="search-result-info">
                    <h5>${item.name}</h5>
                    <p>${item.location} • ${item.type}</p>
                  </div>
                  <button class="view-image-search" onclick="event.stopPropagation(); openSearchLightbox('${item.image}', '${item.name}', '${item.location}')">
                    🔍
                  </button>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        // Add rides
        if (rides && rides.length > 0) {
          resultsHTML += `
            <div class="search-category">
              <h4>🚕 Rides & Transportation (${rides.length})</h4>
              ${rides.map(item => `
                <div class="search-result-item" onclick="openSidePanel('ride')">
                  <img src="${item.image}" alt="${item.name}" class="search-result-image">
                  <div class="search-result-info">
                    <h5>${item.name}</h5>
                    <p>${item.location} • ${item.type}</p>
                  </div>
                  <button class="view-image-search" onclick="event.stopPropagation(); openSearchLightbox('${item.image}', '${item.name}', '${item.location}')">
                    🔍
                  </button>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        // Show no results message if nothing found
        if (resultsHTML === '') {
          resultsHTML = `
            <div class="no-results-message">
              <h4>🔍 No results found</h4>
              <p>Try searching for:</p>
              <ul>
                <li>Cities: Cape Town, Johannesburg, Durban</li>
                <li>Attractions: Table Mountain, Kruger Park, Garden Route</li>
                <li>Hotels: Saxon Hotel, Mount Nelson, Oyster Box</li>
                <li>Malls: Sandton City, Canal Walk, Gateway</li>
                <li>Airports: OR Tambo, Cape Town International</li>
                <li>Transportation: Uber, Bolt, Taxi, Ride</li>
              </ul>
            </div>
          `;
        }
        
        resultsContainer.innerHTML = resultsHTML;
        resultsContainer.style.display = 'block';
      };
      
      window.showSearchResults = function() {
        document.getElementById('searchResults').classList.remove('hidden');
      };
      
      window.hideSearchResults = function() {
        document.getElementById('searchResults').classList.add('hidden');
      };
      
      window.performSearch = function() {
        const searchTerm = document.getElementById('liveSearch').value;
        if (searchTerm.trim()) {
          performLiveSearch();
        }
      };
      
      // Image Lightbox Functionality
      let currentLightboxImages = [];
      let currentImageIndex = 0;
      
      window.openLightbox = function(imgElement, title, description) {
        const lightbox = document.getElementById('imageLightbox');
        const lightboxImg = document.getElementById('lightboxImage');
        const lightboxTitle = document.getElementById('lightboxTitle');
        const lightboxDescription = document.getElementById('lightboxDescription');
        
        lightboxImg.src = imgElement.src.replace('w=800&h=600', 'w=1200&h=800');
        lightboxImg.alt = imgElement.alt;
        lightboxTitle.textContent = title;
        lightboxDescription.textContent = description;
        
        lightbox.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      };
      
      window.openSearchLightbox = function(imageSrc, title, location) {
        const lightbox = document.getElementById('imageLightbox');
        const lightboxImg = document.getElementById('lightboxImage');
        const lightboxTitle = document.getElementById('lightboxTitle');
        const lightboxDescription = document.getElementById('lightboxDescription');
        
        lightboxImg.src = imageSrc.replace('w=300&h=200', 'w=1200&h=800');
        lightboxImg.alt = title;
        lightboxTitle.textContent = title;
        lightboxDescription.textContent = location;
        
        lightbox.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      };
      
      window.closeLightbox = function() {
        document.getElementById('imageLightbox').classList.add('hidden');
        document.body.style.overflow = 'auto';
      };
      
      window.downloadImage = function() {
        const img = document.getElementById('lightboxImage');
        const link = document.createElement('a');
        link.href = img.src;
        link.download = document.getElementById('lightboxTitle').textContent + '.jpg';
        link.click();
      };
      
      window.shareImage = function() {
        const title = document.getElementById('lightboxTitle').textContent;
        const img = document.getElementById('lightboxImage');
        
        if (navigator.share) {
          navigator.share({
            title: title,
            text: 'Check out this amazing place in South Africa!',
            url: img.src
          });
        } else {
          // Fallback: copy to clipboard
          navigator.clipboard.writeText(img.src).then(() => {
            alert('Image URL copied to clipboard!');
          });
        }
      };
      
      window.viewFullDetails = function() {
        closeLightbox();
        const title = document.getElementById('lightboxTitle').textContent;
        // Try to show detailed info based on the title
        if (title.includes('Table Mountain')) showDetailedAttraction('Table Mountain');
        else if (title.includes('Kruger')) showDetailedAttraction('Kruger National Park');
        else if (title.includes('Sandton')) showDetailedMall('Sandton City');
        else if (title.includes('One&Only')) showDetailedHotel('One&Only Cape Town');
      };
      
      // Close search results when clicking outside
      document.addEventListener('click', function(event) {
        const searchContainer = document.querySelector('.search-container');
        if (!searchContainer.contains(event.target)) {
          hideSearchResults();
        }
      });
      
      // Add click event listeners for navigation buttons as backup
      document.addEventListener('DOMContentLoaded', function() {
        // Find and add event listeners to back to malls buttons
        setTimeout(() => {
          const backToMallsButtons = document.querySelectorAll('button[onclick*="showMallsList"]');
          backToMallsButtons.forEach(button => {
            button.addEventListener('click', function(e) {
              e.preventDefault();
              console.log('Back to Malls button clicked');
              
              if (typeof window.showMallsList === 'function') {
                window.showMallsList();
              } else {
                console.error('showMallsList function not found');
                // Fallback
                showPage('malls');
                setTimeout(() => {
                  const cards = document.getElementById('mallCards');
                  const detail = document.getElementById('mallDetail');
                  if (cards && detail) {
                    detail.style.display = 'none';
                    cards.style.display = 'grid';
                    if (typeof renderMalls === 'function') renderMalls();
                  }
                }, 100);
              }
            });
          });
        }, 1000);
      });
      
      // Close lightbox with Escape key
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          closeLightbox();
        }
      });
      
      // Performance Optimization Functions
      
      // Loading Screen Management
      let loadingProgress = 0;
      const loadingTargets = ['DOM', 'Images', 'Fonts', 'Scripts'];
      let loadedCount = 0;
      
      function updateLoadingProgress(step) {
        loadedCount++;
        loadingProgress = (loadedCount / loadingTargets.length) * 100;
        
        const progressBar = document.getElementById('progressBar');
        if (progressBar) {
          progressBar.style.width = loadingProgress + '%';
        }
        
        if (loadingProgress >= 100) {
          setTimeout(hideLoadingScreen, 500);
        }
      }
      
      function hideLoadingScreen() {
        const loadingScreen = document.getElementById('loadingScreen');
        if (loadingScreen) {
          loadingScreen.style.opacity = '0';
          loadingScreen.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            loadingScreen.style.display = 'none';
          }, 500);
        }
      }
      
      // Lazy Loading Implementation
      class LazyImageLoader {
        constructor() {
          this.imageObserver = null;
          this.images = [];
          this.init();
        }
        
        init() {
          if ('IntersectionObserver' in window) {
            this.imageObserver = new IntersectionObserver((entries, observer) => {
              entries.forEach(entry => {
                if (entry.isIntersecting) {
                  this.loadImage(entry.target);
                  observer.unobserve(entry.target);
                }
              });
            }, {
              rootMargin: '50px 0px',
              threshold: 0.01
            });
            
            this.observeImages();
          } else {
            // Fallback for older browsers
            this.loadAllImages();
          }
        }
        
        observeImages() {
          this.images = document.querySelectorAll('.lazy-image');
          this.images.forEach(img => {
            this.imageObserver.observe(img);
          });
        }
        
        loadImage(img) {
          const loadingIndicator = img.parentNode.querySelector('.image-loading-indicator');
          if (loadingIndicator) {
            loadingIndicator.style.display = 'block';
          }
          
          // Create a new image element for preloading
          const imageLoader = new Image();
          
          imageLoader.onload = () => {
            // Set the srcset and sizes first for responsive images
            if (img.dataset.srcset) {
              img.srcset = img.dataset.srcset;
            }
            if (img.dataset.sizes) {
              img.sizes = img.dataset.sizes;
            }
            
            // Set the main src
            img.src = img.dataset.src;
            
            // Add loaded class for fade-in animation
            img.classList.add('loaded');
            
            // Hide loading indicator
            if (loadingIndicator) {
              loadingIndicator.style.display = 'none';
            }
            
            // Remove data attributes to save memory
            delete img.dataset.src;
            delete img.dataset.srcset;
            delete img.dataset.sizes;
          };
          
          imageLoader.onerror = () => {
            img.classList.add('error');
            if (loadingIndicator) {
              loadingIndicator.style.display = 'none';
            }
          };
          
          // Start loading
          imageLoader.src = img.dataset.src;
        }
        
        loadAllImages() {
          this.images = document.querySelectorAll('.lazy-image');
          this.images.forEach(img => this.loadImage(img));
        }
        
        refresh() {
          if (this.imageObserver) {
            this.observeImages();
          }
        }
      }
      
      // Image Compression and Optimization
      function optimizeImageUrl(url, width = 400, height = 300, quality = 75) {
        if (url.includes('unsplash.com')) {
          // Add Unsplash optimization parameters
          const params = new URLSearchParams();
          params.set('w', width);
          params.set('h', height);
          params.set('fit', 'crop');
          params.set('auto', 'format');
          params.set('q', quality);
          
          return url.split('?')[0] + '?' + params.toString();
        }
        return url;
      }
      
      // Performance Monitoring
      function measurePerformance() {
        if ('performance' in window) {
          window.addEventListener('load', () => {
            setTimeout(() => {
              const perfData = performance.getEntriesByType('navigation')[0];
              const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
              const domContentLoaded = perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart;
              
              console.log('🚀 Performance Metrics:');
              console.log(`📊 Page Load Time: ${loadTime.toFixed(2)}ms`);
              console.log(`🏗️ DOM Content Loaded: ${domContentLoaded.toFixed(2)}ms`);
              console.log(`🎯 First Contentful Paint: ${performance.getEntriesByType('paint').find(entry => entry.name === 'first-contentful-paint')?.startTime.toFixed(2)}ms`);
            }, 1000);
          });
        }
      }
      
      // Cache Management
      class CacheManager {
        constructor() {
          this.cache = new Map();
          this.maxAge = 5 * 60 * 1000; // 5 minutes
        }
        
        set(key, data) {
          this.cache.set(key, {
            data: data,
            timestamp: Date.now()
          });
        }
        
        get(key) {
          const item = this.cache.get(key);
          if (!item) return null;
          
          if (Date.now() - item.timestamp > this.maxAge) {
            this.cache.delete(key);
            return null;
          }
          
          return item.data;
        }
        
        clear() {
          this.cache.clear();
        }
      }
      
      // Initialize Performance Features
      document.addEventListener('DOMContentLoaded', function() {
        updateLoadingProgress('DOM');
        
        // Initialize lazy loading
        window.lazyLoader = new LazyImageLoader();
        
        // Initialize cache manager
        window.cacheManager = new CacheManager();
        
        // Start performance monitoring
        measurePerformance();
        
        updateLoadingProgress('Scripts');
      });
      
      // Font Loading Optimization
      if ('fonts' in document) {
        document.fonts.ready.then(() => {
          updateLoadingProgress('Fonts');
        });
      } else {
        setTimeout(() => updateLoadingProgress('Fonts'), 1000);
      }
      
      // Image Loading Complete Check
      window.addEventListener('load', () => {
        updateLoadingProgress('Images');
      });
      
      // Preload Critical Images
      function preloadCriticalImages() {
        const criticalImages = [
          'https://images.unsplash.com/photo-1580060839134-75a5edca2e99?w=400&h=300&fit=crop&auto=format&q=75',
          'https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=400&h=300&fit=crop&auto=format&q=75',
          'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop&auto=format&q=75'
        ];
        
        criticalImages.forEach(src => {
          const img = new Image();
          img.src = src;
        });
      }
      
      // Initialize preloading
      preloadCriticalImages();
      
      // Ensure showMallsList is available globally
      if (typeof window.showMallsList === 'undefined') {
        window.showMallsList = function() {
          console.log('Backup showMallsList function called');
          
          // Navigate to malls page
          if (typeof showPage === 'function') {
            showPage('malls');
          }
          
          // Show mall cards and hide detail
          setTimeout(() => {
            const cards = document.getElementById('mallCards');
            const detail = document.getElementById('mallDetail');
            
            if (cards && detail) {
              detail.style.display = 'none';
              cards.style.display = 'grid';
              
              // Render malls if function exists
              if (typeof renderMalls === 'function') {
                renderMalls();
              }
            }
            
            // Close any open side panels
            const sidePanel = document.querySelector('.side-panel');
            if (sidePanel) {
              sidePanel.classList.remove('open');
            }
          }, 100);
        };
      }
      
      // Service Worker Registration (for caching)
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('🎯 Service Worker registered successfully');
            })
            .catch(error => {
              console.log('❌ Service Worker registration failed');
            });
        });
      }
      
      // Map zoom functions for real-time map
      window.zoomMap = function(factor) {
        if (realTimeMap) {
          const currentZoom = realTimeMap.getZoom();
          if (factor > 1) {
            realTimeMap.setZoom(currentZoom + 1);
          } else {
            realTimeMap.setZoom(currentZoom - 1);
          }
        }
      };

      window.resetMapZoom = function() {
        if (realTimeMap) {
          realTimeMap.setView([-29.0852, 24.6791], 5);
        }
      };      // Enhanced map functions
      window.toggleAttractionFilter = function() {
        const filterPanel = document.getElementById('attractionFilterPanel');
        if (filterPanel) {
          filterPanel.style.display = filterPanel.style.display === 'none' ? 'block' : 'none';
        }
      };

      window.filterAttractions = function() {
        const checkboxes = document.querySelectorAll('#attractionFilterPanel input[type="checkbox"]');
        const showAll = document.querySelector('#attractionFilterPanel input[value="all"]').checked;
        
        if (showAll) {
          // Show all attractions
          attractionMarkers.forEach(marker => {
            realTimeMap.addLayer(marker);
          });
          // Uncheck other checkboxes
          checkboxes.forEach(cb => {
            if (cb.value !== 'all') cb.checked = false;
          });
        } else {
          // Get selected types
          const selectedTypes = Array.from(checkboxes)
            .filter(cb => cb.checked && cb.value !== 'all')
            .map(cb => cb.value);
          
          // Show/hide markers based on selection
          attractionMarkers.forEach(marker => {
            const popupContent = marker.getPopup().getContent();
            const shouldShow = selectedTypes.length === 0 || selectedTypes.some(type => {
              return popupContent.toLowerCase().includes(type.replace('-', ' '));
            });
            
            if (shouldShow) {
              realTimeMap.addLayer(marker);
            } else {
              realTimeMap.removeLayer(marker);
            }
          });
        }
      };

      // Satellite view toggle is now handled by Leaflet layer control
      window.toggleMapView = function() {
        alert('🗺️ Use the layer control in the top-right corner of the map to switch between Street View and Satellite View!');
      };

      window.showMapInfo = function() {
        const currentTime = new Date().toLocaleString();
        const attractionCount = 20;
        
        alert(`🗺️ SOUTH AFRICA INTERACTIVE MAP\\n\\n📊 Statistics:\\n• ${attractionCount} Tourist Attractions\\n• 9 Provinces Covered\\n• Real-time Updates\\n• GPS Accurate Positioning\\n\\n🕒 Last Updated: ${currentTime}\\n\\n🎯 Features:\\n• Click any pin for details\\n• Use zoom controls\\n• Filter by attraction type\\n• Toggle satellite view\\n\\n🌟 Discover the best of South Africa!`);
      };

      // Real-time clock update for map header
      function updateMapClock() {
        const clockElement = document.getElementById('mapClock');
        if (clockElement) {
          clockElement.innerHTML = new Date().toLocaleTimeString();
        }
      }

      // Update clock every second
      setInterval(updateMapClock, 1000);
      
      window.navigateFromPanel = function(type, target) {
        console.log('Navigation called:', type, target); // Debug log
        
        if (typeof closeSidePanel === 'function') {
          closeSidePanel();
        } else {
          // Fallback if closeSidePanel is not accessible
          const overlay = document.getElementById('sidePanelOverlay');
          if (overlay) overlay.classList.remove('active');
        }
        
        // Add a small delay for smooth panel closing animation
        setTimeout(() => {
          console.log('Executing navigation to:', type, target); // Debug log
          
          switch(type) {
            case 'page':
              if (typeof showPage === 'function') {
                showPage(target);
                if (target === 'attractions') {
                  // Focus search when going to attractions
                  setTimeout(() => {
                    const searchInput = document.getElementById('attractionSearch');
                    if (searchInput) searchInput.focus();
                  }, 300);
                }
              }
              break;
              
            case 'hotel':
              if (typeof showPage === 'function') {
                showPage('hotels');
                setTimeout(() => {
                  if (typeof showHotelDetail === 'function') {
                    showHotelDetail(target);
                  }
                }, 200);
              }
              break;
              
            case 'attraction':
              if (typeof showPage === 'function') {
                showPage('attractions');
                setTimeout(() => {
                  if (typeof showAttractionDetail === 'function') {
                    showAttractionDetail(target);
                  }
                }, 200);
              }
              break;
              
            case 'mall':
              if (typeof showPage === 'function') {
                showPage('malls');
              }
              // Could add specific mall detail navigation here
              break;
              
            case 'explore':
              if (typeof showPage === 'function') {
                showPage('explore');
                setTimeout(() => {
                  if (typeof openExplore === 'function') {
                    openExplore(target);
                  }
                }, 200);
              }
              break;
              
            case 'cars':
              if (typeof showPage === 'function') {
                showPage('cars');
              }
              // Could add specific car category filtering here
              break;
              
            case 'flights':
              if (typeof showPage === 'function') {
                showPage('flights');
              }
              // Could pre-fill flight search based on target type
              break;
              
            case 'ride':
              if (typeof showPage === 'function') {
                showPage('ride');
              }
              // Could pre-select ride type based on target
              break;
              
            default:
              if (typeof showPage === 'function') {
                showPage('home');
              }
          }
        }, 300); // Wait for panel close animation
      };
      

      
      // Comprehensive South African Hotels Database
      const southAfricanHotels = [
        // Western Cape - Cape Town
        { name: 'Table Bay Hotel', city: 'Cape Town', province: 'Western Cape', rating: 5, price: 4500, type: 'Luxury', description: 'Iconic waterfront hotel with Table Mountain views', amenities: ['Spa', 'Pool', 'Restaurant', 'Gym', 'WiFi'], rooms: 329, checkIn: '15:00', checkOut: '11:00' },
        { name: 'Mount Nelson Hotel', city: 'Cape Town', province: 'Western Cape', rating: 5, price: 5200, type: 'Historic Luxury', description: 'Pink palace in the heart of Cape Town', amenities: ['Spa', 'Gardens', 'Restaurant', 'Tea Lounge', 'Pool'], rooms: 201, checkIn: '15:00', checkOut: '12:00' },
        { name: 'The Silo', city: 'Cape Town', province: 'Western Cape', rating: 5, price: 8000, type: 'Ultra Luxury', description: 'Contemporary luxury in converted grain silo', amenities: ['Spa', 'Museum', 'Restaurant', 'Butler Service', 'Harbor Views'], rooms: 28, checkIn: '15:00', checkOut: '12:00' },
        { name: 'Camps Bay Retreat', city: 'Cape Town', province: 'Western Cape', rating: 4, price: 3200, type: 'Boutique', description: 'Tranquil mountain retreat minutes from beach', amenities: ['Spa', 'Pool', 'Restaurant', 'Nature Reserve', 'WiFi'], rooms: 16, checkIn: '14:00', checkOut: '11:00' },
        { name: 'Victoria & Alfred Hotel', city: 'Cape Town', province: 'Western Cape', rating: 4, price: 2800, type: 'Waterfront', description: 'Historic hotel in the heart of V&A Waterfront', amenities: ['Restaurant', 'Bar', 'WiFi', 'Concierge', 'Harbor Views'], rooms: 94, checkIn: '14:00', checkOut: '11:00' },
        
        // Stellenbosch Wine Region
        { name: 'La Residence', city: 'Franschhoek', province: 'Western Cape', rating: 5, price: 6500, type: 'Wine Estate', description: 'Luxury vineyard estate in Franschhoek Valley', amenities: ['Spa', 'Wine Cellar', 'Restaurant', 'Pool', 'Gardens'], rooms: 16, checkIn: '15:00', checkOut: '11:00' },
        { name: 'Babylonstoren', city: 'Stellenbosch', province: 'Western Cape', rating: 5, price: 4800, type: 'Farm Hotel', description: 'Historic farm with contemporary luxury', amenities: ['Garden', 'Spa', 'Restaurant', 'Wine Tasting', 'Farm Activities'], rooms: 22, checkIn: '15:00', checkOut: '11:00' },
        
        // Gauteng - Johannesburg
        { name: 'Four Seasons Westcliff', city: 'Johannesburg', province: 'Gauteng', rating: 5, price: 4200, type: 'Luxury', description: 'Clifftop luxury with panoramic city views', amenities: ['Spa', 'Pool', 'Restaurant', 'Gym', 'Business Center'], rooms: 117, checkIn: '15:00', checkOut: '12:00' },
        { name: 'Saxon Hotel', city: 'Johannesburg', province: 'Gauteng', rating: 5, price: 5500, type: 'Boutique Luxury', description: 'Exclusive boutique hotel in Sandhurst', amenities: ['Spa', 'Pool', 'Restaurant', 'Gardens', 'Art Collection'], rooms: 53, checkIn: '14:00', checkOut: '11:00' },
        { name: 'The Peech Hotel', city: 'Johannesburg', province: 'Gauteng', rating: 4, price: 2200, type: 'Boutique', description: 'Eco-friendly boutique hotel in Melrose', amenities: ['Pool', 'Restaurant', 'Garden', 'Gym', 'Eco-Friendly'], rooms: 16, checkIn: '14:00', checkOut: '10:00' },
        { name: 'InterContinental Sandton', city: 'Johannesburg', province: 'Gauteng', rating: 5, price: 3800, type: 'Business', description: 'Premier business hotel in Sandton CBD', amenities: ['Spa', 'Pool', 'Restaurant', 'Business Center', 'Executive Lounge'], rooms: 244, checkIn: '15:00', checkOut: '12:00' },
        
        // Gauteng - Pretoria
        { name: 'Sheraton Pretoria', city: 'Pretoria', province: 'Gauteng', rating: 4, price: 2800, type: 'Business', description: 'Modern hotel in Pretoria city center', amenities: ['Pool', 'Restaurant', 'Gym', 'Business Center', 'WiFi'], rooms: 175, checkIn: '15:00', checkOut: '12:00' },
        
        // KwaZulu-Natal - Durban
        { name: 'The Oyster Box', city: 'Durban', province: 'KwaZulu-Natal', rating: 5, price: 4000, type: 'Luxury Beachfront', description: 'Colonial elegance on Umhlanga beachfront', amenities: ['Spa', 'Pool', 'Restaurant', 'Beach Access', 'Lighthouse Bar'], rooms: 86, checkIn: '14:00', checkOut: '11:00' },
        { name: 'Hilton Durban', city: 'Durban', province: 'KwaZulu-Natal', rating: 4, price: 2500, type: 'City Hotel', description: 'Modern hotel in Durban city center', amenities: ['Pool', 'Restaurant', 'Gym', 'Business Center', 'WiFi'], rooms: 327, checkIn: '15:00', checkOut: '12:00' },
        { name: 'Beverly Hills Hotel', city: 'Durban', province: 'KwaZulu-Natal', rating: 4, price: 3200, type: 'Beachfront', description: 'Art Deco beachfront hotel in Umhlanga', amenities: ['Pool', 'Restaurant', 'Beach Access', 'Spa', 'Tennis Court'], rooms: 88, checkIn: '14:00', checkOut: '11:00' },
        
        // KwaZulu-Natal - Drakensberg
        { name: 'Cathedral Peak Hotel', city: 'Drakensberg', province: 'KwaZulu-Natal', rating: 4, price: 2800, type: 'Mountain Resort', description: 'Family resort in the Drakensberg Mountains', amenities: ['Pool', 'Restaurant', 'Golf Course', 'Hiking', 'Kids Club'], rooms: 117, checkIn: '14:00', checkOut: '10:00' },
        { name: 'Cleopatra Mountain Farmhouse', city: 'Drakensberg', province: 'KwaZulu-Natal', rating: 5, price: 3500, type: 'Boutique', description: 'Romantic retreat with mountain views', amenities: ['Spa', 'Restaurant', 'Hiking', 'Gardens', 'Wine Cellar'], rooms: 12, checkIn: '14:00', checkOut: '10:00' },
        
        // Mpumalanga - Safari Lodges
        { name: 'Lion Sands River Lodge', city: 'Kruger Park', province: 'Mpumalanga', rating: 5, price: 12000, type: 'Safari Lodge', description: 'Luxury safari lodge on Sabie River', amenities: ['Game Drives', 'Spa', 'Pool', 'Restaurant', 'River Views'], rooms: 18, checkIn: '14:00', checkOut: '10:00' },
        { name: 'Kruger Shalati', city: 'Kruger Park', province: 'Mpumalanga', rating: 5, price: 8500, type: 'Train Safari', description: 'Unique train hotel on Selati Bridge', amenities: ['Game Drives', 'Restaurant', 'Observation Deck', 'Unique Experience'], rooms: 31, checkIn: '14:00', checkOut: '10:00' },
        { name: 'Lukimbi Safari Lodge', city: 'Kruger Park', province: 'Mpumalanga', rating: 4, price: 6500, type: 'Safari Lodge', description: 'Intimate safari lodge in private concession', amenities: ['Game Drives', 'Pool', 'Restaurant', 'Spa', 'Bush Walks'], rooms: 16, checkIn: '14:00', checkOut: '10:00' },
        
        // Eastern Cape
        { name: 'Shamwari Eagles Crag', city: 'Port Elizabeth', province: 'Eastern Cape', rating: 5, price: 7500, type: 'Safari Lodge', description: 'Luxury safari lodge in malaria-free area', amenities: ['Game Drives', 'Spa', 'Pool', 'Restaurant', 'Big 5'], rooms: 9, checkIn: '14:00', checkOut: '10:00' },
        { name: 'The Beach Hotel', city: 'Port Elizabeth', province: 'Eastern Cape', rating: 4, price: 2200, type: 'Beachfront', description: 'Beachfront hotel in Port Elizabeth', amenities: ['Beach Access', 'Restaurant', 'Pool', 'Conference Center'], rooms: 58, checkIn: '14:00', checkOut: '10:00' },
        
        // Free State
        { name: 'Protea Hotel Bloemfontein', city: 'Bloemfontein', province: 'Free State', rating: 3, price: 1500, type: 'Business', description: 'Comfortable business hotel in city center', amenities: ['Restaurant', 'Conference Center', 'WiFi', 'Parking'], rooms: 74, checkIn: '14:00', checkOut: '11:00' },
        
        // Limpopo
        { name: 'ATKV Klein-Kariba', city: 'Bela-Bela', province: 'Limpopo', rating: 3, price: 1800, type: 'Resort', description: 'Family resort on Limpopo River', amenities: ['Pool', 'Restaurant', 'Water Sports', 'Kids Club', 'Conference Center'], rooms: 102, checkIn: '14:00', checkOut: '10:00' },
        
        // North West
        { name: 'Sun City Resort', city: 'Sun City', province: 'North West', rating: 4, price: 3500, type: 'Resort', description: 'Entertainment resort with casino and attractions', amenities: ['Casino', 'Pool', 'Golf', 'Water Park', 'Shows'], rooms: 380, checkIn: '15:00', checkOut: '11:00' },
        { name: 'The Palace of the Lost City', city: 'Sun City', province: 'North West', rating: 5, price: 6500, type: 'Luxury Resort', description: 'Fantasy palace resort with African adventure', amenities: ['Casino', 'Pool', 'Golf', 'Spa', 'Water Park'], rooms: 338, checkIn: '15:00', checkOut: '12:00' },
        
        // Northern Cape
        { name: 'Protea Hotel Kimberley', city: 'Kimberley', province: 'Northern Cape', rating: 3, price: 1400, type: 'Business', description: 'Comfortable accommodation in diamond city', amenities: ['Restaurant', 'Pool', 'Conference Center', 'WiFi'], rooms: 64, checkIn: '14:00', checkOut: '10:00' }
      ];
      
      // Comprehensive South African Malls Database
      const southAfricanMalls = [
        // Gauteng
        { name: 'Sandton City', city: 'Johannesburg', province: 'Gauteng', size: 'Large', stores: 300, description: 'Africa\'s premier shopping destination', brands: ['Woolworths', 'Edgars', 'Apple Store'], parking: 5000, features: ['Cinema', 'Restaurants', 'Banking'] },
        { name: 'Mall of Africa', city: 'Johannesburg', province: 'Gauteng', size: 'Extra Large', stores: 400, description: 'Largest mall in Africa', brands: ['H&M', 'Zara', 'Nike'], parking: 6500, features: ['IMAX', 'Food Court', 'Gym'] },
        { name: 'Menlyn Park', city: 'Pretoria', province: 'Gauteng', size: 'Large', stores: 350, description: 'Premium shopping in Pretoria', brands: ['Stuttafords', 'Woolworths', 'Game'], parking: 4500, features: ['Cinema', 'Kids Zone', 'Medical Center'] },
        { name: 'Eastgate Shopping Centre', city: 'Johannesburg', province: 'Gauteng', size: 'Medium', stores: 200, description: 'Popular east Johannesburg mall', brands: ['Pick n Pay', 'Woolworths', 'Dis-Chem'], parking: 3000, features: ['Cinema', 'Restaurants'] },
        { name: 'Cresta Shopping Centre', city: 'Johannesburg', province: 'Gauteng', size: 'Medium', stores: 180, description: 'Family-friendly neighborhood mall', brands: ['Checkers', 'Woolworths', 'Clicks'], parking: 2500, features: ['Play Area', 'Restaurants'] },
        
        // Western Cape
        { name: 'V&A Waterfront', city: 'Cape Town', province: 'Western Cape', size: 'Large', stores: 450, description: 'Historic waterfront shopping and entertainment', brands: ['Woolworths', 'Cotton On', 'Zara'], parking: 4000, features: ['Harbor Views', 'Aquarium', 'Hotels'] },
        { name: 'Canal Walk', city: 'Cape Town', province: 'Western Cape', size: 'Large', stores: 400, description: 'Largest mall in Western Cape', brands: ['Game', 'Woolworths', 'Edgars'], parking: 5500, features: ['Cinema', 'Bowling', 'Ice Skating'] },
        { name: 'Cavendish Square', city: 'Cape Town', province: 'Western Cape', size: 'Medium', stores: 160, description: 'Upmarket Claremont shopping center', brands: ['Woolworths', 'Stuttafords', 'Clicks'], parking: 2000, features: ['Cinema', 'Fine Dining'] },
        { name: 'Tyger Valley Centre', city: 'Cape Town', province: 'Western Cape', size: 'Large', stores: 220, description: 'Northern suburbs shopping hub', brands: ['Pick n Pay', 'Woolworths', 'Game'], parking: 3500, features: ['Cinema', 'Food Court'] },
        
        // KwaZulu-Natal
        { name: 'Gateway Theatre of Shopping', city: 'Durban', province: 'KwaZulu-Natal', size: 'Extra Large', stores: 390, description: 'Largest mall in Southern Hemisphere', brands: ['Game', 'Woolworths', 'Nike'], parking: 6000, features: ['Wave House', 'IMAX', 'Skate Park'] },
        { name: 'Pavilion Shopping Centre', city: 'Durban', province: 'KwaZulu-Natal', size: 'Large', stores: 270, description: 'Premium Westville shopping destination', brands: ['Woolworths', 'Edgars', 'Stuttafords'], parking: 4000, features: ['Cinema', 'Restaurants', 'Medical Suites'] },
        { name: 'Musgrave Centre', city: 'Durban', province: 'KwaZulu-Natal', size: 'Medium', stores: 120, description: 'Boutique shopping in Berea', brands: ['Woolworths', 'Exclusive Books', 'Clicks'], parking: 1500, features: ['Fine Dining', 'Art Gallery'] },
        
        // Eastern Cape
        { name: 'Walmer Park', city: 'Port Elizabeth', province: 'Eastern Cape', size: 'Large', stores: 180, description: 'Eastern Cape\'s premier shopping center', brands: ['Game', 'Woolworths', 'Edgars'], parking: 3000, features: ['Cinema', 'Food Court'] },
        { name: 'Hemingways Mall', city: 'East London', province: 'Eastern Cape', size: 'Medium', stores: 140, description: 'Popular East London destination', brands: ['Pick n Pay', 'Woolworths', 'Game'], parking: 2000, features: ['Cinema', 'Kids Zone'] },
        
        // Free State
        { name: 'Mimosa Mall', city: 'Bloemfontein', province: 'Free State', size: 'Medium', stores: 120, description: 'Central Free State shopping hub', brands: ['Game', 'Woolworths', 'Clicks'], parking: 2500, features: ['Cinema', 'Food Court'] },
        
        // Mpumalanga
        { name: 'Riverside Mall', city: 'Nelspruit', province: 'Mpumalanga', size: 'Medium', stores: 100, description: 'Gateway to Kruger National Park shopping', brands: ['Pick n Pay', 'Woolworths', 'Game'], parking: 1800, features: ['Tourism Info', 'Restaurants'] },
        
        // Limpopo
        { name: 'Mall of the North', city: 'Polokwane', province: 'Limpopo', size: 'Large', stores: 150, description: 'Northern province shopping destination', brands: ['Game', 'Woolworths', 'Edgars'], parking: 2800, features: ['Cinema', 'Food Court'] },
        
        // North West
        { name: 'Mafikeng Mall', city: 'Mafikeng', province: 'North West', size: 'Medium', stores: 80, description: 'Regional shopping center', brands: ['Pick n Pay', 'Game', 'Clicks'], parking: 1500, features: ['Food Court', 'Banking'] },
        
        // Northern Cape
        { name: 'Kimberly Sol Plaatje Mall', city: 'Kimberley', province: 'Northern Cape', size: 'Medium', stores: 90, description: 'Diamond city shopping center', brands: ['Game', 'Woolworths', 'Pick n Pay'], parking: 1600, features: ['Cinema', 'Restaurants'] }
      ];
      
      function generateDefaultAttractions() {
        const featured = southAfricanAttractions.slice(0, 6);
        return featured.map(attraction => {
          const crowdLevel = ['Low', 'Moderate', 'Busy'][Math.floor(Math.random() * 3)];
          const crowdEmoji = crowdLevel === 'Low' ? '🟢' : crowdLevel === 'Moderate' ? '🟡' : '🔴';
          return `
            <div class="card attraction-card" onclick="showAttractionDetails('${attraction.name}')">
              <h4>🎭 ${attraction.name}</h4>
              <p>📍 ${attraction.city}, ${attraction.province}</p>
              <p>🏷️ ${attraction.type} • ${'★'.repeat(attraction.rating)}</p>
              <p>${crowdEmoji} ${crowdLevel} crowds • ${attraction.admission}</p>
              <small>🕓 ${attraction.hours} • Click for details</small>
            </div>
          `;
        }).join('');
      }
      
      function generateDefaultMalls() {
        const featured = southAfricanMalls.slice(0, 6);
        const currentHour = new Date().getHours();
        const isOpen = currentHour >= 9 && currentHour < 21;
        const status = isOpen ? '🟢 Open' : '🔴 Closed';
        
        return featured.map(mall => `
          <div class="card mall-card" onclick="showMallDetails('${mall.name}')">
            <h4>🛍️ ${mall.name}</h4>
            <p>📍 ${mall.city}, ${mall.province}</p>
            <p>🏢 ${mall.size} • ${mall.stores} stores</p>
            <p>${status} • 🅿️ ${mall.parking} spaces</p>
            <small>👥 ${mall.features.join(' • ')} • Click for details</small>
          </div>
        `).join('');
      }
      
      window.searchPanelAttractions = function() {
        const query = document.getElementById('attractionPanelSearch').value.toLowerCase().trim();
        const results = document.getElementById('attractionSearchResults');
        
        if (!query) {
          results.innerHTML = generateDefaultAttractions();
          return;
        }
        
        const filtered = southAfricanAttractions.filter(attraction => 
          attraction.name.toLowerCase().includes(query) ||
          attraction.city.toLowerCase().includes(query) ||
          attraction.province.toLowerCase().includes(query) ||
          attraction.type.toLowerCase().includes(query) ||
          attraction.description.toLowerCase().includes(query)
        );
        
        if (filtered.length === 0) {
          results.innerHTML = '<div class="no-results">No attractions found. Try searching for cities, provinces, or attraction types.</div>';
          return;
        }
        
        results.innerHTML = filtered.map(attraction => {
          const crowdLevel = ['Low', 'Moderate', 'Busy'][Math.floor(Math.random() * 3)];
          const crowdEmoji = crowdLevel === 'Low' ? '🟢' : crowdLevel === 'Moderate' ? '🟡' : '🔴';
          return `
            <div class="card attraction-card" onclick="showAttractionDetails('${attraction.name}')">
              <h4>🎭 ${attraction.name}</h4>
              <p>📍 ${attraction.city}, ${attraction.province}</p>
              <p>🏷️ ${attraction.type} • ${'★'.repeat(attraction.rating)}</p>
              <p>${crowdEmoji} ${crowdLevel} crowds • ${attraction.admission}</p>
              <small>🕓 ${attraction.hours} • Click for details</small>
            </div>
          `;
        }).join('');
      };
      
      window.searchPanelMalls = function() {
        const query = document.getElementById('mallPanelSearch').value.toLowerCase().trim();
        const results = document.getElementById('mallSearchResults');
        
        if (!query) {
          results.innerHTML = generateDefaultMalls();
          return;
        }
        
        const filtered = southAfricanMalls.filter(mall => 
          mall.name.toLowerCase().includes(query) ||
          mall.city.toLowerCase().includes(query) ||
          mall.province.toLowerCase().includes(query) ||
          mall.brands.some(brand => brand.toLowerCase().includes(query)) ||
          mall.description.toLowerCase().includes(query)
        );
        
        if (filtered.length === 0) {
          results.innerHTML = '<div class="no-results">No malls found. Try searching for cities, provinces, or store brands.</div>';
          return;
        }
        
        const currentHour = new Date().getHours();
        const isOpen = currentHour >= 9 && currentHour < 21;
        const status = isOpen ? '🟢 Open' : '🔴 Closed';
        
        results.innerHTML = filtered.map(mall => `
          <div class="card mall-card" onclick="showMallDetails('${mall.name}')">
            <h4>🛍️ ${mall.name}</h4>
            <p>📍 ${mall.city}, ${mall.province}</p>
            <p>🏢 ${mall.size} • ${mall.stores} stores</p>
            <p>${status} • 🅿️ ${mall.parking} spaces</p>
            <small>👥 ${mall.features.join(' • ')} • Click for details</small>
          </div>
        `).join('');
      };
      
      window.showAttractionDetails = function(name) {
        const attraction = southAfricanAttractions.find(a => a.name === name);
        if (!attraction) return;
        
        const modal = `
          <div class="detail-modal" onclick="closeDetailModal()">
            <div class="detail-content" onclick="event.stopPropagation()">
              <button class="detail-close" onclick="closeDetailModal()">✕</button>
              <h2>🎭 ${attraction.name}</h2>
              <div class="detail-info">
                <p><strong>📍 Location:</strong> ${attraction.city}, ${attraction.province}</p>
                <p><strong>🏷️ Type:</strong> ${attraction.type}</p>
                <p><strong>★ Rating:</strong> ${'★'.repeat(attraction.rating)}</p>
                <p><strong>💰 Admission:</strong> ${attraction.admission}</p>
                <p><strong>🕓 Hours:</strong> ${attraction.hours}</p>
                <p><strong>📝 Description:</strong> ${attraction.description}</p>
              </div>
              <div class="detail-actions">
                <button class="btn primary" onclick="goBackToParentPanel('attractions'); closeDetailModal();">← Back to Attractions</button>
                <button class="btn secondary" onclick="navigateFromPanel('page', 'attractions'); closeDetailModal();">Book Now</button>
                <button class="btn secondary" onclick="closeDetailModal()">Close</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modal);
      };
      
      function generateDefaultHotels() {
        const featured = southAfricanHotels.slice(0, 6);
        
        return featured.map(hotel => {
          const availability = Math.floor(Math.random() * 8) + 3; // 3-10 rooms available
          const discount = Math.floor(Math.random() * 20) + 5; // 5-25% discount
          const currentPrice = Math.floor(hotel.price * (100 - discount) / 100);
          const currentDate = new Date().toLocaleDateString('en-ZA', { month: 'short', day: 'numeric' });
          
          return `
            <div class="card hotel-card" onclick="showHotelDetails('${hotel.name}')">
              <h4>🏨 ${hotel.name}</h4>
              <p>📍 ${hotel.city}, ${hotel.province}</p>
              <p>${'★'.repeat(hotel.rating)} • ${hotel.type}</p>
              <p><strong>R${currentPrice}</strong> <s style="color: rgba(255,255,255,0.6);">R${hotel.price}</s>/night</p>
              <small>🔥 Only ${availability} rooms left for ${currentDate} • Save ${discount}% • Click for details</small>
            </div>
          `;
        }).join('');
      }
      
      window.searchPanelHotels = function() {
        const query = document.getElementById('hotelPanelSearch').value.toLowerCase().trim();
        const results = document.getElementById('hotelSearchResults');
        
        if (!query) {
          results.innerHTML = generateDefaultHotels();
          return;
        }
        
        const filtered = southAfricanHotels.filter(hotel => 
          hotel.name.toLowerCase().includes(query) ||
          hotel.city.toLowerCase().includes(query) ||
          hotel.province.toLowerCase().includes(query) ||
          hotel.type.toLowerCase().includes(query) ||
          hotel.description.toLowerCase().includes(query) ||
          hotel.amenities.some(amenity => amenity.toLowerCase().includes(query))
        );
        
        if (filtered.length === 0) {
          results.innerHTML = '<div class="no-results">No hotels found. Try searching for cities, provinces, hotel types, or amenities.</div>';
          return;
        }
        
        results.innerHTML = filtered.map(hotel => {
          const availability = Math.floor(Math.random() * 8) + 3;
          const discount = Math.floor(Math.random() * 20) + 5;
          const currentPrice = Math.floor(hotel.price * (100 - discount) / 100);
          const currentDate = new Date().toLocaleDateString('en-ZA', { month: 'short', day: 'numeric' });
          
          return `
            <div class="card hotel-card" onclick="showHotelDetails('${hotel.name}')">
              <h4>🏨 ${hotel.name}</h4>
              <p>📍 ${hotel.city}, ${hotel.province}</p>
              <p>${'★'.repeat(hotel.rating)} • ${hotel.type}</p>
              <p><strong>R${currentPrice}</strong> <s style="color: rgba(255,255,255,0.6);">R${hotel.price}</s>/night</p>
              <small>🔥 Only ${availability} rooms left for ${currentDate} • Save ${discount}% • Click for details</small>
            </div>
          `;
        }).join('');
      };
      
      window.showHotelDetails = function(name) {
        const hotel = southAfricanHotels.find(h => h.name === name);
        if (!hotel) return;
        
        const availability = Math.floor(Math.random() * 8) + 3;
        const discount = Math.floor(Math.random() * 20) + 5;
        const currentPrice = Math.floor(hotel.price * (100 - discount) / 100);
        
        const modal = `
          <div class="detail-modal" onclick="closeDetailModal()">
            <div class="detail-content" onclick="event.stopPropagation()">
              <button class="detail-close" onclick="closeDetailModal()">✕</button>
              <h2>🏨 ${hotel.name}</h2>
              <div class="detail-info">
                <p><strong>📍 Location:</strong> ${hotel.city}, ${hotel.province}</p>
                <p><strong>★ Rating:</strong> ${'★'.repeat(hotel.rating)} (${hotel.rating}/5)</p>
                <p><strong>🏷️ Type:</strong> ${hotel.type}</p>
                <p><strong>💰 Price:</strong> <span style="color: var(--gold);">R${currentPrice}</span> <s>R${hotel.price}</s>/night (Save ${discount}%)</p>
                <p><strong>🏨 Rooms:</strong> ${hotel.rooms} rooms available</p>
                <p><strong>🕓 Check-in:</strong> ${hotel.checkIn} | <strong>Check-out:</strong> ${hotel.checkOut}</p>
                <p><strong>🔥 Availability:</strong> Only ${availability} rooms left today!</p>
                <p><strong>✨ Amenities:</strong> ${hotel.amenities.join(', ')}</p>
                <p><strong>📝 Description:</strong> ${hotel.description}</p>
              </div>
              <div class="detail-actions">
                <button class="btn primary" onclick="goBackToParentPanel('hotels'); closeDetailModal();">← Back to Hotels</button>
                <button class="btn secondary" onclick="navigateFromPanel('page', 'hotels'); closeDetailModal();">Book Now</button>
                <button class="btn secondary" onclick="closeDetailModal()">Close</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modal);
      };
      
      window.showMallDetails = function(name) {
        const mall = southAfricanMalls.find(m => m.name === name);
        if (!mall) return;
        
        const currentHour = new Date().getHours();
        const isOpen = currentHour >= 9 && currentHour < 21;
        const status = isOpen ? '🟢 Open' : '🔴 Closed';
        
        const modal = `
          <div class="detail-modal" onclick="closeDetailModal()">
            <div class="detail-content" onclick="event.stopPropagation()">
              <button class="detail-close" onclick="closeDetailModal()">✕</button>
              <h2>🛍️ ${mall.name}</h2>
              <div class="detail-info">
                <p><strong>📍 Location:</strong> ${mall.city}, ${mall.province}</p>
                <p><strong>🏢 Size:</strong> ${mall.size} (${mall.stores} stores)</p>
                <p><strong>👥 Status:</strong> ${status}</p>
                <p><strong>🅿️ Parking:</strong> ${mall.parking} spaces</p>
                <p><strong>🏷️ Popular Brands:</strong> ${mall.brands.join(', ')}</p>
                <p><strong>✨ Features:</strong> ${mall.features.join(', ')}</p>
                <p><strong>📝 Description:</strong> ${mall.description}</p>
              </div>
              <div class="detail-actions">
                <button class="btn primary" onclick="goBackToParentPanel('malls'); closeDetailModal();">← Back to Malls</button>
                <button class="btn secondary" onclick="navigateFromPanel('page', 'malls'); closeDetailModal();">Visit Mall Page</button>
                <button class="btn secondary" onclick="closeDetailModal()">Close</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modal);
      };
      
      window.closeDetailModal = function() {
        const modal = document.querySelector('.detail-modal');
        if (modal) modal.remove();
      };
      
      function initializePanelInteractions(type) {
        // Initialize search functionality
        if (type === 'attractions') {
          const searchInput = document.getElementById('attractionPanelSearch');
          if (searchInput) {
            searchInput.addEventListener('input', function() {
              clearTimeout(this.searchTimeout);
              this.searchTimeout = setTimeout(searchPanelAttractions, 300);
            });
            searchInput.addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                searchPanelAttractions();
              }
            });
          }
        }
        
        if (type === 'hotels') {
          const searchInput = document.getElementById('hotelPanelSearch');
          if (searchInput) {
            searchInput.addEventListener('input', function() {
              clearTimeout(this.searchTimeout);
              this.searchTimeout = setTimeout(searchPanelHotels, 300);
            });
            searchInput.addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                searchPanelHotels();
              }
            });
          }
        }
        
        if (type === 'malls') {
          const searchInput = document.getElementById('mallPanelSearch');
          if (searchInput) {
            searchInput.addEventListener('input', function() {
              clearTimeout(this.searchTimeout);
              this.searchTimeout = setTimeout(searchPanelMalls, 300);
            });
            searchInput.addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                searchPanelMalls();
              }
            });
          }
        }
      }
      window.addEventListener('scroll', () => { if (dropdownAnchor) positionDropdown(dropdownAnchor); }, { passive: true });

      function addHomePanel(kind) {
        // Close all existing panels first
        homeStack.querySelectorAll('.home-panel').forEach(p => p.remove());
        // Now create and show the new panel
        let panel = homeStack.querySelector(`[data-panel="${kind}"]`);
        if (!panel) {
          panel = buildHomePanel(kind);
          if (panel) homeStack.appendChild(panel);
        }
        panel?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      function buildHomePanel(kind) {
        const section = document.createElement('section');
        section.className = 'home-panel';
        section.setAttribute('data-panel', kind);
        const titleMap = { attractions: 'Attractions', hotels: 'Hotels', malls: 'Malls', cars: 'Rent a Car', flights: 'Book a Flight', explore: 'Explore' };
        const header = `<div class="panel-header"><h3>${titleMap[kind] || kind}</h3><button class="panel-close" aria-label="Remove section">×</button></div>`;
        let body = '';
        if (kind === 'attractions') {
          const items = Object.entries(attractionsData || {}).map(([key, a]) => ({ key, name: a.name, location: a.location, image: a.image }));
          body = `<div class="cards">${items.map(i => `
            <div class=\"card\" data-attraction=\"${i.key}\" style=\"cursor:pointer\">
              ${i.image ? `<img class=\"card-image\" src=\"${i.image}\" alt=\"${i.name}\">` : ''}
              <div class=\"card-content\">
                <h3>${i.name}</h3>
                <p>${i.location || ''}</p>
              </div>
            </div>
          `).join('')}</div>`;
        } else if (kind === 'hotels') {
          body = `<div class="cards">${(hotelsData||[]).map((h, idx) => `
            <div class=\"card\" data-hotel=\"${idx}\" style=\"cursor:pointer\">
              ${h.image ? `<img class="card-image" src="${h.image}" alt="${h.name}">` : ''}
              <div class="card-content">
                <h3>${h.name}</h3>
                <p>${h.city} • <span class="stars">${'★'.repeat(h.rating)}</span></p>
              </div>
            </div>
          `).join('')}</div>`;
        } else if (kind === 'malls') {
          body = `<div class=\"cards\">${(mallsData||[]).map((m, idx) => {
            const st = getMallStatus(m);
            return `
            <div class=\"card\" data-mall=\"${idx}\" style=\"cursor:pointer\">
              ${m.image ? `<img class=\"card-image\" src=\"${m.image}\" alt=\"${m.name}\" onerror=\"this.onerror=null;this.src='${mallPlaceholderPool[idx % mallPlaceholderPool.length]}'\">` : ''}
              <div class=\"card-content\">
                <h3>${m.name}</h3>
                <p>${m.city} • ${m.shops} shops</p>
                <p><span class=\"badge\" style=\"${st.isOpen?'background:#2e7d32':'background:#9e9e9e'};color:#fff;padding:2px 6px;border-radius:10px;font-size:12px;\">${st.statusText}</span></p>
              </div>
            </div>`;
          }).join('')}</div>`;
        } else if (kind === 'cars') {
          body = `
          <div class=\"cards\"><div class=\"form-card\">
            <h3>🚗 Find a Rental</h3>
            <form id=\"carFormInline\">
              <div class=\"form-grid\">
                <div class=\"form-field\">
                  <label for=\"carPickupInline\">Pick-up location</label>
                  <input id=\"carPickupInline\" name=\"pickup\" list=\"sa-airports-inline\" placeholder=\"City or airport\" required>
                </div>
                <div class=\"form-field\">
                  <label for=\"carDropoffInline\">Drop-off location</label>
                  <input id=\"carDropoffInline\" name=\"dropoff\" list=\"sa-airports-inline\" placeholder=\"City or airport\" required>
                </div>
                <div class=\"form-field\">
                  <label for=\"carFromInline\">From (date)</label>
                  <input id=\"carFromInline\" name=\"from\" type=\"date\" required>
                </div>
                <div class=\"form-field\">
                  <label for=\"carToInline\">Until (date)</label>
                  <input id=\"carToInline\" name=\"to\" type=\"date\" required>
                </div>
                <div class=\"form-field\">
                  <label for=\"carPassengersInline\">Passengers</label>
                  <select id=\"carPassengersInline\" name=\"passengers\">
                    <option>1</option><option>2</option><option>3</option><option>4</option>
                    <option>5</option><option>6</option><option>7</option><option>8</option>
                  </select>
                </div>
              </div>
              <div class=\"form-actions\"><button type=\"submit\" class=\"btn primary\">Search Cars</button></div>
            </form>
            <datalist id=\"sa-airports-inline\">
              <option value=\"CPT - Cape Town Intl\"><option value=\"JNB - OR Tambo (Johannesburg)\">
              <option value=\"DUR - King Shaka (Durban)\"><option value=\"PLZ - Gqeberha (Port Elizabeth)\">
              <option value=\"GRJ - George\"><option value=\"HLA - Lanseria (Johannesburg)\">
            </datalist>
          </div></div>`;
        } else if (kind === 'flights') {
          body = `
          <div class=\"cards\"><div class=\"form-card\">
            <h3>✈️ Search Flights</h3>
            <form id=\"flightFormInline\">
              <div class=\"flight-form-grid\">
                <div class=\"form-field flight-trip-type\">
                  <label>Trip type</label>
                  <div class=\"inline\">
                    <label><input type=\"radio\" name=\"tripInline\" value=\"oneway\" checked> One way</label>
                    <label><input type=\"radio\" name=\"tripInline\" value=\"return\"> Return</label>
                  </div>
                </div>
                <div class=\"flight-row\">
                  <div class=\"form-field\">
                    <label for=\"fromAirportInline\">From</label>
                    <input id=\"fromAirportInline\" name=\"from\" list=\"sa-airports-inline-2\" placeholder=\"Select airport\" required>
                  </div>
                  <div class=\"form-field\">
                    <label for=\"toAirportInline\">To</label>
                    <input id=\"toAirportInline\" name=\"to\" list=\"sa-airports-inline-2\" placeholder=\"Select airport\" required>
                  </div>
                </div>
                <div class=\"flight-row\">
                  <div class=\"form-field\">
                    <label for=\"departDateInline\">Depart</label>
                    <input id=\"departDateInline\" name=\"depart\" type=\"date\" required>
                  </div>
                  <div class=\"form-field\">
                    <label for=\"travellersInline\">Travellers</label>
                    <select id=\"travellersInline\" name=\"travellers\"> 
                      <option>1</option><option>2</option><option>3</option><option>4</option>
                      <option>5</option><option>6</option><option>7</option><option>8</option>
                    </select>
                  </div>
                </div>
                <div class=\"form-field\" id=\"returnDateFieldInline\" style=\"display:none;\">
                  <label for=\"returnDateInline\">Return</label>
                  <input id=\"returnDateInline\" name=\"return\" type=\"date\">
                </div>
              </div>
              <div class=\"form-actions\"><button type=\"submit\" class=\"btn primary\">Search Flights</button></div>
            </form>
            <datalist id=\"sa-airports-inline-2\">
              <option value=\"CPT - Cape Town Intl\"><option value=\"JNB - OR Tambo (Johannesburg)\">
              <option value=\"DUR - King Shaka (Durban)\"><option value=\"PLZ - Gqeberha (Port Elizabeth)\">
              <option value=\"GRJ - George\"><option value=\"HLA - Lanseria (Johannesburg)\">
            </datalist>
          </div></div>`;
        } else if (kind === 'explore') {
          body = `
          <div class=\"explore-inline\">
            <div class=\"search-row\">
              <input class=\"search-input explore-inline-search\" type=\"search\" placeholder=\"Search by name or city...\" autocomplete=\"off\">
            </div>
            <div class=\"explore-meta\"></div>
            <div class=\"cards explore-inline-results\"></div>
          </div>`;
        }
        section.innerHTML = header + body;

        // Close button
        section.querySelector('.panel-close')?.addEventListener('click', () => section.remove());

        // Wire inline forms
        if (kind === 'cars') {
          const form = section.querySelector('#carFormInline');
          form?.addEventListener('submit', (e) => {
            e.preventDefault();
            const data = new FormData(form);
            alert(`Searching cars: ${data.get('pickup')} → ${data.get('dropoff')} | From ${data.get('from')} to ${data.get('to')} | Passengers: ${data.get('passengers')}`);
          });
        }
        if (kind === 'flights') {
          const form = section.querySelector('#flightFormInline');
          const tripInputs = section.querySelectorAll('input[name="tripInline"]');
          const returnFld = section.querySelector('#returnDateFieldInline');
          tripInputs.forEach(r => r.addEventListener('change', () => {
            if (section.querySelector('input[name="tripInline"]:checked')?.value === 'return') {
              returnFld.style.display = 'block';
              section.querySelector('#returnDateInline')?.setAttribute('required','required');
            } else {
              returnFld.style.display = 'none';
              section.querySelector('#returnDateInline')?.removeAttribute('required');
            }
          }));
          form?.addEventListener('submit', (e) => {
            e.preventDefault();
            const data = new FormData(form);
            const trip = section.querySelector('input[name="tripInline"]:checked')?.value || 'oneway';
            alert(`Searching ${trip === 'return' ? 'return' : 'one-way'} flights: ${data.get('from')} → ${data.get('to')} | Depart ${data.get('depart')}${trip==='return' ? `, Return ${data.get('return')}` : ''} | Travellers: ${data.get('travellers')}`);
          });
        }
        if (kind === 'explore') {
          const searchInput = section.querySelector('.explore-inline-search');
          const meta = section.querySelector('.explore-meta');
          const results = section.querySelector('.explore-inline-results');
          const dataset = [...(airportsData||[])];
          function renderInline() {
            const q = (searchInput.value||'').toLowerCase();
            const data = dataset.filter(d => (`${d.code||''} ${d.name||''} ${d.city||''}`).toLowerCase().includes(q));
            meta.textContent = `${data.length} result${data.length===1?'':'s'} — Airports`;
            results.innerHTML = data.map(item => `<div class="card" data-type="airport" data-key="${item.code}" data-title="${(item.code? item.code+' — ':'')+item.name}" data-subtitle="${item.city||''}"><img class="card-image" src="images/capetown_1.jpg" alt="${item.name}"><div class="card-content"><h3>${item.code ? item.code+' — ' : ''}${item.name}</h3><p>${item.city||''}</p><button class="btn primary">View</button></div></div>`).join('');
            results.querySelectorAll('[data-type] .btn.primary').forEach(btn => {
              btn.addEventListener('click', (e) => {
                const card = e.target.closest('[data-type]');
                const type = card.getAttribute('data-type');
                const key = card.getAttribute('data-key');
                const title = card.getAttribute('data-title');
                const subtitle = card.getAttribute('data-subtitle');
                openPlaceDetail({ type, key, title, subtitle, icon: type==='airport'?'✈️':'📍' });
              });
            });
          }
          renderInline();
          searchInput.addEventListener('input', renderInline);
        }
        // Wire attraction cards to open details
        if (kind === 'attractions') {
          section.querySelectorAll('[data-attraction]').forEach(card => {
            card.addEventListener('click', () => {
              const key = card.getAttribute('data-attraction');
              showPage('attractions');
              showAttractionDetail(key);
            });
          });
        }

        // Wire hotel cards to open details
        if (kind === 'hotels') {
          section.querySelectorAll('[data-hotel]').forEach(card => {
            card.addEventListener('click', () => {
              const idx = Number(card.getAttribute('data-hotel'));
              showHotelDetail(idx);
            });
          });
        }
        // Wire mall cards to open details (navigate to Malls page)
        if (kind === 'malls') {
          section.querySelectorAll('[data-mall]').forEach(card => {
            card.addEventListener('click', () => {
              const idx = Number(card.getAttribute('data-mall'));
              showMallDetail(idx);
            });
          });
          // JS image fallback chain: local -> Unsplash -> local placeholder pool
          section.querySelectorAll('[data-mall] img.card-image').forEach(img => {
            const card = img.closest('[data-mall]');
            const idx = Number(card?.getAttribute('data-mall'));
            const m = (mallsData||[])[idx];
            if (!m) return;
            const u = `https://source.unsplash.com/600x400/?${encodeURIComponent(m.name + ' ' + m.city + ' mall exterior')}`;
            img.addEventListener('error', () => {
              const tried = img.dataset.fbTried || '0';
              if (tried === '0') { img.dataset.fbTried = '1'; img.src = u; }
              else { img.src = mallPlaceholderPool[idx % mallPlaceholderPool.length]; }
            });
            if (img.complete && img.naturalWidth === 0) { img.src = u; }
          });
        }
        return section;
      }

      // Explore rendering with category filter
      const explorePanel = document.getElementById('explorePanel');
      const exploreResults = document.getElementById('exploreResults');
      const exploreMeta = document.getElementById('exploreMeta');
      const exploreSearch = document.getElementById('exploreSearch');
      const exploreLiveToggle = document.getElementById('exploreLiveToggle');
      let currentExplore = 'attractions';
      let currentData = [];

      const beachAttractions = ['camps-bay', 'boulders-beach', 'durban-beaches', 'hermanus-whale-watching'];
      const hikingAttractions = ['table-mountain', 'drakensberg', 'lions-head-hike', 'tsitsikamma-national-park', 'otter-trail', 'blyde-river-canyon'];

      function openExplore(category) {
        currentExplore = category;
        if (category === 'beaches') {
          const beachData = Object.entries(attractionsData||{}).filter(([key]) => beachAttractions.includes(key)).map(([key,a]) => ({ key, name:a.name, city:a.location, image:a.image, type:'attraction' }));
          currentData = beachData;
        } else if (category === 'hiking') {
          const hikingData = Object.entries(attractionsData||{}).filter(([key]) => hikingAttractions.includes(key)).map(([key,a]) => ({ key, name:a.name, city:a.location, image:a.image, type:'attraction' }));
          currentData = hikingData;
        } else if (category === 'airports') {
          currentData = airportsData.map(a => ({ ...a, type:'airport' }));
        } else if (category === 'cars') {
          currentData = carRentalsData.map(c => ({ ...c, type:'car' }));
        } else if (category === 'hotels') {
          currentData = hotelsData.map(h => ({ ...h, type:'hotel' }));
        } else {
          // attractions (all)
          currentData = Object.entries(attractionsData||{}).map(([key,a]) => ({ key, name:a.name, city:a.location, image:a.image, type:'attraction' }));
        }
        explorePanel.style.display = 'block';
        exploreSearch.value = '';
        exploreLiveToggle.checked = false;
        renderExplore();
      }

      async function fetchLiveAirports(query) {
        // Wikipedia search fallback (client-side, no key). origin=* allows CORS.
        try {
          const url = `https://en.wikipedia.org/w/api.php?origin=*&action=query&list=search&srsearch=${encodeURIComponent(query + ' airport south africa')}&format=json&srlimit=6`;
          const res = await fetch(url, { headers: { 'Accept': 'application/json' }});
          if (!res.ok) return [];
          const json = await res.json();
          const items = json?.query?.search || [];
          return items.map(i => ({ name: i.title, city: 'South Africa', live: true }));
        } catch { return []; }
      }

      async function renderExplore() {
        const q = exploreSearch.value.trim().toLowerCase();
        let data = currentData.filter(item => {
          const s = (item.name || '').toLowerCase() + ' ' + (item.city || '') .toLowerCase() + ' ' + (item.code || '').toLowerCase();
          return q ? s.includes(q) : true;
        });

        // Optionally merge live airport results
        if (currentExplore === 'airports' && exploreLiveToggle.checked && q.length >= 2) {
          const live = await fetchLiveAirports(q);
          const seen = new Set(data.map(d => (d.code || d.name).toLowerCase()));
          live.forEach(l => { const k = (l.code || l.name).toLowerCase(); if (!seen.has(k)) data.push(l); });
        }

        // Meta
        const catName = { beaches:'Beaches', hiking:'Hiking & Adventure', airports:'Airports', cars:'Car Rentals', hotels:'Hotels', attractions:'Attractions' }[currentExplore] || 'Results';
        exploreMeta.textContent = `${data.length} result${data.length === 1 ? '' : 's'} — ${catName}`;

        // Render
        exploreResults.innerHTML = data.map(item => {
          if (item.type === 'airport' || currentExplore === 'airports') {
            return `<div class="card"><div class="card-content"><h3>${item.code ? `${item.code} — ` : ''}${item.name}${item.live ? ' <span class="badge">LIVE</span>' : ''}</h3><p>${item.city || ''}</p><button class="btn primary" onclick="openPlaceDetail({type:'airport',key:'${item.code}',title:'${(item.code? item.code+' — ':'')+item.name}',subtitle:'${item.city||''}'})">View</button></div></div>`;
          }
          if (item.type === 'car' || currentExplore === 'cars') {
            return `<div class="card"><div class="card-content"><h3>${item.name}</h3><p>${item.city} • ${item.at}</p><button class="btn primary" onclick="showPage('cars')">View offers</button></div></div>`;
          }
          if (item.type === 'hotel' || currentExplore === 'hotels') {
            const idx = hotelsData.findIndex(h => h.name === item.name);
            return `<div class="card"><div class="card-content"><h3>${item.name}</h3><p>${item.city} • <span class="stars">${'★'.repeat(item.rating)}</span></p><button class="btn primary" onclick="showHotelDetail(${idx})">See rooms</button></div></div>`;
          }
          // attraction
          return `<div class="card"><img class="card-image" src="${item.image}" alt="${item.name}"><div class="card-content"><h3>${item.name}</h3><p>${item.city || ''}</p><button class="btn primary" onclick="showPage('attractions');showAttractionDetail('${item.key}')">Details</button></div></div>`;
        }).join('');
      }

      // Explore button handlers
      document.querySelectorAll('.explore-btn').forEach(btn => {
        btn.addEventListener('click', () => openExplore(btn.getAttribute('data-explore')));
      });
      exploreSearch?.addEventListener('input', () => { renderExplore(); });
      exploreLiveToggle?.addEventListener('change', () => { renderExplore(); });

      // Flights: toggle return date
      const tripRadios = document.querySelectorAll('input[name="trip"]');
      const returnField = document.getElementById('returnDateField');
      tripRadios.forEach(r => r.addEventListener('change', () => {
        if (document.querySelector('input[name="trip"]:checked')?.value === 'return') {
          returnField.style.display = 'block';
          document.getElementById('returnDate').setAttribute('required','required');
        } else {
          returnField.style.display = 'none';
          document.getElementById('returnDate').removeAttribute('required');
        }
      }));

      // Flights: submit handler demo
      const flightForm = document.getElementById('flightForm');
      if (flightForm) {
        flightForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const data = new FormData(flightForm);
          const trip = data.get('trip');
          const summary = `Searching ${trip === 'return' ? 'return' : 'one-way'} flights: ${data.get('from')} → ${data.get('to')} | Depart ${data.get('depart')}${trip==='return' ? `, Return ${data.get('return')}` : ''} | Travellers: ${data.get('travellers')}`;
          alert(summary);
        });
      }

      // Cars: submit handler demo
      const carForm = document.getElementById('carForm');
      if (carForm) {
        carForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const data = new FormData(carForm);
          const summary = `Searching cars: ${data.get('pickup')} → ${data.get('dropoff')} | From ${data.get('from')} to ${data.get('to')} | Passengers: ${data.get('passengers')}`;
          alert(summary);
        });
      }
    });

    // Hamburger menu functionality
    const hamburger = document.getElementById('hamburger');
    const closeMenu = document.getElementById('closeMenu');
    const menu = document.getElementById('hamburgerMenu');
    const menuItems = document.querySelectorAll('.hamburger-item');

    hamburger.addEventListener('click', () => {
      menu.classList.add('open');
    });

    closeMenu.addEventListener('click', () => {
      menu.classList.remove('open');
    });

    menuItems.forEach(item => {
      item.addEventListener('click', () => {
        menu.classList.remove('open');
      });
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!menu.contains(e.target) && !hamburger.contains(e.target) && menu.classList.contains('open')) {
        menu.classList.remove('open');
      }
    });
  </script>
</body>
</html>
